/*

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 MIT

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var $jscomp={scope:{},getGlobal:function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global?global:g}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(g){return"jscomp_symbol_"+g+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(g){$jscomp.initSymbolIterator();if(g[$jscomp.global.Symbol.iterator])return g[$jscomp.global.Symbol.iterator]();if(!(g instanceof Array||"string"==typeof g||g instanceof String))throw new TypeError(g+" is not iterable");var e=0;return{next:function(){return e==g.length?{done:!0}:{done:!1,value:g[e++]}}}};$jscomp.arrayFromIterator=function(g){for(var e,d=[];!(e=g.next()).done;)d.push(e.value);return d};
$jscomp.arrayFromIterable=function(g){return g instanceof Array?g:$jscomp.arrayFromIterator($jscomp.makeIterator(g))};$jscomp.arrayFromArguments=function(g){for(var e=[],d=0;d<g.length;d++)e.push(g[d]);return e};$jscomp.inherits=function(g,e){function d(){}d.prototype=e.prototype;g.prototype=new d;g.prototype.constructor=g;for(var m in e)if($jscomp.global.Object.defineProperties){var b=$jscomp.global.Object.getOwnPropertyDescriptor(e,m);$jscomp.global.Object.defineProperty(g,m,b)}else g[m]=e[m]};
$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};$jscomp.array.arrayIterator_=function(g,e){g instanceof String&&(g=String(g));var d=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var m={},b=(m.next=function(){if(d<g.length){var a=d++;return{value:e(a,g[a]),done:!1}}b.next=$jscomp.array.done_;return $jscomp.array.done_()},m[Symbol.iterator]=function(){return b},m);return b};
$jscomp.array.findInternal_=function(g,e,d){g instanceof String&&(g=String(g));for(var m=g.length,b=0;b<m;b++){var a=g[b];if(e.call(d,a,b,g))return{i:b,v:a}}return{i:-1,v:void 0}};
$jscomp.array.from=function(g,e,d){e=void 0===e?function(a){return a}:e;var m=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(g[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();g=g[Symbol.iterator]();for(var b;!(b=g.next()).done;)m.push(e.call(d,b.value))}else{b=g.length;for(var a=0;a<b;a++)m.push(e.call(d,g[a]))}return m};$jscomp.array.of=function(g){for(var e=[],d=0;d<arguments.length;++d)e[d-0]=arguments[d];return $jscomp.array.from(e)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(g,e){return[g,e]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(g){return g})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(g,e){return e})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(g,e,d){var m=this.length;g=Number(g);e=Number(e);d=Number(null!=d?d:m);if(g<e)for(d=Math.min(d,m);e<d;)e in this?this[g++]=this[e++]:(delete this[g++],e++);else for(d=Math.min(d,m+e-g),g+=d-e;d>e;)--d in this?this[--g]=this[d]:delete this[g];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(g,e,d){null!=d&&g.length||(d=this.length||0);d=Number(d);for(e=Number((void 0===e?0:e)||0);e<d;e++)this[e]=g;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(g,e){return $jscomp.array.findInternal_(this,g,e).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(g,e){return $jscomp.array.findInternal_(this,g,e).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(g){g=void 0===g?[]:g;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(g){g=$jscomp.makeIterator(g);for(var e=g.next();!e.done;e=g.next())e=e.value,this.set(e[0],e[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var g=$jscomp.global.Map;if(!g||!g.prototype.entries||!Object.seal)return!1;try{var e=Object.seal({x:4}),d=new g($jscomp.makeIterator([[e,"s"]]));if("s"!=d.get(e)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var m=d.entries(),b=m.next();if(b.done||b.value[0]!=e||"s"!=b.value[1])return!1;b=m.next();return b.done||4!=b.value[0].x||"t"!=b.value[1]||!m.next().done?!1:!0}catch(a){return!1}};
$jscomp.Map.createHead_=function(){var g={};return g.previous=g.next=g.head=g};$jscomp.Map.getId_=function(g){if(!(g instanceof Object))return String(g);$jscomp.Map.key_ in g||g instanceof Object&&Object.isExtensible&&Object.isExtensible(g)&&$jscomp.Map.defineProperty_(g,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in g?g[$jscomp.Map.key_]:" "+g};
$jscomp.Map.prototype.set=function(g,e){var d=this.maybeGetEntry_(g),m=d.id,b=d.list,d=d.entry;b||(b=this.data_[m]=[]);d?d.value=e:(d={next:this.head_,previous:this.head_.previous,head:this.head_,key:g,value:e},b.push(d),this.head_.previous.next=d,this.head_.previous=d,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(g){var e=this.maybeGetEntry_(g);g=e.id;var d=e.list,m=e.index;return(e=e.entry)&&d?(d.splice(m,1),d.length||delete this.data_[g],e.previous.next=e.next,e.next.previous=e.previous,e.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(g){return!!this.maybeGetEntry_(g).entry};
$jscomp.Map.prototype.get=function(g){return(g=this.maybeGetEntry_(g).entry)&&g.value};$jscomp.Map.prototype.maybeGetEntry_=function(g){var e=$jscomp.Map.getId_(g),d=this.data_[e];if(d)for(var m=0;m<d.length;m++){var b=d[m];if(g!==g&&b.key!==b.key||g===b.key)return{id:e,list:d,index:m,entry:b}}return{id:e,list:d,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(g){return[g.key,g.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(g){return g.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(g){return g.value})};$jscomp.Map.prototype.forEach=function(g,e){for(var d=$jscomp.makeIterator(this.entries()),m=d.next();!m.done;m=d.next())m=m.value,g.call(e,m[1],m[0],this)};
$jscomp.Map.prototype.iter_=function(g){var e=this,d=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var m={};return m.next=function(){if(d){for(;d.head!=e.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:g(d)};d=null}return{done:!0,value:void 0}},m[Symbol.iterator]=function(){return this},m};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(g,e,d){Object.defineProperty(g,e,{value:String(d)})}:function(g,e,d){g[e]=String(d)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(g){g=Number(g)>>>0;if(0===g)return 32;var e=0;0===(g&4294901760)&&(g<<=16,e+=16);0===(g&4278190080)&&(g<<=8,e+=8);0===(g&4026531840)&&(g<<=4,e+=4);0===(g&3221225472)&&(g<<=2,e+=2);0===(g&2147483648)&&e++;return e};$jscomp.math.imul=function(g,e){g=Number(g);e=Number(e);var d=g&65535,m=e&65535;return d*m+((g>>>16&65535)*m+d*(e>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(g){g=Number(g);return 0===g||isNaN(g)?g:0<g?1:-1};
$jscomp.math.log10=function(g){return Math.log(g)/Math.LN10};$jscomp.math.log2=function(g){return Math.log(g)/Math.LN2};$jscomp.math.log1p=function(g){g=Number(g);if(.25>g&&-.25<g){for(var e=g,d=1,m=g,b=0,a=1;b!=m;)e*=g,a*=-1,m=(b=m)+a*e/++d;return m}return Math.log(1+g)};$jscomp.math.expm1=function(g){g=Number(g);if(.25>g&&-.25<g){for(var e=g,d=1,m=g,b=0;b!=m;)e*=g/++d,m=(b=m)+e;return m}return Math.exp(g)-1};$jscomp.math.cosh=function(g){g=Number(g);return(Math.exp(g)+Math.exp(-g))/2};
$jscomp.math.sinh=function(g){g=Number(g);return 0===g?g:(Math.exp(g)-Math.exp(-g))/2};$jscomp.math.tanh=function(g){g=Number(g);if(0===g)return g;var e=Math.exp(2*-Math.abs(g)),e=(1-e)/(1+e);return 0>g?-e:e};$jscomp.math.acosh=function(g){g=Number(g);return Math.log(g+Math.sqrt(g*g-1))};$jscomp.math.asinh=function(g){g=Number(g);if(0===g)return g;var e=Math.log(Math.abs(g)+Math.sqrt(g*g+1));return 0>g?-e:e};
$jscomp.math.atanh=function(g){g=Number(g);return($jscomp.math.log1p(g)-$jscomp.math.log1p(-g))/2};
$jscomp.math.hypot=function(g,e,d){for(var m=[],b=2;b<arguments.length;++b)m[b-2]=arguments[b];g=Number(g);e=Number(e);for(var a=Math.max(Math.abs(g),Math.abs(e)),c=$jscomp.makeIterator(m),b=c.next();!b.done;b=c.next())a=Math.max(a,Math.abs(b.value));if(1E100<a||1E-100>a){g/=a;e/=a;c=g*g+e*e;m=$jscomp.makeIterator(m);for(b=m.next();!b.done;b=m.next())b=b.value,b=Number(b)/a,c+=b*b;return Math.sqrt(c)*a}a=g*g+e*e;m=$jscomp.makeIterator(m);for(b=m.next();!b.done;b=m.next())b=b.value,a+=b*b;return Math.sqrt(a)};
$jscomp.math.trunc=function(g){g=Number(g);if(isNaN(g)||Infinity===g||-Infinity===g||0===g)return g;var e=Math.floor(Math.abs(g));return 0>g?-e:e};$jscomp.math.cbrt=function(g){if(0===g)return g;g=Number(g);var e=Math.pow(Math.abs(g),1/3);return 0>g?-e:e};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g};$jscomp.number.isInteger=function(g){return $jscomp.number.isFinite(g)?g===Math.floor(g):!1};
$jscomp.number.isNaN=function(g){return"number"===typeof g&&isNaN(g)};$jscomp.number.isSafeInteger=function(g){return $jscomp.number.isInteger(g)&&Math.abs(g)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(g,e){for(var d=[],m=1;m<arguments.length;++m)d[m-1]=arguments[m];d=$jscomp.makeIterator(d);for(m=d.next();!m.done;m=d.next()){var m=m.value,b;for(b in m)Object.prototype.hasOwnProperty.call(m,b)&&(g[b]=m[b])}return g};$jscomp.object.is=function(g,e){return g===e?0!==g||1/g===1/e:g!==g&&e!==e};$jscomp.Set=function(g){g=void 0===g?[]:g;this.map_=new $jscomp.Map;if(g){g=$jscomp.makeIterator(g);for(var e=g.next();!e.done;e=g.next())this.add(e.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var g=$jscomp.global.Set;if(!g||!g.prototype.entries||!Object.seal)return!1;var e=Object.seal({x:4}),g=new g($jscomp.makeIterator([e]));if(g.has(e)||1!=g.size||g.add(e)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var g=g.entries(),d=g.next();if(d.done||d.value[0]!=e||d.value[1]!=e)return!1;d=g.next();return d.done||d.value[0]==e||4!=d.value[0].x||d.value[1]!=d.value[0]?!1:g.next().done};
$jscomp.Set.prototype.add=function(g){this.map_.set(g,g);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(g){g=this.map_["delete"](g);this.size=this.map_.size;return g};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(g){return this.map_.has(g)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(g,e){var d=this;this.map_.forEach(function(m){return g.call(e,m,m,d)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(g,e){if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(g){for(var e=[],d=0;d<arguments.length;++d)e[d-0]=arguments[d];for(var d="",e=$jscomp.makeIterator(e),m=e.next();!m.done;m=e.next()){m=m.value;m=+m;if(0>m||1114111<m||m!==Math.floor(m))throw new RangeError("invalid_code_point "+m);65535>=m?d+=String.fromCharCode(m):(m-=65536,d+=String.fromCharCode(m>>>10&1023|55296),d+=String.fromCharCode(m&1023|56320))}return d};
$jscomp.string.repeat=function(g){var e=this.toString();if(0>g||1342177279<g)throw new RangeError("Invalid count value");g|=0;for(var d="";g;)if(g&1&&(d+=e),g>>>=1)e+=e;return d};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(g){var e=this.toString(),d=e.length;g=Number(g)||0;if(0<=g&&g<d){g|=0;var m=e.charCodeAt(g);if(55296>m||56319<m||g+1===d)return m;g=e.charCodeAt(g+1);return 56320>g||57343<g?m:1024*(m-55296)+g+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(g,e){e=void 0===e?0:e;$jscomp.string.noRegExp_(g,"includes");return-1!==this.toString().indexOf(g,e)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(g,e){e=void 0===e?0:e;$jscomp.string.noRegExp_(g,"startsWith");var d=this.toString();g+="";for(var m=d.length,b=g.length,a=Math.max(0,Math.min(e|0,d.length)),c=0;c<b&&a<m;)if(d[a++]!=g[c++])return!1;return c>=b};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(g,e){$jscomp.string.noRegExp_(g,"endsWith");var d=this.toString();g+="";void 0===e&&(e=d.length);for(var m=Math.max(0,Math.min(e|0,d.length)),b=g.length;0<b&&0<m;)if(d[--m]!=g[--b])return!1;return 0>=b};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
(function(g){function e(m){if(d[m])return d[m].exports;var b=d[m]={exports:{},id:m,loaded:!1};g[m].call(b.exports,b,b.exports,e);b.loaded=!0;return b.exports}var d={};e.m=g;e.c=d;e.p="";return e(0)})([function(g,e,d){d(1);d(70);d(71);d(73);d(74);g.exports=d(76)},function(g,e,d){function m(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+
typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}function c(a,c){return a.getChunkSource(E,x.stableStringify(c),function(){return new E(a,c)})}function f(a,c){var f=x.stableStringify({instance:a,key:c}),b=G.get(f);if(void 0!==b)return b;b=Promise.all([p.makeRequest(a,"GET",
"/v1beta2/volumes/"+c,"json"),p.makeRequest(a,"GET","/v1beta2/objects/"+c+"/meshes","json")]).then(function(f){f=n(f,2);return new D(a,c,f[0],f[1])});G.set(f,b);return b}function k(a){var c=K.get(a);if(void 0===c){var c=p.makeRequest(a,"GET","/v1beta2/volumes/","json").then(function(a){return new F(a)}),f="Google "+p.INSTANCE_NAMES[a]+" volume list";u.StatusMessage.forPromise(c,{delay:!0,initialMessage:"Retrieving "+f+".",errorPrefix:"Error retrieving "+f+": "});K.set(a,c)}return c}function l(a,c){return k(a).then(function(a){var f=
c.lastIndexOf(":")+1,b=c.substring(0,f),f=c.substring(f);a=a.hierarchicalVolumeIds.get(b);return void 0===a?null:{offset:b.length,completions:w.getPrefixMatches(f,a)}})}function h(a){var c="brainmaps";a!==p.PRODUCTION_INSTANCE&&(c+="-"+p.INSTANCE_IDENTIFIERS[a].toLowerCase());q.registerDataSourceFactory(c,{description:"Google "+p.INSTANCE_NAMES[a]+" API",getVolume:f.bind(void 0,a),volumeCompleter:l.bind(void 0,a)})}var n=function(){return function(a,c){if(Array.isArray(a))return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var f=[],b=!0,k=!1,n=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(b=(l=h.next()).done)&&(f.push(l.value),!c||f.length!==c);b=!0);}catch(v){k=!0,n=v}finally{try{if(!b&&h["return"])h["return"]()}finally{if(k)throw n;}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),v=function(){function a(c,f){for(var b=0;b<f.length;b++){var k=f[b];k.enumerable=k.enumerable||
!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(c,k.key,k)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();d(2);var p=d(13),A=d(16),q=d(17),r=d(19);g=d(34);var w=d(18),u=d(4),y=d(21),x=d(11);d=d(56);var t=new Map;t.set("UINT8",r.DataType.UINT8);t.set("FLOAT",r.DataType.FLOAT32);t.set("UINT64",r.DataType.UINT64);var B=function N(c){a(this,N);try{x.verifyObject(c),this.numChannels=x.verifyPositiveInt(c.channelCount),this.dataType=x.verifyMapKey(c.channelType,
t),this.voxelSize=x.parseXYZ(y.vec3.create(),c.pixelSize,x.verifyFinitePositiveFloat),this.upperVoxelBound=x.parseXYZ(y.vec3.create(),c.volumeSize,x.verifyPositiveInt)}catch(f){throw Error("Failed to parse BrainMaps volume geometry: "+f.message);}};e.VolumeInfo=B;var C=function(c){function f(c,b,k){a(this,f);b=m(this,Object.getPrototypeOf(f).call(this,c,b));b.parameters=k;b.initializeCounterpart(c.rpc,{type:"brainmaps/VolumeChunkSource",parameters:k});return b}b(f,c);v(f,[{key:"toString",value:function(){return A.volumeSourceToString(this.parameters)}}]);
return f}(g.VolumeChunkSource);e.VolumeChunkSource=C;var z=function M(c){a(this,M);x.verifyObject(c);this.name=x.verifyObjectProperty(c,"name",x.verifyString);this.type=x.verifyObjectProperty(c,"type",x.verifyString)};e.MeshInfo=z;var D=function(){function f(c,b,k,n){a(this,f);this.instance=c;this.volume_id=b;try{x.verifyObject(k);var h=this.scales=x.verifyObjectProperty(k,"geometry",function(a){return x.parseArray(a,function(a){return new B(a)})});if(0===h.length)throw Error("Expected at least one scale.");
var l=h[0],v=this.numChannels=l.numChannels,p=this.dataType=l.dataType;c=1;for(var d=h.length;c<d;++c){var t=h[c];if(t.dataType!==p)throw Error("Scale "+c+" has data type "+r.DataType[t.dataType]+" but scale 0 has data type "+r.DataType[p]+".");if(t.numChannels!==v)throw Error("Scale "+c+" has "+t.numChannels+" channel(s) but scale 0 has "+v+" channels.");}var A=r.VolumeType.UNKNOWN;if(1===v)switch(p){case r.DataType.UINT64:A=r.VolumeType.SEGMENTATION;break;case r.DataType.UINT8:case r.DataType.FLOAT32:A=
r.VolumeType.IMAGE}this.volumeType=A}catch(q){throw Error("Failed to parse BrainMaps multiscale volume specification: "+q.message);}try{x.verifyObject(n),this.meshes=x.verifyObjectProperty(n,"meshes",function(a){return void 0===a?[]:x.parseArray(a,function(a){return new z(a)})})}catch(q){throw Error("Failed to parse BrainMaps meshes specification: "+q.message);}}v(f,[{key:"getSources",value:function(a){var c=this,f=A.VolumeChunkEncoding.RAW;this.volumeType===r.VolumeType.SEGMENTATION?f=A.VolumeChunkEncoding.COMPRESSED_SEGMENTATION:
this.volumeType===r.VolumeType.IMAGE&&this.dataType===r.DataType.UINT8&&(f=A.VolumeChunkEncoding.JPEG);return this.scales.map(function(b,k){return Array.from(r.VolumeChunkSpecification.getDefaults({voxelSize:b.voxelSize,dataType:b.dataType,numChannels:b.numChannels,lowerVoxelBound:y.vec3.fromValues(0,0,0),upperVoxelBound:b.upperVoxelBound,volumeType:c.volumeType})).map(function(b){var n={instance:c.instance,volume_id:c.volume_id,scaleIndex:k,encoding:f};return a.getChunkSource(C,x.stableStringify(n),
function(){return new C(a,b,n)})})})}},{key:"getMeshSource",value:function(a){var f=this.meshes.find(function(a){return"TRIANGLES"===a.type});return void 0===f?null:c(a,{instance:this.instance,volume_id:this.volume_id,mesh_name:f.name})}}]);return f}();e.MultiscaleVolumeChunkSource=D;var E=function(c){function f(c,b){a(this,f);var k=m(this,Object.getPrototypeOf(f).call(this,c));k.parameters=b;k.initializeCounterpart(k.chunkManager.rpc,{type:"brainmaps/MeshSource",parameters:b});return k}b(f,c);v(f,
[{key:"toString",value:function(){return A.meshSourceToString(this.parameters)}}]);return f}(d.MeshSource);e.MeshSource=E;e.getMeshSource=c;var G=new Map;e.getVolume=f;var F=function J(c){a(this,J);this.hierarchicalVolumeIds=new Map;try{x.verifyObject(c);var f=this.volumeIds=x.parseArray(c.volumeId,x.verifyString);f.sort();for(var b=new Map,k=$jscomp.makeIterator(f),h=k.next();!h.done;h=k.next()){var l=h.value;for(c=0;;){var v=l.indexOf(":",c);-1===v?v=void 0:++v;var p=l.substring(0,c),d=b.get(p);
void 0===d&&(d=new Set,b.set(p,d));d.add(l.substring(c,v));if(void 0===v)break;c=v}}for(var B=this.hierarchicalVolumeIds,t=$jscomp.makeIterator(b),A=t.next();!A.done;A=t.next()){var q=n(A.value,2);B.set(q[0],Array.from(q[1]))}}catch(e){throw Error("Failed to parse Brain Maps volume list reply: "+e.message);}};e.VolumeList=F;var K=new Map;e.getVolumeList=k;e.volumeCompleter=l;e.registerBrainmapsDataSource=h;h(p.PRODUCTION_INSTANCE)},function(g,e,d){var m=d(3),b=d(4),a=d(6);g=d(7);var c=d(9),f=0;m.implementation.getNewTokenPromise=
function(){var k=new b.StatusMessage(!0),l=void 0,h=new Promise(function(b){function h(){var a=1>=arguments.length||void 0===arguments[1]?"Request authorization.":arguments[1];k.setText((0>=arguments.length||void 0===arguments[0]?"Brain Maps authorization required.":arguments[0])+"  ");var c=document.createElement("button");c.textContent=a;k.element.appendChild(c);c.addEventListener("click",function(){p(!1)});k.setVisible(!0)}function p(k){void 0!==l&&a.cancelPromise(l);h("Waiting for Brain Maps authorization...",
"Retry");l=c.authenticateGoogleOAuth2({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",scopes:["https://www.googleapis.com/auth/brainmaps"],immediate:k});l.then(function(a){a.generationId=f++;b(a)},function(a){k?h():h("Brain Maps authorization failed: "+a+".","Retry")});a.callFinally(l,function(){l=void 0})}p(!0)});a.callFinally(h,function(){k.dispose()});return h};g.registerRPC("brainmaps.requestToken",function(a){var c=this;m.getToken(a.invalidToken).then(function(a){c.invoke("brainmaps.receiveToken",
{authResult:a})})})},function(g,e){var d=function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");};e.Implementation=d;e.implementation=new d;var m=null,b=null;e.getToken=function(c){if(null!==m&&(null===b||null==c||c.generationId!==b.generationId))return m;b=null;m=e.implementation.getNewTokenPromise(c);m.then(function(c){b=c});return m}},function(g,e,d){var m=function(){function a(a,f){for(var b=0;b<f.length;b++){var l=f[b];l.enumerable=l.enumerable||!1;l.configurable=
!0;"value"in l&&(l.writable=!0);Object.defineProperty(a,l.key,l)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();d(5);var b=null;e.DEFAULT_STATUS_DELAY=200;g=function(){function a(){var c=0>=arguments.length||void 0===arguments[0]?!1:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");null===b&&(b=document.createElement("ul"),b.id="statusContainer",document.body.appendChild(b));var f=document.createElement("li");this.element=f;!0===c&&(c=
e.DEFAULT_STATUS_DELAY);!1!==c?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,!0),c)):this.timer=null;b.appendChild(f)}m(a,[{key:"dispose",value:function(){b.removeChild(this.element);this.element=null;null!==this.timer&&clearTimeout(this.timer)}},{key:"setText",value:function(a,f){this.element.textContent=a;f&&this.setVisible(!0)}},{key:"setHTML",value:function(a,f){this.element.innerHTML=a;f&&this.setVisible(!0)}},{key:"setVisible",value:function(a){this.timer=null;this.element.style.display=
a?"block":"none"}}],[{key:"forPromise",value:function(c,f){var b=new a(f.delay);b.setText(f.initialMessage);var l=b.dispose.bind(b);c.then(l,function(a){var c=void 0,c=a instanceof Error?a.message:""+a;a=f.errorPrefix;b.element.textContent=(void 0===a?"":a)+c+"  ";c=document.createElement("button");c.textContent="Dismiss";c.addEventListener("click",function(){b.dispose()});b.element.appendChild(c);b.setVisible(!0)});return c}}]);return a}();e.StatusMessage=g},function(g,e){},function(g,e){function d(a){var f=
!1,b=void 0,l=void 0,h=new Promise(function(n,h){function p(a){f||(f=!0,n(a))}function d(a){f||(f=!0,h(a))}function q(a){if(f)try{a()}catch(c){}}try{a(p,d,q)}catch(r){d(r)}l=function(){if(!f){f=!0;if(void 0!==b){try{b()}catch(a){}b=void 0}h(e.CANCELLED)}}});h.cancel=l;return h}function m(a){if(null!=a){var f=a.cancel;void 0!==f&&f.call(a)}}var b=function(){function a(c,b){for(var l=0;l<b.length;l++){var h=b[l];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(c,
h.key,h)}}return function(f,b,l){b&&a(f.prototype,b);l&&a(f,l);return f}}(),a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");}b(a,[{key:"toString",value:function(){return"CancellationError"}}]);return a}();e.CancellationError=a;e.CANCELLED=new a;e.makeCancellablePromise=d;e.cancelPromise=m;e.callFinally=function(a,f){return d(function(b,l,h){h(function(){m(a)});a.then(function(a){h(void 0);Promise.resolve(f(h)).then(function(){b(a)})},function(a){h(void 0);
try{Promise.resolve(f(h)).then(function(){l(a)},l)}catch(c){l(c)}})})};e.cancellableThen=function(a,f){return d(function(b,l,h){var n=!1;h(function(){n=!0;m(a)});a.then(function(a){n?l(e.CANCELLED):(h(void 0),b(f(a,h)))})})}},function(g,e,d){function m(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+
typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}function c(a,c){l.set(a,c)}var f=function v(a,c,f){null===a&&(a=Function.prototype);var b=Object.getOwnPropertyDescriptor(a,c);if(void 0===b)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,c,f);if("value"in b)return b.value;
c=b.get;return void 0===c?void 0:c.call(f)},k=function(){function a(c,f){for(var b=0;b<f.length;b++){var k=f[b];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(c,k.key,k)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();g=d(8);var l=new Map;e.registerRPC=c;d=function(){function c(f){var b=this;a(this,c);this.target=f;this.objects=new Map;this.nextId=0;f.onmessage=function(a){a=a.data;l.get(a.functionName).call(b,a)}}k(c,[{key:"set",
value:function(a,c){this.objects.set(a,c)}},{key:"delete",value:function(a){this.objects.delete(a)}},{key:"get",value:function(a){return this.objects.get(a)}},{key:"getRef",value:function(a){var c=this.get(a.id);c.referencedGeneration=a.gen;c.addRef();return c}},{key:"invoke",value:function(a,c,f){c.functionName=a;this.target.postMessage(c,f)}},{key:"newId",value:function(){return this.nextId++}},{key:"numObjects",get:function(){return this.objects.size}}]);return c}();e.RPC=d;g=function(c){function h(){a(this,
h);for(var c=arguments.length,f=Array(c),b=0;b<c;b++)f[b]=arguments[b];var k,c=m(this,(k=Object.getPrototypeOf(h)).call.apply(k,[].concat([this],$jscomp.arrayFromIterable(f))));c.rpc=null;c.rpcId=null;return c}b(h,c);k(h,[{key:"initializeSharedObject",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?a.newId():arguments[1];this.rpc=a;this.rpcId=c;this.isOwner=!1;a.set(c,this)}},{key:"initializeCounterpart",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];
this.initializeSharedObject(a);this.referencedGeneration=this.unreferencedGeneration=0;this.isOwner=!0;c.id=this.rpcId;a.invoke("SharedObject.new",c)}},{key:"dispose",value:function(){f(Object.getPrototypeOf(h.prototype),"dispose",this).call(this)}},{key:"addCounterpartRef",value:function(){return{id:this.rpcId,gen:++this.referencedGeneration}}},{key:"refCountReachedZero",value:function(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?
this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):f(Object.getPrototypeOf(h.prototype),"refCountReachedZero",this).call(this)}},{key:"ownerDispose",value:function(){var a=this.rpc,c=this.rpcId;f(Object.getPrototypeOf(h.prototype),"refCountReachedZero",this).call(this);a.delete(c);a.invoke("SharedObject.dispose",{id:c})}},{key:"counterpartRefCountReachedZero",value:function(a){this.unreferencedGeneration=a;0===this.refCount&&a===this.referencedGeneration&&
this.ownerDispose()}}]);return h}(g.RefCounted);e.SharedObject=g;g=function(c){function f(c){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];a(this,f);var k=m(this,Object.getPrototypeOf(f).call(this));null!=c&&k.initializeSharedObject(c,b.id);return k}b(f,c);return f}(g);e.SharedObjectCounterpart=g;c("SharedObject.dispose",function(a){a=this.get(a.id);if(0!==a.refCount)throw Error("Attempted to dispose object with non-zero reference count.");a.disposed();this.delete(a.rpcId);a.rpcId=
null;a.rpc=null});c("SharedObject.refCountReachedZero",function(a){this.get(a.id).counterpartRefCountReachedZero(a.gen)});var h=new Map;e.registerSharedObject=function(a,c){h.set(a,c)};c("SharedObject.new",function(a){--(new (h.get(a.type))(this,a)).refCount})},function(g,e){var d=function(){function b(a,c){for(var f=0;f<c.length;f++){var b=c[f];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}return function(a,c,f){c&&b(a.prototype,c);
f&&b(a,f);return a}}(),m=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.refCount=1}d(b,[{key:"addRef",value:function(){++this.refCount;return this}},{key:"dispose",value:function(){0===--this.refCount&&this.refCountReachedZero()}},{key:"refCountReachedZero",value:function(){this.disposed();var a=this.disposers;if(null!=a){for(var c=a.length;0<c;--c){var f=a[c-1];"object"===typeof f?f.dispose():f.call(this)}this.disposers=null}}},{key:"disposed",
value:function(){}},{key:"registerDisposer",value:function(a){var c=this.disposers;null==c?this.disposers=[a]:c.push(a);return a}},{key:"unregisterDisposer",value:function(a){var c=this.disposers;if(null!=c){var f=c.indexOf(a);-1!==f&&c.splice(f,1)}return a}},{key:"registerSignalBinding",value:function(a){this.registerDisposer(function(){return a.detach()})}},{key:"registerEventListener",value:function(a,c,f,b){a.addEventListener(c,f,b);this.registerDisposer(function(){return a.removeEventListener(c,
f,b)})}}]);return b}();e.RefCounted=m},function(g,e,d){function m(a,c){var f=document.createElement("iframe");f.style.display="none";f.id=a;f.name=a;f.src="https://accounts.google.com/o/oauth2/postmessageRelay?parent="+encodeURIComponent(location.origin)+"#rpctoken="+c;document.body.appendChild(f)}var b=function(){function a(c,f){for(var b=0;b<f.length;b++){var k=f[b];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(c,k.key,k)}}return function(c,f,
b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),a=d(10),c=d(11),f=d(6),k=d(12);e.AUTH_SERVER="https://accounts.google.com/o/oauth2/auth";e.embedRelayFrame=m;var l=function(){function a(){var f=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.proxyName="postmessageRelay"+k.getRandomHexString();this.rpcToken=""+k.getRandomHexString();this.relayReadyService="oauth2relayReady:"+this.rpcToken;this.oauth2CallbackService="oauth2callback:"+this.rpcToken;this.pendingRequests=
new Map;m(this.proxyName,this.rpcToken);this.relayReadyPromise=new Promise(function(a){addEventListener("message",function(b){if("https://accounts.google.com"===b.origin)try{var k=c.verifyObject(JSON.parse(b.data)),h=c.verifyString(k.s);h===f.relayReadyService&&a();if(h===f.oauth2CallbackService){var n=c.parseArray(k.a,function(a){return a}),l=c.verifyString(n[0]),d=location.origin;if(!l.startsWith(d+"#")&&!l.startsWith(d+"?"))throw Error("oauth2callback: URL "+JSON.stringify(l)+" does not match current origin "+
d+".");for(var e=l.substring(d.length+1).split("&"),t=new Map,B=$jscomp.makeIterator(e),C=B.next();!C.done;C=B.next()){var z=C.value.match("^([a-z_]+)=(.*)$");if(null===z)throw Error("oauth2callback: URL part "+JSON.stringify(z)+" does not match expected pattern.");t.set(z[1],z[2])}var g=t.get("state");if(void 0===g)throw Error("oauth2callback: State argument is missing.");var m=f.pendingRequests.get(g);if(void 0!==m){var G=t.get("error");if(void 0!==G){f.pendingRequests.delete(g);var F=t.get("error_subtype"),
k=G;void 0!==F&&(k+=": "+F);m.reject(k)}else{var K=t.get("access_token"),L=t.get("token_type"),N=t.get("expires_in"),M=t.get("scope");if(void 0===K||void 0===L||void 0===N||void 0===M)throw Error("oauth2callback: URL lacks expected parameters.");f.pendingRequests.delete(g);m.resolve({accessToken:K,tokenType:L,expiresIn:N,scope:M})}}}}catch(J){throw Error("Invalid message received from https://accounts.google.com: "+JSON.stringify(b.data)+": "+J.message+".");}})})}b(a,[{key:"getAuthPromise",value:function(a){var c=
this,b=f.makeCancellablePromise(function(f,b){c.pendingRequests.set(a,{resolve:f,reject:b})});f.callFinally(b,function(){c.pendingRequests.delete(a)});return b}},{key:"makeAuthRequestUrl",value:function(a){var c=e.AUTH_SERVER+"?client_id="+encodeURIComponent(a.clientId),c=c+"&redirect_uri=postmessage&response_type=token",f=a.origin,c=c+("&origin="+encodeURIComponent(void 0===f?location.origin:f)),c=c+("&proxy="+this.proxyName),c=c+"&include_granted_scopes=true",c=c+("&scope="+encodeURIComponent(a.scopes.join(" ")));
a.state&&(c+="&state="+a.state);a.approvalPrompt&&(c+="&approval_prompt="+encodeURIComponent(a.approvalPrompt));a.loginHint&&(c+="&login_hint="+encodeURIComponent(a.loginHint));a.immediate&&(c+="&immediate=true");return c}}]);return a}(),h=void 0;e.authenticateGoogleOAuth2=function(c){var b=k.getRandomHexString(),p;void 0===h&&(h=new l);p=h;var d=p.makeAuthRequestUrl({state:b,clientId:c.clientId,scopes:c.scopes,approvalPrompt:c.approvalPrompt,loginHint:c.loginHint,immediate:c.immediate}),e=p.getAuthPromise(b);
c.immediate?p.relayReadyPromise.then(function(){var c=document.createElement("iframe");c.src=d;c.style.display="none";document.body.appendChild(c);f.callFinally(e,function(){a.removeFromParent(c)})}):function(){var a=open(d);f.callFinally(e,function(){a.close()})}();return e}},function(g,e){e.removeChildren=function(d){for(;;){var e=d.firstElementChild;if(!e)break;d.removeChild(e)}};e.removeFromParent=function(d){var e=d.parentElement;return e?(e.removeChild(d),!0):!1}},function(g,e){function d(a){var c=
typeof a;if("number"===c||"string"===c)if(c=parseFloat(""+a),!Number.isNaN(c))return c;throw Error("Expected floating-point number, but received: "+JSON.stringify(a)+".");}function m(a){if("object"===typeof a){if(null===a)return"null";if(Array.isArray(a)){var c="[",f=a.length,b=0;if(b<f)for(c+=m(a[b]);++b<f;)c+=",",c+=m(a[b]);return c+"]"}var c="{",f=Object.keys(a).sort(),b=0,k=f.length;if(b<k)for(var h=f[b],c=c+JSON.stringify(h),c=c+":"+m(a[h]);++b<k;)c+=",",h=f[b],c+=JSON.stringify(h),c+=":",c+=
m(a[h]);return c+="}"}return JSON.stringify(a)}function b(a){return a.replace(/['"]/g,function(a){return'"'===a?"'":'"'})}function a(a){return b(JSON.stringify(b(a)))}function c(f){if("object"===typeof f){if(null===f)return"null";var b=f.toJSON;if("function"===typeof b)return c(b.call(f));if(Array.isArray(f)){var b="[",k=f.length,h=0;if(h<k)for(b+=c(f[h]);++h<k;)b+="_",b+=c(f[h]);return b+"]"}for(var b="{",h=Object.keys(f),k=!0,h=$jscomp.makeIterator(h),l=h.next();!l.done;l=h.next()){var l=l.value,
n=f[l];void 0!==n&&(n=c(n))&&(k?k=!1:b+="_",b+=a(l),b+=":",b+=n)}return b+"}"}return"string"===typeof f?a(f):JSON.stringify(f)}function f(a,c,f,b){if(2<=a.length&&a.charAt(0)===c&&a.charAt(a.length-1)===c){a=a.substr(1,a.length-2);for(c=f;0<a.length;){var k=a.match(b);if(null===k){c+=a;break}c+=k[1];c+="\\";c+=f;a=a.substr(k.index+k[0].length)}return c+f}return a}function k(a){return f(a,"'",'"',x)}function l(a,c,b){var k=/[&_,]/g,h=void 0,l=void 0,n=void 0;'"'===b?(h="'",l=x,n=u):(h='"',l=t,n=y);
for(var v="";0<a.length;){var p=a.match(n),d=void 0,e=void 0;null===p?(d=a,e=a=""):(d=a.substr(0,p.index),a=a.substr(p.index+p[0].length),e=p[1],e=void 0!==e?f(e,h,b,l):p[2]);v+=d.replace(k,c);v+=e}return v}function h(a){return l(a,",",'"')}function n(a){return JSON.parse(h(a))}function v(a){for(var c="";0<a.length;){var f=a.match(u),b=void 0,h=void 0;null===f?(b=a,h=a=""):(b=a.substr(0,f.index),a=a.substr(f.index+f[0].length),h=f[1],h=void 0!==h?k(h):f[2]);c+=b.replace(/\(/g,"[").replace(/\)/g,"]").replace("True",
"true").replace("False","false").replace(/,\s*([\}\]])/g,"$1");c+=h}return c}function p(a){if("object"!==typeof a||null==a||Array.isArray(a))throw Error("Expected JSON object, but received: "+JSON.stringify(a)+".");return a}function A(a){var c=parseInt(a,10);if(!Number.isInteger(c))throw Error("Expected integer, but received: "+JSON.stringify(a)+".");return c}function q(a){if("string"!==typeof a)throw Error("Expected string, but received: "+JSON.stringify(a)+".");return a}e.verifyFloat=d;e.verifyFinitePositiveFloat=
function(a){a=d(a);if(Number.isFinite(a)&&0<a)return a;throw Error("Expected positive finite floating-point number, but received: "+a+".");};e.parseXYZ=function(a,c){var f=2>=arguments.length||void 0===arguments[2]?d:arguments[2];p(c);var b=Object.keys(c);b.sort();if(3!==b.length||"x"!==b[0]||"y"!==b[1]||"z"!==b[2])throw Error("Expected object to have keys ['x', 'y', 'z'], but received: "+JSON.stringify(c)+".");a[0]=f(c.x);a[1]=f(c.y);a[2]=f(c.z);return a};e.parseFiniteVec=function(a,c){var f=a.length;
if(!Array.isArray(c)||c.length!==f)throw Error("Incompatible sizes");for(var b=0;b<f;++b)if(!Number.isFinite(parseFloat(c[b])))throw Error("Non-finite value.");for(b=0;b<f;++b)a[b]=parseFloat(c[b]);return a};e.parseIntVec=function(a,c){var f=a.length;if(!Array.isArray(c)||c.length!==f)throw Error("Incompatible sizes.");for(var b=0;b<f;++b){var k=parseInt(c[b],void 0);if(!Number.isInteger(k))throw Error("Non-integer value.");}for(b=0;b<f;++b)a[b]=parseInt(c[b],void 0);return a};e.stableStringify=m;
e.urlSafeStringifyString=a;e.urlSafeStringify=c;var r=/('(?:[^'\\]|(?:\\.))*')/,w=/("(?:[^'\\]|(?:\\.))*")/,u=new RegExp(r.source+"|"+w.source),y=new RegExp(w.source+"|"+r.source),x=/^((?:[^"'\\]|(?:\\.))*)"/,t=/^((?:[^"'\\]|(?:\\.))*)'/;e.normalizeStringLiteral=k;e.urlSafeToJSON=h;e.jsonToUrlSafe=function(a){return l(a,"_","'")};e.urlSafeParse=n;e.pythonLiteralToJSON=v;e.pythonLiteralParse=function(a){return JSON.parse(v(a))};e.parseArray=function(a,c){if(!Array.isArray(a))throw Error("Expected array, but received: "+
JSON.stringify(a)+".");return a.map(c)};e.parseFixedLengthArray=function(a,c,f){var b=a.length;if(!Array.isArray(c)||c.length!==b)throw Error("Expected length "+b+" array, but received: "+JSON.stringify(c)+".");for(var k=0;k<b;++k)a[k]=f(c[k],k);return a};e.verifyObject=p;e.verifyInt=A;e.verifyPositiveInt=function(a){a=A(a);if(0>=a)throw Error("Expected positive integer, but received: "+a+".");return a};e.verifyMapKey=function(a,c){var f=c.get(a);if(void 0===f)throw Error("Expected one of "+JSON.stringify(Array.from(c.keys()))+
", but received: "+JSON.stringify(a)+".");return f};e.verifyString=q;e.verifyOptionalString=function(a){return void 0===a?void 0:q(a)};e.verifyObjectProperty=function(a,c,f){a=a.hasOwnProperty(c)?a[c]:void 0;try{return f(a)}catch(b){throw Error("Error parsing "+JSON.stringify(c)+" property: "+b.message);}};e.verifyObjectAsMap=function(a,c){p(a);for(var f=new Map,b=$jscomp.makeIterator(Object.keys(a)),k=b.next();!k.done;k=b.next()){k=k.value;try{f.set(k,c(a[k]))}catch(h){throw Error("Error parsing value associated with key "+
JSON.stringify(k)+": "+h.message);}}return f};e.verifyFloat01=function(a){if("number"!==typeof a||!Number.isFinite(a)||0>a||1<a)throw Error("Expected floating point number in [0,1], but received: "+JSON.stringify(a)+".");return a};e.parseQueryStringParameters=function(a){if(""===a)return{};if(a.startsWith("{"))return n(a);var c={};a=a.split(/[&;]/);a=$jscomp.makeIterator(a);for(var f=a.next();!f.done;f=a.next()){var f=f.value,b=f.match(/^([^=&;]+)=([^&;]*)$/);if(null===b)throw Error("Invalid query string part: "+
JSON.stringify(f)+".");c[b[1]]=b[2]}return c}},function(g,e){e.getRandomHexString=function(){var d=Math.ceil((0>=arguments.length||void 0===arguments[0]?128:arguments[0])/32),e=new Uint32Array(d);crypto.getRandomValues(e);for(var b="",a=0;a<d;++a)b+=("00000000"+e[a].toString(16)).slice(-8);return b}},function(g,e,d){function m(a,c,b,h){e.INSTANCE_IDENTIFIERS[a]=b;e.INSTANCE_NAMES[a]=h;b=["https://"+c];for(h=0;9>=h;++h)b.push("https://s"+h+"-"+c);e.INSTANCE_BASE_URLS[a]=b}var b=d(3),a=d(14),c=d(6);
e.numPendingRequests=0;e.PRODUCTION_INSTANCE=0;e.INSTANCE_NAMES=[];e.INSTANCE_BASE_URLS=[];e.INSTANCE_IDENTIFIERS=[];e.brainmapsInstanceKey=function(a){return e.INSTANCE_IDENTIFIERS[a]};e.setupBrainmapsInstance=m;m(e.PRODUCTION_INSTANCE,"brainmaps.googleapis.com","prod","Brain Maps");e.makeRequest=function(f,k,l,h){var n=void 0;return c.makeCancellablePromise(function(c,p,d){function q(d){null===n?--e.numPendingRequests:(n=a.openShardedHttpRequest(e.INSTANCE_BASE_URLS[f],l,k),n.responseType=h,n.setRequestHeader("Authorization",
d.tokenType+" "+d.accessToken),n.onloadend=function(){if(null===n)--e.numPendingRequests;else{var f=this.status;200<=f&&300>f?(--e.numPendingRequests,c(this.response)):403===f||401===f?b.getToken(d).then(q):(--e.numPendingRequests,p(a.HttpError.fromXhr(this)))}},n.send())}d(function(){var a=n;n=null;null!=a&&a.abort()});b.getToken().then(q)})}},function(g,e,d){function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);
a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function b(a,f){if(Array.isArray(a)){var b=a.length,b=1===b?0:Math.abs(c.simpleStringHash(f))%b;return a[b]+f}return a+f}var a=function(){function a(c,f){for(var b=0;b<f.length;b++){var k=f[b];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(c,k.key,k)}}return function(c,f,b){f&&
a(c.prototype,f);b&&a(c,b);return c}}(),c=d(15),f=d(6);$jscomp.initSymbol();e.URL_SYMBOL=Symbol("url");$jscomp.initSymbol();e.METHOD_SYMBOL=Symbol("method");var k=function(c){function f(a,c,b,k){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var l=a+" "+JSON.stringify(c)+" resulted in HTTP error "+b;k&&(l+=": "+k);var l=l+".",d;d=Object.getPrototypeOf(f).call(this,l);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=
!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.name="HttpError";d.message=l;d.method=a;d.url=c;d.code=b;d.statusMessage=k;return d}m(f,c);a(f,null,[{key:"fromXhr",value:function(a){return new f(a[e.METHOD_SYMBOL],a[e.URL_SYMBOL],a.status,a.statusText)}}]);return f}(Error);e.HttpError=k;e.openHttpRequest=function(a){var c=1>=arguments.length||void 0===arguments[1]?"GET":arguments[1],f=new XMLHttpRequest;f[e.METHOD_SYMBOL]=c;f[e.URL_SYMBOL]=a;f.open(c,a);return f};e.pickShard=b;e.openShardedHttpRequest=
function(a,c){var f=2>=arguments.length||void 0===arguments[2]?"GET":arguments[2],k=new XMLHttpRequest,d=b(a,c);k[e.METHOD_SYMBOL]=f;k[e.URL_SYMBOL]=d;k.open(f,d);return k};e.sendHttpRequest=function(a,c){a.responseType=c;return f.makeCancellablePromise(function(c,f,b){a.onloadend=function(){var b=this.status;200<=b&&300>b?c(this.response):f(k.fromXhr(a))};b(function(){a.abort()});a.send()})};e.parseSpecialUrl=function(a){var c=a.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===c)throw Error("Invalid URL: "+
JSON.stringify(a));return"gs"===c[1]?(a=c[2],[["https://"+a+".storage.googleapis.com","https://storage.googleapis.com/"+a],c[3]]):[[a],""]}},function(g,e){e.simpleStringHash=function(d){for(var e=0,b=d.length,a=0;a<b;++a)e=31*e+d.charCodeAt(a)|0;return e}},function(g,e,d){var m=d(13);(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(e.VolumeChunkEncoding||(e.VolumeChunkEncoding={}));var b=e.VolumeChunkEncoding;e.volumeSourceToString=function(a){return"brainmaps-"+
m.brainmapsInstanceKey(a.instance)+":volume/"+a.volume_id+"/"+a.scaleIndex+"/"+b[a.encoding]};e.meshSourceToString=function(a){return"brainmaps:"+m.brainmapsInstanceKey(a.instance)+":mesh/"+a.volume_id+"/"+a.mesh_name}},function(g,e,d){function m(a,c){void 0===c&&(c=-1===a.indexOf("/")?":":"/");var f=a.lastIndexOf(c);return-1===f?0:f+1}function b(a,c){var f=m(a,c);return a.substring(f)}function a(a){a=a.match(h);if(null===a||void 0===a[1])throw Error('Data source URL must have the form "<protocol>://<path>".');
var c=a[1],f=l.get(c);if(void 0===f)throw Error("Unsupported data source: "+JSON.stringify(c)+".");return[f,a[2],c]}var c=function(){return function(a,c){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var f=[],b=!0,k=!1,h=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var l=a[Symbol.iterator](),d;!(b=(d=l.next()).done)&&(f.push(d.value),!c||f.length!==c);b=!0);}catch(e){k=!0,h=e}finally{try{if(!b&&l["return"])l["return"]()}finally{if(k)throw h;
}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=d(6),k=d(18);e.findSourceGroupBasedOnSeparator=m;e.suggestLayerNameBasedOnSeparator=b;var l=new Map;e.registerDataSourceFactory=function(a,c){l.set(a,c)};var h=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/;e.getVolume=function(f){f=a(f);f=c(f,2);return f[0].getVolume(f[1])};e.getMeshSource=function(f,b){var k=2>=arguments.length||void 0===arguments[2]?0:arguments[2],h=a(b),h=c(h,2);return h[0].getMeshSource(f,h[1],k)};
e.getSkeletonSource=function(f,b){var k=a(b),k=c(k,2);return k[0].getSkeletonSource(f,k[1])};e.volumeCompleter=function(a){var b=a.match(h),d=b[1];if(void 0===d){for(var b=[],e=$jscomp.makeIterator(l),q=e.next();!q.done;q=e.next()){var g=c(q.value,2),q=g[0],g=g[1],q=q+"://";q.startsWith(a)&&b.push({value:q,description:g.description})}return Promise.resolve({offset:0,completions:b})}a=l.get(d);return void 0!==a&&(a=a.volumeCompleter,void 0!==a)?f.cancellableThen(a(b[2]),function(a){return k.applyCompletionOffset(d.length+
3,a)}):Promise.reject(null)};e.suggestLayerName=function(f){f=a(f);var k=c(f,2);f=k[1];k=k[0].suggestLayerName;return void 0!==k?k(f):b(f)};e.findSourceGroup=function(f){f=a(f);f=c(f,3);var b=f[2];return(f[0].findSourceGroup||m)(f[1])+b.length+3}},function(g,e){e.applyCompletionOffset=function(d,e){e.offset+=d;return e};e.getPrefixMatches=function(d,e){for(var b=[],a=$jscomp.makeIterator(e),c=a.next();!c.done;c=a.next())c=c.value,c.startsWith(d)&&b.push({value:c});return b};e.getPrefixMatchesWithDescriptions=
function(d,e,b,a){var c=[];e=$jscomp.makeIterator(e);for(var f=e.next();!f.done;f=e.next()){var f=f.value,k=b(f);k.startsWith(d)&&c.push({value:k,description:a(f)})}return c}},function(g,e,d){function m(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c,f){for(var b=0;3>b;++b)a[b]=Number.POSITIVE_INFINITY,c[b]=Number.NEGATIVE_INFINITY;f=$jscomp.makeIterator(f);for(b=f.next();!b.done;b=f.next())for(var k=b.value.spec,b=k.lowerChunkBound,k=k.upperChunkBound,h=0;3>h;++h)a[h]=Math.min(a[h],b[h]),c[h]=Math.max(c[h],k[h])}function c(a,c,f,b){return a>=b||c<=f?r.FULLY_OUTSIDE:a>=f&&c<=b?r.FULLY_INSIDE:r.PARTIALLY_INSIDE}function f(a,f,b,k){for(var h=
r.FULLY_INSIDE,l=0;3>l;++l){var n=c(a[l],f[l],b[l],k[l]);switch(n){case r.FULLY_OUTSIDE:return n;case r.PARTIALLY_INSIDE:h=n}}return h}function k(a,c,f){var b=f.length,k=0;if(1<b)for(var h=0,l=0;l<b;++l){for(var n=f[l],v=0,d=v,p=0;3>p;++p)var e=n.spec.chunkLayout.size[p],v=Math.max(v,e*Math.abs(a[p])),d=Math.max(d,e*Math.abs(c[p]));n=v*d;n>h&&(h=n,k=l)}return f[k]}var l=function(){return function(a,c){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in
Object(a)){var f=[],b=!0,k=!1,h=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var l=a[Symbol.iterator](),n;!(b=(n=l.next()).done)&&(f.push(n.value),!c||f.length!==c);b=!0);}catch(v){k=!0,h=v}finally{try{if(!b&&l["return"])l["return"]()}finally{if(k)throw h;}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),h=function(){function a(c,f){for(var b=0;b<f.length;b++){var k=f[b];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=
!0);Object.defineProperty(c,k.key,k)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),n=d(20),v=d(21),p=d(32),A=d(33);g=d(7);var q=d(21),r;(function(a){a[a.FULLY_OUTSIDE=0]="FULLY_OUTSIDE";a[a.FULLY_INSIDE=1]="FULLY_INSIDE";a[a.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"})(r||(r={}));d=function(n){function d(){m(this,d);var a;a=Object.getPrototypeOf(d).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&
"function"!==typeof a?this:a;a.width=null;a.height=null;a.hasViewportToData=!1;a.hasValidViewport=!1;a.viewportToData=v.mat4.create();a.viewportAxes=[v.vec4.create(),v.vec4.create(),v.vec4.create()];a.previousViewportAxes=[v.vec3.create(),v.vec3.create()];a.centerDataPosition=v.vec3.create();a.viewportPlaneDistanceToOrigin=null;a.visibleChunkLayouts=new Map;a.visibleLayers=new Map;a.visibleSourcesStale=!0;a.pixelSize=null;v.mat4.identity(a.viewportToData);return a}b(d,n);h(d,[{key:"onViewportChanged",
value:function(){}},{key:"maybeSetHasValidViewport",value:function(){!this.hasValidViewport&&null!==this.width&&null!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport());if(this.hasValidViewport)this.onViewportChanged()}},{key:"onHasValidViewport",value:function(){}},{key:"setViewportSize",value:function(a,c){return a!==this.width||c!==this.height?(this.width=a,this.height=c,this.maybeSetHasValidViewport(),!0):!1}},{key:"setViewportToDataMatrix",value:function(a){if(this.hasViewportToData&&
v.mat4.equals(this.viewportToData,a))return!1;this.hasViewportToData=!0;v.mat4.copy(this.viewportToData,a);v.vec3.transformMat4(this.centerDataPosition,q.kZeroVec,a);for(var c=void 0,f=this.viewportAxes,b=this.previousViewportAxes,k=0;3>k;++k){var h=f[k];v.vec4.transformMat4(h,q.kAxes[k],a);0===k&&(c=v.vec3.length(h));v.vec4.normalize(h,h)}this.viewportAxes=f;this.previousViewportAxes=b;if(!p.approxEqual(c,this.pixelSize)||.95>v.vec3.dot(f[0],b[0])||.95>v.vec3.dot(f[1],b[1]))v.vec3.copy(b[0],f[0]),
v.vec3.copy(b[1],f[1]),this.visibleSourcesStale=!0,this.pixelSize=c;this.viewportPlaneDistanceToOrigin=v.vec3.dot(this.centerDataPosition,this.viewportAxes[2]);this.onViewportToDataMatrixChanged();this.maybeSetHasValidViewport();return!0}},{key:"onViewportToDataMatrixChanged",value:function(){}},{key:"updateVisibleSources",value:function(){if(this.visibleSourcesStale){this.visibleSourcesStale=!1;var a=1.1*this.pixelSize,c=this.visibleChunkLayouts,f=l(this.viewportAxes,2),b=f[0],h=f[1],n=this.visibleLayers;
c.clear();for(var f=function(f){d=l(f,2);f=d[0];var n=d[1];n.length=0;f=f.sources;for(var v=f.length,p=void 0,e=f[0][0].spec.voxelSize,q=function(c){for(var f=0;3>f;++f){var b=c[f];if(b>a&&b>e[f])return!0}return!1},A=function(a,f){n[n.length++]=a;var b=a.spec.chunkLayout,k=c.get(b);void 0===k&&(k=new Map,c.set(b,k));k.set(a,v-f-1)},p=v-1;;){var g=k(b,h,f[p]);A(g,p);if(0===p||!q(g.spec.voxelSize))break;--p}n.reverse()},n=$jscomp.makeIterator(n),v=n.next();!v.done;v=n.next()){var d;f(v.value)}}}},{key:"computeVisibleChunks",
value:function(b,k){var h=this;this.updateVisibleSources();for(var l=this.centerDataPosition,n=v.vec3.clone(l),d=v.vec3.clone(l),l=v.vec3.create(),p=$jscomp.makeIterator([-this.width/2,this.width/2]),e=p.next();!e.done;e=p.next())for(var e=e.value,g=$jscomp.makeIterator([-this.height/2,this.height/2]),y=g.next();!y.done;y=g.next())y=y.value,v.vec3.scale(l,q.kAxes[0],e),v.vec3.scaleAndAdd(l,l,q.kAxes[1],y),v.vec3.transformMat4(l,l,this.viewportToData),v.vec3.min(n,n,l),v.vec3.max(d,d,l);for(var x=
v.vec3.create(),u=v.vec3.create(),w=v.vec3.create(),m=this.viewportAxes[2],l=0;3>l;++l)0<m[l]&&(w[l]=1);var H=[],I=[];this.visibleChunkLayouts.forEach(function(l,p){function e(){for(var a=0,c=0,f=0;3>f;++f)var b=y[f],k=m[f],h=x[f],l=u[f]-h,n=w[f]*l,a=a+k*b*(h+n),c=c+k*b*(h+l-n);return a<G?!1:c<=G}function q(a){function f(){L=A.partitionArray(H,0,d,function(f){var b=f.spec;switch(c(x[a],u[a],b.lowerChunkBound[a],b.upperChunkBound[a])){case r.PARTIALLY_INSIDE:return!0;case r.FULLY_INSIDE:I.push(f);
default:return!1}})}if(0!==I.length||0!==L){for(var b=1,h=0;3>h;++h)b*=Math.max(0,u[h]-x[h]);if(0!==b&&e())if(1===b)k(p,g,x,I);else{for(var l;;)if(b=x[a],h=u[a],l=h-b,1===l)a=(a+1)%3;else break;l=b+Math.floor(.5*l);var n=(a+1)%3,v=I.length;u[a]=l;var d=L;f();q(n);u[a]=h;x[a]=l;f();q(n);x[a]=b;I.length=v;L=d}}}var g=b(p),y=p.size,z=p.offset,G=h.viewportPlaneDistanceToOrigin-v.vec3.dot(z,h.viewportAxes[2]);a(x,u,l.keys());for(var F=0;3>F;++F)x[F]=Math.max(x[F],Math.floor((n[F]-z[F])/y[F])),u[F]=Math.min(u[F],
Math.floor((d[F]-z[F])/y[F]+1));I.length=0;H.length=0;z=$jscomp.makeIterator(l.keys());for(F=z.next();!F.done;F=z.next()){var F=F.value,K=F.spec;switch(f(x,u,K.lowerChunkBound,K.upperChunkBound)){case r.FULLY_INSIDE:I.push(F);break;case r.PARTIALLY_INSIDE:H.push(F)}}var L=H.length;q(0)})}}]);return d}(g.SharedObject);e.SliceViewBase=d;(function(a){a[a.UINT8=0]="UINT8";a[a.UINT16=1]="UINT16";a[a.UINT32=2]="UINT32";a[a.UINT64=3]="UINT64";a[a.FLOAT32=4]="FLOAT32"})(e.DataType||(e.DataType={}));var w=
e.DataType;e.DATA_TYPE_BYTES=[];e.DATA_TYPE_BYTES[w.UINT8]=1;e.DATA_TYPE_BYTES[w.UINT16]=2;e.DATA_TYPE_BYTES[w.UINT32]=4;e.DATA_TYPE_BYTES[w.UINT64]=8;e.DATA_TYPE_BYTES[w.FLOAT32]=4;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.IMAGE=1]="IMAGE";a[a.SEGMENTATION=2]="SEGMENTATION"})(e.VolumeType||(e.VolumeType={}));var u=e.VolumeType;e.DEFAULT_CHUNK_DATA_SIZES=[v.vec3.fromValues(64,64,64)];d=function(){function a(c,f,b,k,h,l,n){m(this,a);this.chunkLayout=c;this.chunkDataSize=f;this.numChannels=b;this.dataType=
k;this.lowerVoxelBound=h;this.upperVoxelBound=l;this.compressedSegmentationBlockSize=n;this.chunkBytes=v.prod3(f)*e.DATA_TYPE_BYTES[k]*b;f=this.voxelSize=v.vec3.divide(v.vec3.create(),this.chunkLayout.size,this.chunkDataSize);b=this.lowerChunkBound=v.vec3.create();k=this.upperChunkBound=v.vec3.create();var d=c.size;c=c.offset;for(var p=0;3>p;++p)b[p]=Math.floor((h[p]*f[p]-c[p])/d[p]),k[p]=Math.floor(((l[p]-1)*f[p]-c[p])/d[p]+1);this.compressedSegmentationBlockSize=n}h(a,[{key:"toObject",value:function(a){this.chunkLayout.toObject(a.chunkLayout=
{});a.chunkDataSize=this.chunkDataSize;a.numChannels=this.numChannels;a.dataType=this.dataType;a.lowerVoxelBound=this.lowerVoxelBound;a.upperVoxelBound=this.upperVoxelBound;a.compressedSegmentationBlockSize=this.compressedSegmentationBlockSize}}],[{key:"fromObject",value:function(c){return new a(n.ChunkLayout.fromObject(c.chunkLayout),c.chunkDataSize,c.numChannels,c.dataType,c.lowerVoxelBound,c.upperVoxelBound,c.compressedSegmentationBlockSize)}},{key:"getDefaults",value:function(c){function f(t,
U){for(;;)switch(b){case 0:I=c.voxelSize,H=c.dataType,P=c.lowerVoxelBound,J=c.chunkDataSizes,m=void 0===J?e.DEFAULT_CHUNK_DATA_SIZES:J,r=c.numChannels,g=void 0===r?1:r,A=c.compressedSegmentationBlockSize,q=v.vec3.multiply(v.vec3.create(),P,I),void 0!==A||c.volumeType!==u.SEGMENTATION||H!==w.UINT32&&H!==w.UINT64||(A=v.vec3.fromValues(8,8,8)),p=$jscomp.makeIterator(m),d=p.next();case 1:if(d.done){b=3;break}l=d.value;h=v.vec3.create();v.vec3.multiply(h,I,l);k=n.ChunkLayout.get(h,q);b=4;return{value:new a(k,
l,g,H,P,c.upperVoxelBound,A),done:!1};case 4:if(void 0===U){b=5;break}b=-1;throw U;case 5:case 2:d=p.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,k,h,l,d,p,q,A,g,r,m,J,P,H,I,O={next:function(a){return f(a,void 0)},throw:function(a){return f(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();O[Symbol.iterator]=function(){return this};return O}}]);return a}();e.VolumeChunkSpecification=d},function(g,e,d){var m=function(){function a(a,
f){for(var b=0;b<f.length;b++){var l=f[b];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(a,l.key,l)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),b=d(21);g=function(){function a(c,f){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.size=b.vec3.clone(c);this.offset=void 0===f?b.vec3.create():b.vec3.clone(f)}m(a,[{key:"toObject",value:function(a){a.size=this.size;a.offset=this.offset}}],[{key:"get",
value:function(c){var f=1>=arguments.length||void 0===arguments[1]?b.kZeroVec:arguments[1],k=a.cache,l=b.vec3Key(c)+"+"+b.vec3Key(f),h=k.get(l);void 0===h&&(h=new a(c,f),k.set(l,h));return h}},{key:"fromObject",value:function(c){return a.get(c.size,c.offset)}}]);return a}();g.cache=new Map;e.ChunkLayout=g},function(g,e,d){g=d(22);e.vec2=g.vec2;e.vec3=g.vec3;e.vec4=g.vec4;e.mat2=g.mat2;e.mat3=g.mat3;e.mat4=g.mat4;e.quat=g.quat;d=d(22);e.identityMat4=d.mat4.create();e.AXES_NAMES=["x","y","z"];e.BoundingBox=
function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.lower=a;this.upper=c};e.kAxes=[d.vec4.fromValues(1,0,0,0),d.vec4.fromValues(0,1,0,0),d.vec4.fromValues(0,0,1,0)];e.kZeroVec=d.vec3.fromValues(0,0,0);e.prod3=function(b){return b[0]*b[1]*b[2]};e.prod4=function(b){return b[0]*b[1]*b[2]*b[3]};e.vec3Key=function(b){return b[0]+","+b[1]+","+b[2]}},function(g,e,d){e.glMatrix=d(23);e.mat2=d(24);e.mat2d=d(25);e.mat3=d(26);e.mat4=d(27);e.quat=d(28);e.vec2=
d(31);e.vec3=d(29);e.vec4=d(30)},function(g,e){var d={EPSILON:1E-6};d.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;d.RANDOM=Math.random;d.ENABLE_SIMD=!1;d.SIMD_AVAILABLE=d.ARRAY_TYPE===Float32Array&&"SIMD"in this;d.USE_SIMD=d.ENABLE_SIMD&&d.SIMD_AVAILABLE;d.setMatrixArrayType=function(b){d.ARRAY_TYPE=b};var m=Math.PI/180;d.toRadian=function(b){return b*m};d.equals=function(b,a){return Math.abs(b-a)<=d.EPSILON*Math.max(1,Math.abs(b),Math.abs(a))};g.exports=d},function(g,e,d){var m=
d(23);e={create:function(){var b=new m.ARRAY_TYPE(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var a=new m.ARRAY_TYPE(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},fromValues:function(b,a,c,f){var k=new m.ARRAY_TYPE(4);k[0]=b;k[1]=a;k[2]=c;k[3]=f;return k},set:function(b,a,c,f,k){b[0]=a;b[1]=c;b[2]=f;b[3]=k;return b},transpose:function(b,a){if(b===a){var c=
a[1];b[1]=a[2];b[2]=c}else b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3];return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=c*l-k*f;if(!h)return null;h=1/h;b[0]=l*h;b[1]=-f*h;b[2]=-k*h;b[3]=c*h;return b},adjoint:function(b,a){var c=a[0];b[0]=a[3];b[1]=-a[1];b[2]=-a[2];b[3]=c;return b},determinant:function(b){return b[0]*b[3]-b[2]*b[1]},multiply:function(b,a,c){var f=a[0],k=a[1],l=a[2];a=a[3];var h=c[0],n=c[1],v=c[2];c=c[3];b[0]=f*h+l*n;b[1]=k*h+a*n;b[2]=f*v+l*c;b[3]=k*v+a*c;return b}};e.mul=
e.multiply;e.rotate=function(b,a,c){var f=a[0],k=a[1],l=a[2];a=a[3];var h=Math.sin(c);c=Math.cos(c);b[0]=f*c+l*h;b[1]=k*c+a*h;b[2]=f*-h+l*c;b[3]=k*-h+a*c;return b};e.scale=function(b,a,c){var f=a[1],k=a[2],l=a[3],h=c[0];c=c[1];b[0]=a[0]*h;b[1]=f*h;b[2]=k*c;b[3]=l*c;return b};e.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=-c;b[3]=f;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];return b};e.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+
", "+b[3]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2))};e.LDU=function(b,a,c,f){b[2]=f[2]/f[0];c[0]=f[0];c[1]=f[1];c[3]=f[3]-b[2]*c[1];return[b,a,c]};e.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];return b};e.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];return b};e.sub=e.subtract;e.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===
a[3]};e.equals=function(b,a){var c=b[0],f=b[1],k=b[2],l=b[3],h=a[0],n=a[1],v=a[2],d=a[3];return Math.abs(c-h)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(f-n)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(n))&&Math.abs(k-v)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(v))&&Math.abs(l-d)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(d))};e.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;return b};e.multiplyScalarAndAdd=function(b,a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+
c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;return b};g.exports=e},function(g,e,d){var m=d(23);e={create:function(){var b=new m.ARRAY_TYPE(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var a=new m.ARRAY_TYPE(6);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},fromValues:function(b,a,c,f,k,l){var h=
new m.ARRAY_TYPE(6);h[0]=b;h[1]=a;h[2]=c;h[3]=f;h[4]=k;h[5]=l;return h},set:function(b,a,c,f,k,l,h){b[0]=a;b[1]=c;b[2]=f;b[3]=k;b[4]=l;b[5]=h;return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=a[4],n=a[5],v=c*l-f*k;if(!v)return null;v=1/v;b[0]=l*v;b[1]=-f*v;b[2]=-k*v;b[3]=c*v;b[4]=(k*n-l*h)*v;b[5]=(f*h-c*n)*v;return b},determinant:function(b){return b[0]*b[3]-b[1]*b[2]},multiply:function(b,a,c){var f=a[0],k=a[1],l=a[2],h=a[3],n=a[4];a=a[5];var v=c[0],d=c[1],e=c[2],q=c[3],g=c[4];c=c[5];
b[0]=f*v+l*d;b[1]=k*v+h*d;b[2]=f*e+l*q;b[3]=k*e+h*q;b[4]=f*g+l*c+n;b[5]=k*g+h*c+a;return b}};e.mul=e.multiply;e.rotate=function(b,a,c){var f=a[0],k=a[1],l=a[2],h=a[3],n=a[4];a=a[5];var v=Math.sin(c);c=Math.cos(c);b[0]=f*c+l*v;b[1]=k*c+h*v;b[2]=f*-v+l*c;b[3]=k*-v+h*c;b[4]=n;b[5]=a;return b};e.scale=function(b,a,c){var f=a[1],k=a[2],l=a[3],h=a[4],n=a[5],v=c[0];c=c[1];b[0]=a[0]*v;b[1]=f*v;b[2]=k*c;b[3]=l*c;b[4]=h;b[5]=n;return b};e.translate=function(b,a,c){var f=a[0],k=a[1],l=a[2],h=a[3],n=a[4];a=a[5];
var v=c[0];c=c[1];b[0]=f;b[1]=k;b[2]=l;b[3]=h;b[4]=f*v+l*c+n;b[5]=k*v+h*c+a;return b};e.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=-c;b[3]=f;b[4]=0;b[5]=0;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];b[4]=0;b[5]=0;return b};e.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=a[0];b[5]=a[1];return b};e.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],
2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};e.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];b[4]=a[4]+c[4];b[5]=a[5]+c[5];return b};e.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];b[4]=a[4]-c[4];b[5]=a[5]-c[5];return b};e.sub=e.subtract;e.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;b[4]=a[4]*c;b[5]=a[5]*c;return b};e.multiplyScalarAndAdd=function(b,
a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;b[4]=a[4]+c[4]*f;b[5]=a[5]+c[5]*f;return b};e.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]};e.equals=function(b,a){var c=b[0],f=b[1],k=b[2],l=b[3],h=b[4],n=b[5],v=a[0],d=a[1],e=a[2],q=a[3],g=a[4],w=a[5];return Math.abs(c-v)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(f-d)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(d))&&Math.abs(k-e)<=m.EPSILON*Math.max(1,
Math.abs(k),Math.abs(e))&&Math.abs(l-q)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(q))&&Math.abs(h-g)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(n-w)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(w))};g.exports=e},function(g,e,d){var m=d(23);e={create:function(){var b=new m.ARRAY_TYPE(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},fromMat4:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},clone:function(b){var a=
new m.ARRAY_TYPE(9);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},fromValues:function(b,a,c,f,k,l,h,n,v){var d=new m.ARRAY_TYPE(9);d[0]=b;d[1]=a;d[2]=c;d[3]=f;d[4]=k;d[5]=l;d[6]=h;d[7]=n;d[8]=v;return d},set:function(b,a,c,f,k,l,h,n,d,p){b[0]=a;b[1]=c;b[2]=f;b[3]=k;b[4]=l;b[5]=h;b[6]=n;b[7]=d;b[8]=p;return b},identity:function(b){b[0]=
1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},transpose:function(b,a){if(b===a){var c=a[1],f=a[2],k=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=f;b[7]=k}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=a[4],n=a[5],d=a[6],p=a[7],e=a[8],q=e*h-n*p,g=-e*l+n*d,w=p*l-h*d,u=c*q+f*g+k*w;if(!u)return null;u=1/u;b[0]=q*u;b[1]=(-e*f+k*p)*u;b[2]=(n*f-k*h)*u;b[3]=g*u;b[4]=(e*
c-k*d)*u;b[5]=(-n*c+k*l)*u;b[6]=w*u;b[7]=(-p*c+f*d)*u;b[8]=(h*c-f*l)*u;return b},adjoint:function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=a[4],n=a[5],d=a[6],p=a[7],e=a[8];b[0]=h*e-n*p;b[1]=k*p-f*e;b[2]=f*n-k*h;b[3]=n*d-l*e;b[4]=c*e-k*d;b[5]=k*l-c*n;b[6]=l*p-h*d;b[7]=f*d-c*p;b[8]=c*h-f*l;return b},determinant:function(b){var a=b[3],c=b[4],f=b[5],k=b[6],l=b[7],h=b[8];return b[0]*(h*c-f*l)+b[1]*(-h*a+f*k)+b[2]*(l*a-c*k)},multiply:function(b,a,c){var f=a[0],k=a[1],l=a[2],h=a[3],n=a[4],d=a[5],p=a[6],e=
a[7];a=a[8];var q=c[0],g=c[1],w=c[2],u=c[3],y=c[4],x=c[5],t=c[6],B=c[7];c=c[8];b[0]=q*f+g*h+w*p;b[1]=q*k+g*n+w*e;b[2]=q*l+g*d+w*a;b[3]=u*f+y*h+x*p;b[4]=u*k+y*n+x*e;b[5]=u*l+y*d+x*a;b[6]=t*f+B*h+c*p;b[7]=t*k+B*n+c*e;b[8]=t*l+B*d+c*a;return b}};e.mul=e.multiply;e.translate=function(b,a,c){var f=a[0],k=a[1],l=a[2],h=a[3],n=a[4],d=a[5],p=a[6],e=a[7];a=a[8];var q=c[0];c=c[1];b[0]=f;b[1]=k;b[2]=l;b[3]=h;b[4]=n;b[5]=d;b[6]=q*f+c*h+p;b[7]=q*k+c*n+e;b[8]=q*l+c*d+a;return b};e.rotate=function(b,a,c){var f=
a[0],k=a[1],l=a[2],h=a[3],n=a[4],d=a[5],p=a[6],e=a[7];a=a[8];var q=Math.sin(c);c=Math.cos(c);b[0]=c*f+q*h;b[1]=c*k+q*n;b[2]=c*l+q*d;b[3]=c*h-q*f;b[4]=c*n-q*k;b[5]=c*d-q*l;b[6]=p;b[7]=e;b[8]=a;return b};e.scale=function(b,a,c){var f=c[0];c=c[1];b[0]=f*a[0];b[1]=f*a[1];b[2]=f*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};e.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};e.fromRotation=function(b,a){var c=
Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=0;b[3]=-c;b[4]=f;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};e.fromMat2d=function(b,a){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};e.fromQuat=function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=c+c,n=f+f,d=k+k,c=c*h,p=f*h,f=f*n,e=k*h,q=k*n,k=k*d,h=l*h,n=l*n,l=l*d;b[0]=1-f-k;b[3]=p-l;b[6]=e+n;b[1]=p+l;b[4]=1-c-k;
b[7]=q-h;b[2]=e-n;b[5]=q+h;b[8]=1-c-f;return b};e.normalFromMat4=function(b,a){var c=a[0],f=a[1],k=a[2],l=a[3],h=a[4],n=a[5],d=a[6],p=a[7],e=a[8],q=a[9],g=a[10],w=a[11],u=a[12],y=a[13],x=a[14],t=a[15],B=c*n-f*h,m=c*d-k*h,z=c*p-l*h,D=f*d-k*n,E=f*p-l*n,G=k*p-l*d,F=e*y-q*u,K=e*x-g*u,e=e*t-w*u,L=q*x-g*y,q=q*t-w*y,g=g*t-w*x,w=B*g-m*q+z*L+D*e-E*K+G*F;if(!w)return null;w=1/w;b[0]=(n*g-d*q+p*L)*w;b[1]=(d*e-h*g-p*K)*w;b[2]=(h*q-n*e+p*F)*w;b[3]=(k*q-f*g-l*L)*w;b[4]=(c*g-k*e+l*K)*w;b[5]=(f*e-c*q-l*F)*w;b[6]=
(y*G-x*E+t*D)*w;b[7]=(x*z-u*G-t*m)*w;b[8]=(u*E-y*z+t*B)*w;return b};e.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2))};e.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];b[4]=a[4]+c[4];b[5]=a[5]+c[5];b[6]=a[6]+
c[6];b[7]=a[7]+c[7];b[8]=a[8]+c[8];return b};e.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];b[4]=a[4]-c[4];b[5]=a[5]-c[5];b[6]=a[6]-c[6];b[7]=a[7]-c[7];b[8]=a[8]-c[8];return b};e.sub=e.subtract;e.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;b[4]=a[4]*c;b[5]=a[5]*c;b[6]=a[6]*c;b[7]=a[7]*c;b[8]=a[8]*c;return b};e.multiplyScalarAndAdd=function(b,a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;b[4]=a[4]+
c[4]*f;b[5]=a[5]+c[5]*f;b[6]=a[6]+c[6]*f;b[7]=a[7]+c[7]*f;b[8]=a[8]+c[8]*f;return b};e.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]&&b[6]===a[6]&&b[7]===a[7]&&b[8]===a[8]};e.equals=function(b,a){var c=b[0],f=b[1],k=b[2],l=b[3],h=b[4],n=b[5],d=b[6],p=b[7],e=b[8],q=a[0],g=a[1],w=a[2],u=a[3],y=a[4],x=a[5],t=b[6],B=a[7],C=a[8];return Math.abs(c-q)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(f-g)<=m.EPSILON*Math.max(1,Math.abs(f),
Math.abs(g))&&Math.abs(k-w)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(w))&&Math.abs(l-u)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(u))&&Math.abs(h-y)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(n-x)<=m.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(d-t)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(p-B)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(e-C)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(C))};g.exports=e},function(g,e,d){var m=d(23),b={scalar:{},
SIMD:{},create:function(){var a=new m.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var c=new m.ARRAY_TYPE(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=
c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},fromValues:function(a,c,f,b,l,h,n,d,p,e,q,g,w,u,y,x){var t=new m.ARRAY_TYPE(16);t[0]=a;t[1]=c;t[2]=f;t[3]=b;t[4]=l;t[5]=h;t[6]=n;t[7]=d;t[8]=p;t[9]=e;t[10]=q;t[11]=g;t[12]=w;t[13]=u;t[14]=y;t[15]=x;return t},set:function(a,c,f,b,l,h,n,d,p,e,q,g,w,u,y,x,t){a[0]=c;a[1]=f;a[2]=b;a[3]=l;a[4]=h;a[5]=n;a[6]=d;a[7]=p;a[8]=e;a[9]=q;a[10]=g;a[11]=w;a[12]=u;a[13]=y;a[14]=x;a[15]=t;return a},identity:function(a){a[0]=
1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}};b.scalar.transpose=function(a,c){if(a===c){var f=c[1],b=c[2],l=c[3],h=c[6],n=c[7],d=c[11];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=f;a[6]=c[9];a[7]=c[13];a[8]=b;a[9]=h;a[11]=c[14];a[12]=l;a[13]=n;a[14]=d}else a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a};
b.SIMD.transpose=function(a,c){var f,b,l,h,n,d,p;f=SIMD.Float32x4.load(c,0);b=SIMD.Float32x4.load(c,4);l=SIMD.Float32x4.load(c,8);h=SIMD.Float32x4.load(c,12);n=SIMD.Float32x4.shuffle(f,b,0,1,4,5);d=SIMD.Float32x4.shuffle(l,h,0,1,4,5);p=SIMD.Float32x4.shuffle(n,d,0,2,4,6);n=SIMD.Float32x4.shuffle(n,d,1,3,5,7);SIMD.Float32x4.store(a,0,p);SIMD.Float32x4.store(a,4,n);n=SIMD.Float32x4.shuffle(f,b,2,3,6,7);d=SIMD.Float32x4.shuffle(l,h,2,3,6,7);f=SIMD.Float32x4.shuffle(n,d,0,2,4,6);b=SIMD.Float32x4.shuffle(n,
d,1,3,5,7);SIMD.Float32x4.store(a,8,f);SIMD.Float32x4.store(a,12,b);return a};b.transpose=m.USE_SIMD?b.SIMD.transpose:b.scalar.transpose;b.scalar.invert=function(a,c){var f=c[0],b=c[1],l=c[2],h=c[3],n=c[4],d=c[5],p=c[6],e=c[7],q=c[8],g=c[9],w=c[10],u=c[11],y=c[12],x=c[13],t=c[14],B=c[15],m=f*d-b*n,z=f*p-l*n,D=f*e-h*n,E=b*p-l*d,G=b*e-h*d,F=l*e-h*p,K=q*x-g*y,L=q*t-w*y,N=q*B-u*y,M=g*t-w*x,J=g*B-u*x,P=w*B-u*t,H=m*P-z*J+D*M+E*N-G*L+F*K;if(!H)return null;H=1/H;a[0]=(d*P-p*J+e*M)*H;a[1]=(l*J-b*P-h*M)*H;
a[2]=(x*F-t*G+B*E)*H;a[3]=(w*G-g*F-u*E)*H;a[4]=(p*N-n*P-e*L)*H;a[5]=(f*P-l*N+h*L)*H;a[6]=(t*D-y*F-B*z)*H;a[7]=(q*F-w*D+u*z)*H;a[8]=(n*J-d*N+e*K)*H;a[9]=(b*N-f*J-h*K)*H;a[10]=(y*G-x*D+B*m)*H;a[11]=(g*D-q*G-u*m)*H;a[12]=(d*L-n*M-p*K)*H;a[13]=(f*M-b*L+l*K)*H;a[14]=(x*z-y*E-t*m)*H;a[15]=(q*E-g*z+w*m)*H;return a};b.SIMD.invert=function(a,c){var f,b,l,h,n,d,p,e,q;d=SIMD.Float32x4.load(c,0);p=SIMD.Float32x4.load(c,4);e=SIMD.Float32x4.load(c,8);q=SIMD.Float32x4.load(c,12);n=SIMD.Float32x4.shuffle(d,p,0,1,
4,5);b=SIMD.Float32x4.shuffle(e,q,0,1,4,5);f=SIMD.Float32x4.shuffle(n,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,n,1,3,5,7);n=SIMD.Float32x4.shuffle(d,p,2,3,6,7);h=SIMD.Float32x4.shuffle(e,q,2,3,6,7);l=SIMD.Float32x4.shuffle(n,h,0,2,4,6);h=SIMD.Float32x4.shuffle(h,n,1,3,5,7);n=SIMD.Float32x4.mul(l,h);n=SIMD.Float32x4.swizzle(n,1,0,3,2);d=SIMD.Float32x4.mul(b,n);p=SIMD.Float32x4.mul(f,n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,n),d);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,
n),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);n=SIMD.Float32x4.mul(b,l);n=SIMD.Float32x4.swizzle(n,1,0,3,2);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,n),d);q=SIMD.Float32x4.mul(f,n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(h,n));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,n),q);q=SIMD.Float32x4.swizzle(q,2,3,0,1);n=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),h);n=SIMD.Float32x4.swizzle(n,1,0,3,2);l=SIMD.Float32x4.swizzle(l,2,3,0,1);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,
n),d);e=SIMD.Float32x4.mul(f,n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(l,n));e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,n),e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);n=SIMD.Float32x4.mul(f,b);n=SIMD.Float32x4.swizzle(n,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,n),e);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,n),q);n=SIMD.Float32x4.swizzle(n,2,3,0,1);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,n),e);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(l,n));n=SIMD.Float32x4.mul(f,
h);n=SIMD.Float32x4.swizzle(n,1,0,3,2);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,n));e=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,n),e);n=SIMD.Float32x4.swizzle(n,2,3,0,1);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,n),p);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(b,n));n=SIMD.Float32x4.mul(f,l);n=SIMD.Float32x4.swizzle(n,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,n),p);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(b,n));n=SIMD.Float32x4.swizzle(n,2,3,0,1);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(h,
n));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,n),q);f=SIMD.Float32x4.mul(f,d);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,2,3,0,1),f);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,1,0,3,2),f);n=SIMD.Float32x4.reciprocalApproximation(f);f=SIMD.Float32x4.sub(SIMD.Float32x4.add(n,n),SIMD.Float32x4.mul(f,SIMD.Float32x4.mul(n,n)));f=SIMD.Float32x4.swizzle(f,0,0,0,0);if(!f)return null;SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(f,d));SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(f,p));SIMD.Float32x4.store(a,
8,SIMD.Float32x4.mul(f,e));SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(f,q));return a};b.invert=m.USE_SIMD?b.SIMD.invert:b.scalar.invert;b.scalar.adjoint=function(a,c){var f=c[0],b=c[1],l=c[2],h=c[3],n=c[4],d=c[5],e=c[6],g=c[7],q=c[8],r=c[9],m=c[10],u=c[11],y=c[12],x=c[13],t=c[14],B=c[15];a[0]=d*(m*B-u*t)-r*(e*B-g*t)+x*(e*u-g*m);a[1]=-(b*(m*B-u*t)-r*(l*B-h*t)+x*(l*u-h*m));a[2]=b*(e*B-g*t)-d*(l*B-h*t)+x*(l*g-h*e);a[3]=-(b*(e*u-g*m)-d*(l*u-h*m)+r*(l*g-h*e));a[4]=-(n*(m*B-u*t)-q*(e*B-g*t)+y*(e*u-g*
m));a[5]=f*(m*B-u*t)-q*(l*B-h*t)+y*(l*u-h*m);a[6]=-(f*(e*B-g*t)-n*(l*B-h*t)+y*(l*g-h*e));a[7]=f*(e*u-g*m)-n*(l*u-h*m)+q*(l*g-h*e);a[8]=n*(r*B-u*x)-q*(d*B-g*x)+y*(d*u-g*r);a[9]=-(f*(r*B-u*x)-q*(b*B-h*x)+y*(b*u-h*r));a[10]=f*(d*B-g*x)-n*(b*B-h*x)+y*(b*g-h*d);a[11]=-(f*(d*u-g*r)-n*(b*u-h*r)+q*(b*g-h*d));a[12]=-(n*(r*t-m*x)-q*(d*t-e*x)+y*(d*m-e*r));a[13]=f*(r*t-m*x)-q*(b*t-l*x)+y*(b*m-l*r);a[14]=-(f*(d*t-e*x)-n*(b*t-l*x)+y*(b*e-l*d));a[15]=f*(d*m-e*r)-n*(b*m-l*r)+q*(b*e-l*d);return a};b.SIMD.adjoint=
function(a,c){var f,b,l,h,n,d,e,g,q;f=SIMD.Float32x4.load(c,0);b=SIMD.Float32x4.load(c,4);l=SIMD.Float32x4.load(c,8);h=SIMD.Float32x4.load(c,12);e=SIMD.Float32x4.shuffle(f,b,0,1,4,5);d=SIMD.Float32x4.shuffle(l,h,0,1,4,5);n=SIMD.Float32x4.shuffle(e,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,e,1,3,5,7);e=SIMD.Float32x4.shuffle(f,b,2,3,6,7);b=SIMD.Float32x4.shuffle(l,h,2,3,6,7);f=SIMD.Float32x4.shuffle(e,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,e,1,3,5,7);e=SIMD.Float32x4.mul(f,b);e=SIMD.Float32x4.swizzle(e,
1,0,3,2);l=SIMD.Float32x4.mul(d,e);h=SIMD.Float32x4.mul(n,e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,e),l);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,e),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.mul(d,f);e=SIMD.Float32x4.swizzle(e,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,e),l);q=SIMD.Float32x4.mul(n,e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(b,e));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,e),q);q=SIMD.Float32x4.swizzle(q,
2,3,0,1);e=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),b);e=SIMD.Float32x4.swizzle(e,1,0,3,2);f=SIMD.Float32x4.swizzle(f,2,3,0,1);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),l);g=SIMD.Float32x4.mul(n,e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,e));g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,e),g);g=SIMD.Float32x4.swizzle(g,2,3,0,1);e=SIMD.Float32x4.mul(n,d);e=SIMD.Float32x4.swizzle(e,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,e),g);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,
e),q);e=SIMD.Float32x4.swizzle(e,2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,e),g);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(f,e));e=SIMD.Float32x4.mul(n,b);e=SIMD.Float32x4.swizzle(e,1,0,3,2);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,e));g=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,e),g);e=SIMD.Float32x4.swizzle(e,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,e),h);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(d,e));e=SIMD.Float32x4.mul(n,f);e=SIMD.Float32x4.swizzle(e,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,
e),h);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(d,e));e=SIMD.Float32x4.swizzle(e,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(b,e));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,e),q);SIMD.Float32x4.store(a,0,l);SIMD.Float32x4.store(a,4,h);SIMD.Float32x4.store(a,8,g);SIMD.Float32x4.store(a,12,q);return a};b.adjoint=m.USE_SIMD?b.SIMD.adjoint:b.scalar.adjoint;b.determinant=function(a){var c=a[0],f=a[1],b=a[2],l=a[3],h=a[4],n=a[5],d=a[6],e=a[7],g=a[8],q=a[9],r=a[10],m=a[11],u=a[12],y=a[13],x=a[14];
a=a[15];return(c*n-f*h)*(r*a-m*x)-(c*d-b*h)*(q*a-m*y)+(c*e-l*h)*(q*x-r*y)+(f*d-b*n)*(g*a-m*u)-(f*e-l*n)*(g*x-r*u)+(b*e-l*d)*(g*y-q*u)};b.SIMD.multiply=function(a,c,f){var b=SIMD.Float32x4.load(c,0),l=SIMD.Float32x4.load(c,4),h=SIMD.Float32x4.load(c,8);c=SIMD.Float32x4.load(c,12);var n=SIMD.Float32x4.load(f,0),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,
2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),c))));SIMD.Float32x4.store(a,0,n);n=SIMD.Float32x4.load(f,4);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),c))));SIMD.Float32x4.store(a,4,n);n=SIMD.Float32x4.load(f,8);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,3,3,3,3),c))));SIMD.Float32x4.store(a,8,n);f=SIMD.Float32x4.load(f,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),
h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),c))));SIMD.Float32x4.store(a,12,b);return a};b.scalar.multiply=function(a,c,f){var b=c[0],l=c[1],h=c[2],n=c[3],d=c[4],e=c[5],g=c[6],q=c[7],r=c[8],m=c[9],u=c[10],y=c[11],x=c[12],t=c[13],B=c[14];c=c[15];var C=f[0],z=f[1],D=f[2],E=f[3];a[0]=C*b+z*d+D*r+E*x;a[1]=C*l+z*e+D*m+E*t;a[2]=C*h+z*g+D*u+E*B;a[3]=C*n+z*q+D*y+E*c;C=f[4];z=f[5];D=f[6];E=f[7];a[4]=C*b+z*d+D*r+E*x;a[5]=C*l+z*e+D*m+E*t;a[6]=C*h+z*g+D*u+E*B;a[7]=C*n+z*q+D*y+E*c;C=f[8];z=f[9];D=
f[10];E=f[11];a[8]=C*b+z*d+D*r+E*x;a[9]=C*l+z*e+D*m+E*t;a[10]=C*h+z*g+D*u+E*B;a[11]=C*n+z*q+D*y+E*c;C=f[12];z=f[13];D=f[14];E=f[15];a[12]=C*b+z*d+D*r+E*x;a[13]=C*l+z*e+D*m+E*t;a[14]=C*h+z*g+D*u+E*B;a[15]=C*n+z*q+D*y+E*c;return a};b.multiply=m.USE_SIMD?b.SIMD.multiply:b.scalar.multiply;b.mul=b.multiply;b.scalar.translate=function(a,c,f){var b=f[0],l=f[1];f=f[2];var h,n,d,e,g,q,r,m,u,y,x,t;c===a?(a[12]=c[0]*b+c[4]*l+c[8]*f+c[12],a[13]=c[1]*b+c[5]*l+c[9]*f+c[13],a[14]=c[2]*b+c[6]*l+c[10]*f+c[14],a[15]=
c[3]*b+c[7]*l+c[11]*f+c[15]):(h=c[0],n=c[1],d=c[2],e=c[3],g=c[4],q=c[5],r=c[6],m=c[7],u=c[8],y=c[9],x=c[10],t=c[11],a[0]=h,a[1]=n,a[2]=d,a[3]=e,a[4]=g,a[5]=q,a[6]=r,a[7]=m,a[8]=u,a[9]=y,a[10]=x,a[11]=t,a[12]=h*b+g*l+u*f+c[12],a[13]=n*b+q*l+y*f+c[13],a[14]=d*b+r*l+x*f+c[14],a[15]=e*b+m*l+t*f+c[15]);return a};b.SIMD.translate=function(a,c,f){var b=SIMD.Float32x4.load(c,0),l=SIMD.Float32x4.load(c,4),h=SIMD.Float32x4.load(c,8),d=SIMD.Float32x4.load(c,12);f=SIMD.Float32x4(f[0],f[1],f[2],0);c!==a&&(a[0]=
c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,0,0,0,0));l=SIMD.Float32x4.mul(l,SIMD.Float32x4.swizzle(f,1,1,1,1));h=SIMD.Float32x4.mul(h,SIMD.Float32x4.swizzle(f,2,2,2,2));c=SIMD.Float32x4.add(b,SIMD.Float32x4.add(l,SIMD.Float32x4.add(h,d)));SIMD.Float32x4.store(a,12,c);return a};b.translate=m.USE_SIMD?b.SIMD.translate:b.scalar.translate;b.scalar.scale=function(a,c,f){var b=f[0],
l=f[1];f=f[2];a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;a[4]=c[4]*l;a[5]=c[5]*l;a[6]=c[6]*l;a[7]=c[7]*l;a[8]=c[8]*f;a[9]=c[9]*f;a[10]=c[10]*f;a[11]=c[11]*f;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.SIMD.scale=function(a,c,f){var b;f=SIMD.Float32x4(f[0],f[1],f[2],0);b=SIMD.Float32x4.load(c,0);SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,0,0,0,0)));b=SIMD.Float32x4.load(c,4);SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,1,1,
1,1)));b=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,2,2,2,2)));a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.scale=m.USE_SIMD?b.SIMD.scale:b.scalar.scale;b.rotate=function(a,c,f,b){var l=b[0],h=b[1];b=b[2];var d=Math.sqrt(l*l+h*h+b*b),e,p,g,q,r,w,u,y,x,t,B,C,z,D,E,G,F,K,L,N;if(Math.abs(d)<m.EPSILON)return null;d=1/d;l*=d;h*=d;b*=d;e=Math.sin(f);p=Math.cos(f);g=1-p;f=c[0];d=c[1];q=c[2];r=c[3];w=c[4];u=c[5];y=c[6];x=c[7];t=c[8];B=c[9];
C=c[10];z=c[11];D=l*l*g+p;E=h*l*g+b*e;G=b*l*g-h*e;F=l*h*g-b*e;K=h*h*g+p;L=b*h*g+l*e;N=l*b*g+h*e;l=h*b*g-l*e;h=b*b*g+p;a[0]=f*D+w*E+t*G;a[1]=d*D+u*E+B*G;a[2]=q*D+y*E+C*G;a[3]=r*D+x*E+z*G;a[4]=f*F+w*K+t*L;a[5]=d*F+u*K+B*L;a[6]=q*F+y*K+C*L;a[7]=r*F+x*K+z*L;a[8]=f*N+w*l+t*h;a[9]=d*N+u*l+B*h;a[10]=q*N+y*l+C*h;a[11]=r*N+x*l+z*h;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};b.scalar.rotateX=function(a,c,b){var k=Math.sin(b);b=Math.cos(b);var l=c[4],h=c[5],d=c[6],e=c[7],p=c[8],g=c[9],
q=c[10],r=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=l*b+p*k;a[5]=h*b+g*k;a[6]=d*b+q*k;a[7]=e*b+r*k;a[8]=p*b-l*k;a[9]=g*b-h*k;a[10]=q*b-d*k;a[11]=r*b-e*k;return a};b.SIMD.rotateX=function(a,c,b){var k=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var l=SIMD.Float32x4.load(c,4);c=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,
4,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,b),SIMD.Float32x4.mul(c,k)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),SIMD.Float32x4.mul(l,k)));return a};b.rotateX=m.USE_SIMD?b.SIMD.rotateX:b.scalar.rotateX;b.scalar.rotateY=function(a,c,b){var k=Math.sin(b);b=Math.cos(b);var l=c[0],h=c[1],d=c[2],e=c[3],p=c[8],g=c[9],q=c[10],r=c[11];c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=l*b-p*k;a[1]=h*b-g*k;a[2]=d*b-q*k;a[3]=e*b-r*
k;a[8]=l*k+p*b;a[9]=h*k+g*b;a[10]=d*k+q*b;a[11]=e*k+r*b;return a};b.SIMD.rotateY=function(a,c,b){var k=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var l=SIMD.Float32x4.load(c,0);c=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,b),SIMD.Float32x4.mul(c,k)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,k),SIMD.Float32x4.mul(c,
b)));return a};b.rotateY=m.USE_SIMD?b.SIMD.rotateY:b.scalar.rotateY;b.scalar.rotateZ=function(a,c,b){var k=Math.sin(b);b=Math.cos(b);var l=c[0],h=c[1],d=c[2],e=c[3],p=c[4],g=c[5],q=c[6],r=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=l*b+p*k;a[1]=h*b+g*k;a[2]=d*b+q*k;a[3]=e*b+r*k;a[4]=p*b-l*k;a[5]=g*b-h*k;a[6]=q*b-d*k;a[7]=r*b-e*k;return a};b.SIMD.rotateZ=function(a,c,b){var k=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));
c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var l=SIMD.Float32x4.load(c,0);c=SIMD.Float32x4.load(c,4);SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,b),SIMD.Float32x4.mul(c,k)));SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),SIMD.Float32x4.mul(l,k)));return a};b.rotateZ=m.USE_SIMD?b.SIMD.rotateZ:b.scalar.rotateZ;b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=
0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,b){var k=b[0],l=b[1];b=b[2];var h=Math.sqrt(k*k+l*l+b*b),d;if(Math.abs(h)<m.EPSILON)return null;h=1/h;k*=h;l*=h;b*=h;h=Math.sin(c);c=Math.cos(c);d=1-c;a[0]=k*k*d+c;a[1]=l*k*d+b*h;a[2]=b*k*d-l*h;a[3]=0;a[4]=k*l*d-b*h;a[5]=l*l*d+c;a[6]=
b*l*d+k*h;a[7]=0;a[8]=k*b*d+l*h;a[9]=l*b*d-k*h;a[10]=b*b*d+c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var b=Math.sin(c),k=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=k;a[6]=b;a[7]=0;a[8]=0;a[9]=-b;a[10]=k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var b=Math.sin(c),k=Math.cos(c);a[0]=k;a[1]=0;a[2]=-b;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=b;a[9]=0;a[10]=k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=
function(a,c){var b=Math.sin(c),k=Math.cos(c);a[0]=k;a[1]=b;a[2]=0;a[3]=0;a[4]=-b;a[5]=k;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=function(a,c,b){var k=c[0],l=c[1],h=c[2],d=c[3],e=k+k,p=l+l,g=h+h;c=k*e;var q=k*p,k=k*g,r=l*p,l=l*g,h=h*g,e=d*e,p=d*p,d=d*g;a[0]=1-(r+h);a[1]=q+d;a[2]=k-p;a[3]=0;a[4]=q-d;a[5]=1-(c+h);a[6]=l+e;a[7]=0;a[8]=k+p;a[9]=l-e;a[10]=1-(c+r);a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.getTranslation=
function(a,c){a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};b.getRotation=function(a,c){var b=c[0]+c[5]+c[10],k=0;0<b?(k=2*Math.sqrt(b+1),a[3]=.25*k,a[0]=(c[6]-c[9])/k,a[1]=(c[8]-c[2])/k,a[2]=(c[1]-c[4])/k):c[0]>c[5]&c[0]>c[10]?(k=2*Math.sqrt(1+c[0]-c[5]-c[10]),a[3]=(c[6]-c[9])/k,a[0]=.25*k,a[1]=(c[1]+c[4])/k,a[2]=(c[8]+c[2])/k):c[5]>c[10]?(k=2*Math.sqrt(1+c[5]-c[0]-c[10]),a[3]=(c[8]-c[2])/k,a[0]=(c[1]+c[4])/k,a[1]=.25*k,a[2]=(c[6]+c[9])/k):(k=2*Math.sqrt(1+c[10]-c[0]-c[5]),a[3]=(c[1]-c[4])/k,a[0]=(c[8]+
c[2])/k,a[1]=(c[6]+c[9])/k,a[2]=.25*k);return a};b.fromRotationTranslationScale=function(a,c,b,k){var l=c[0],h=c[1],d=c[2],e=c[3],p=l+l,g=h+h,q=d+d;c=l*p;var r=l*g,l=l*q,m=h*g,h=h*q,d=d*q,p=e*p,g=e*g,e=e*q,q=k[0],u=k[1];k=k[2];a[0]=(1-(m+d))*q;a[1]=(r+e)*q;a[2]=(l-g)*q;a[3]=0;a[4]=(r-e)*u;a[5]=(1-(c+d))*u;a[6]=(h+p)*u;a[7]=0;a[8]=(l+g)*k;a[9]=(h-p)*k;a[10]=(1-(c+m))*k;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,b,k,l){var h=c[0],d=c[1],
e=c[2],p=c[3],g=h+h,q=d+d,r=e+e;c=h*g;var m=h*q,h=h*r,u=d*q,d=d*r,e=e*r,g=p*g,q=p*q,p=p*r,r=k[0],y=k[1];k=k[2];var x=l[0],t=l[1];l=l[2];a[0]=(1-(u+e))*r;a[1]=(m+p)*r;a[2]=(h-q)*r;a[3]=0;a[4]=(m-p)*y;a[5]=(1-(c+e))*y;a[6]=(d+g)*y;a[7]=0;a[8]=(h+q)*k;a[9]=(d-g)*k;a[10]=(1-(c+u))*k;a[11]=0;a[12]=b[0]+x-(a[0]*x+a[4]*t+a[8]*l);a[13]=b[1]+t-(a[1]*x+a[5]*t+a[9]*l);a[14]=b[2]+l-(a[2]*x+a[6]*t+a[10]*l);a[15]=1;return a};b.fromQuat=function(a,c){var b=c[0],k=c[1],l=c[2],h=c[3],d=b+b,e=k+k,p=l+l,b=b*d,g=k*d,
k=k*e,q=l*d,m=l*e,l=l*p,d=h*d,e=h*e,h=h*p;a[0]=1-k-l;a[1]=g+h;a[2]=q-e;a[3]=0;a[4]=g-h;a[5]=1-b-l;a[6]=m+d;a[7]=0;a[8]=q+e;a[9]=m-d;a[10]=1-b-k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,b,k,l,h,d){var e=1/(b-c),p=1/(l-k),g=1/(h-d);a[0]=2*h*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*h*p;a[6]=0;a[7]=0;a[8]=(b+c)*e;a[9]=(l+k)*p;a[10]=(d+h)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=d*h*2*g;a[15]=0;return a};b.perspective=function(a,c,b,k,l){c=1/Math.tan(c/2);var h=1/(k-l);a[0]=c/b;a[1]=
0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(l+k)*h;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*l*k*h;a[15]=0;return a};b.perspectiveFromFieldOfView=function(a,c,b,k){var l=Math.tan(c.upDegrees*Math.PI/180),h=Math.tan(c.downDegrees*Math.PI/180),d=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*Math.PI/180);var e=2/(d+c),p=2/(l+h);a[0]=e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=p;a[6]=0;a[7]=0;a[8]=-((d-c)*e*.5);a[9]=(l-h)*p*.5;a[10]=k/(b-k);a[11]=-1;a[12]=0;a[13]=0;a[14]=k*b/(b-k);
a[15]=0;return a};b.ortho=function(a,c,b,k,l,h,d){var e=1/(c-b),p=1/(k-l),g=1/(h-d);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*p;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*g;a[11]=0;a[12]=(c+b)*e;a[13]=(l+k)*p;a[14]=(d+h)*g;a[15]=1;return a};b.lookAt=function(a,c,f,k){var l,h,d,e,p,g,q,r,w=c[0],u=c[1];c=c[2];d=k[0];e=k[1];h=k[2];q=f[0];k=f[1];l=f[2];if(Math.abs(w-q)<m.EPSILON&&Math.abs(u-k)<m.EPSILON&&Math.abs(c-l)<m.EPSILON)return b.identity(a);f=w-q;k=u-k;q=c-l;r=1/Math.sqrt(f*f+k*k+q*q);f*=r;k*=r;
q*=r;l=e*q-h*k;h=h*f-d*q;d=d*k-e*f;(r=Math.sqrt(l*l+h*h+d*d))?(r=1/r,l*=r,h*=r,d*=r):d=h=l=0;e=k*d-q*h;p=q*l-f*d;g=f*h-k*l;(r=Math.sqrt(e*e+p*p+g*g))?(r=1/r,e*=r,p*=r,g*=r):g=p=e=0;a[0]=l;a[1]=e;a[2]=f;a[3]=0;a[4]=h;a[5]=p;a[6]=k;a[7]=0;a[8]=d;a[9]=g;a[10]=q;a[11]=0;a[12]=-(l*w+h*u+d*c);a[13]=-(e*w+p*u+g*c);a[14]=-(f*w+k*u+q*c);a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+
a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];a[4]=c[4]+b[4];a[5]=c[5]+b[5];a[6]=c[6]+b[6];a[7]=c[7]+b[7];
a[8]=c[8]+b[8];a[9]=c[9]+b[9];a[10]=c[10]+b[10];a[11]=c[11]+b[11];a[12]=c[12]+b[12];a[13]=c[13]+b[13];a[14]=c[14]+b[14];a[15]=c[15]+b[15];return a};b.subtract=function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];a[4]=c[4]-b[4];a[5]=c[5]-b[5];a[6]=c[6]-b[6];a[7]=c[7]-b[7];a[8]=c[8]-b[8];a[9]=c[9]-b[9];a[10]=c[10]-b[10];a[11]=c[11]-b[11];a[12]=c[12]-b[12];a[13]=c[13]-b[13];a[14]=c[14]-b[14];a[15]=c[15]-b[15];return a};b.sub=b.subtract;b.multiplyScalar=function(a,c,b){a[0]=c[0]*
b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;a[4]=c[4]*b;a[5]=c[5]*b;a[6]=c[6]*b;a[7]=c[7]*b;a[8]=c[8]*b;a[9]=c[9]*b;a[10]=c[10]*b;a[11]=c[11]*b;a[12]=c[12]*b;a[13]=c[13]*b;a[14]=c[14]*b;a[15]=c[15]*b;return a};b.multiplyScalarAndAdd=function(a,c,b,k){a[0]=c[0]+b[0]*k;a[1]=c[1]+b[1]*k;a[2]=c[2]+b[2]*k;a[3]=c[3]+b[3]*k;a[4]=c[4]+b[4]*k;a[5]=c[5]+b[5]*k;a[6]=c[6]+b[6]*k;a[7]=c[7]+b[7]*k;a[8]=c[8]+b[8]*k;a[9]=c[9]+b[9]*k;a[10]=c[10]+b[10]*k;a[11]=c[11]+b[11]*k;a[12]=c[12]+b[12]*k;a[13]=c[13]+b[13]*k;a[14]=
c[14]+b[14]*k;a[15]=c[15]+b[15]*k;return a};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};b.equals=function(a,c){var b=a[0],k=a[1],d=a[2],h=a[3],e=a[4],v=a[5],p=a[6],g=a[7],q=a[8],r=a[9],w=a[10],u=a[11],y=a[12],x=a[13],t=a[14],B=a[15],C=c[0],z=c[1],D=c[2],E=c[3],G=c[4],F=c[5],K=c[6],L=c[7],N=
c[8],M=c[9],J=c[10],P=c[11],H=c[12],I=c[13],O=c[14],R=c[15];return Math.abs(b-C)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(C))&&Math.abs(k-z)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(z))&&Math.abs(d-D)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(h-E)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(e-G)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(G))&&Math.abs(v-F)<=m.EPSILON*Math.max(1,Math.abs(v),Math.abs(F))&&Math.abs(p-K)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(K))&&
Math.abs(g-L)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(q-N)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(N))&&Math.abs(r-M)<=m.EPSILON*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(w-J)<=m.EPSILON*Math.max(1,Math.abs(w),Math.abs(J))&&Math.abs(u-P)<=m.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(y-H)<=m.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(x-I)<=m.EPSILON*Math.max(1,Math.abs(x),Math.abs(I))&&Math.abs(t-O)<=m.EPSILON*Math.max(1,Math.abs(t),Math.abs(O))&&Math.abs(B-
R)<=m.EPSILON*Math.max(1,Math.abs(B),Math.abs(R))};g.exports=b},function(g,e,d){var m=d(23),b=d(26),a=d(29);e=d(30);var c={create:function(){var a=new m.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};c.rotationTo=function(){var b=a.create(),k=a.fromValues(1,0,0),d=a.fromValues(0,1,0);return function(h,e,v){var g=a.dot(e,v);if(-.999999>g)return a.cross(b,k,e),1E-6>a.length(b)&&a.cross(b,d,e),a.normalize(b,b),c.setAxisAngle(h,b,Math.PI),h;if(.999999<g)return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h;a.cross(b,
e,v);h[0]=b[0];h[1]=b[1];h[2]=b[2];h[3]=1+g;return c.normalize(h,h)}}();c.setAxes=function(){var a=b.create();return function(b,d,h,e){a[0]=h[0];a[3]=h[1];a[6]=h[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-d[0];a[5]=-d[1];a[8]=-d[2];return c.normalize(b,c.fromMat3(b,a))}}();c.clone=e.clone;c.fromValues=e.fromValues;c.copy=e.copy;c.set=e.set;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.setAxisAngle=function(a,c,b){b*=.5;var h=Math.sin(b);a[0]=h*c[0];a[1]=h*c[1];a[2]=h*c[2];a[3]=Math.cos(b);
return a};c.getAxisAngle=function(a,c){var b=2*Math.acos(c[3]),h=Math.sin(b/2);0!=h?(a[0]=c[0]/h,a[1]=c[1]/h,a[2]=c[2]/h):(a[0]=1,a[1]=0,a[2]=0);return b};c.add=e.add;c.multiply=function(a,c,b){var h=c[0],d=c[1],e=c[2];c=c[3];var g=b[0],m=b[1],q=b[2];b=b[3];a[0]=h*b+c*g+d*q-e*m;a[1]=d*b+c*m+e*g-h*q;a[2]=e*b+c*q+h*m-d*g;a[3]=c*b-h*g-d*m-e*q;return a};c.mul=c.multiply;c.scale=e.scale;c.rotateX=function(a,c,b){b*=.5;var h=c[0],d=c[1],e=c[2];c=c[3];var g=Math.sin(b);b=Math.cos(b);a[0]=h*b+c*g;a[1]=d*
b+e*g;a[2]=e*b-d*g;a[3]=c*b-h*g;return a};c.rotateY=function(a,c,b){b*=.5;var h=c[0],d=c[1],e=c[2];c=c[3];var g=Math.sin(b);b=Math.cos(b);a[0]=h*b-e*g;a[1]=d*b+c*g;a[2]=e*b+h*g;a[3]=c*b-d*g;return a};c.rotateZ=function(a,c,b){b*=.5;var h=c[0],d=c[1],e=c[2];c=c[3];var g=Math.sin(b);b=Math.cos(b);a[0]=h*b+d*g;a[1]=d*b-h*g;a[2]=e*b+c*g;a[3]=c*b-e*g;return a};c.calculateW=function(a,c){var b=c[0],d=c[1],e=c[2];a[0]=b;a[1]=d;a[2]=e;a[3]=Math.sqrt(Math.abs(1-b*b-d*d-e*e));return a};c.dot=e.dot;c.lerp=e.lerp;
c.slerp=function(a,c,b,d){var e=c[0],g=c[1],p=c[2];c=c[3];var m=b[0],q=b[1],r=b[2];b=b[3];var w,u,y;u=e*m+g*q+p*r+c*b;0>u&&(u=-u,m=-m,q=-q,r=-r,b=-b);1E-6<1-u?(w=Math.acos(u),y=Math.sin(w),u=Math.sin((1-d)*w)/y,d=Math.sin(d*w)/y):u=1-d;a[0]=u*e+d*m;a[1]=u*g+d*q;a[2]=u*p+d*r;a[3]=u*c+d*b;return a};c.sqlerp=function(){var a=c.create(),b=c.create();return function(d,h,e,g,p,m){c.slerp(a,h,p,m);c.slerp(b,e,g,m);c.slerp(d,a,b,2*m*(1-m));return d}}();c.invert=function(a,c){var b=c[0],d=c[1],e=c[2],g=c[3],
p=b*b+d*d+e*e+g*g,p=p?1/p:0;a[0]=-b*p;a[1]=-d*p;a[2]=-e*p;a[3]=g*p;return a};c.conjugate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};c.length=e.length;c.len=c.length;c.squaredLength=e.squaredLength;c.sqrLen=c.squaredLength;c.normalize=e.normalize;c.fromMat3=function(a,c){var b=c[0]+c[4]+c[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(c[5]-c[7])*b,a[1]=(c[6]-c[2])*b,a[2]=(c[1]-c[3])*b;else{var d=0;c[4]>c[0]&&(d=1);c[8]>c[3*d+d]&&(d=2);var e=(d+1)%3,g=(d+2)%3,b=Math.sqrt(c[3*
d+d]-c[3*e+e]-c[3*g+g]+1);a[d]=.5*b;b=.5/b;a[3]=(c[3*e+g]-c[3*g+e])*b;a[e]=(c[3*e+d]+c[3*d+e])*b;a[g]=(c[3*g+d]+c[3*d+g])*b}return a};c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};c.exactEquals=e.exactEquals;c.equals=e.equals;g.exports=c},function(g,e,d){var m=d(23),b={create:function(){var a=new m.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var c=new m.ARRAY_TYPE(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},fromValues:function(a,c,b){var d=new m.ARRAY_TYPE(3);
d[0]=a;d[1]=c;d[2]=b;return d},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},set:function(a,c,b,d){a[0]=c;a[1]=b;a[2]=d;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];return a};b.div=
b.divide;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);return a};b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);
return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;return a};b.scaleAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;a[2]=c[2]+b[2]*d;return a};b.distance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];return Math.sqrt(b*b+d*d+e*e)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];return b*b+d*d+e*e};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1];a=a[2];return Math.sqrt(c*c+b*b+a*a)};b.len=b.length;b.squaredLength=
function(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];return a};b.normalize=function(a,c){var b=c[0],d=c[1],e=c[2],b=b*b+d*d+e*e;0<b&&(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b,a[2]=c[2]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};b.cross=function(a,c,b){var d=c[0],e=c[1];c=c[2];var h=b[0],n=b[1];b=b[2];a[0]=e*b-c*n;a[1]=
c*h-d*b;a[2]=d*n-e*h;return a};b.lerp=function(a,c,b,d){var e=c[0],h=c[1];c=c[2];a[0]=e+d*(b[0]-e);a[1]=h+d*(b[1]-h);a[2]=c+d*(b[2]-c);return a};b.hermite=function(a,c,b,d,e,h){var n=h*h,g=n*(2*h-3)+1,p=n*(h-2)+h,m=n*(h-1);h=n*(3-2*h);a[0]=c[0]*g+b[0]*p+d[0]*m+e[0]*h;a[1]=c[1]*g+b[1]*p+d[1]*m+e[1]*h;a[2]=c[2]*g+b[2]*p+d[2]*m+e[2]*h;return a};b.bezier=function(a,c,b,d,e,h){var n=1-h,g=n*n,p=h*h,m=g*n,g=3*h*g,n=3*p*n;h*=p;a[0]=c[0]*m+b[0]*g+d[0]*n+e[0]*h;a[1]=c[1]*m+b[1]*g+d[1]*n+e[1]*h;a[2]=c[2]*m+
b[2]*g+d[2]*n+e[2]*h;return a};b.random=function(a,c){c=c||1;var b=2*m.RANDOM()*Math.PI,d=2*m.RANDOM()-1,e=Math.sqrt(1-d*d)*c;a[0]=Math.cos(b)*e;a[1]=Math.sin(b)*e;a[2]=d*c;return a};b.transformMat4=function(a,c,b){var d=c[0],e=c[1];c=c[2];var h=b[3]*d+b[7]*e+b[11]*c+b[15],h=h||1;a[0]=(b[0]*d+b[4]*e+b[8]*c+b[12])/h;a[1]=(b[1]*d+b[5]*e+b[9]*c+b[13])/h;a[2]=(b[2]*d+b[6]*e+b[10]*c+b[14])/h;return a};b.transformMat3=function(a,c,b){var d=c[0],e=c[1];c=c[2];a[0]=d*b[0]+e*b[3]+c*b[6];a[1]=d*b[1]+e*b[4]+
c*b[7];a[2]=d*b[2]+e*b[5]+c*b[8];return a};b.transformQuat=function(a,c,b){var d=c[0],e=c[1],h=c[2];c=b[0];var n=b[1],g=b[2];b=b[3];var p=b*d+n*h-g*e,m=b*e+g*d-c*h,q=b*h+c*e-n*d,d=-c*d-n*e-g*h;a[0]=p*b+d*-c+m*-g-q*-n;a[1]=m*b+d*-n+q*-c-p*-g;a[2]=q*b+d*-g+p*-n-m*-c;return a};b.rotateX=function(a,c,b,d){var e=[],h=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];h[0]=e[0];h[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d);h[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=h[0]+b[0];a[1]=h[1]+b[1];a[2]=h[2]+b[2];return a};
b.rotateY=function(a,c,b,d){var e=[],h=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];h[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d);h[1]=e[1];h[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=h[0]+b[0];a[1]=h[1]+b[1];a[2]=h[2]+b[2];return a};b.rotateZ=function(a,c,b,d){var e=[],h=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];h[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d);h[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);h[2]=e[2];a[0]=h[0]+b[0];a[1]=h[1]+b[1];a[2]=h[2]+b[2];return a};b.forEach=function(){var a=b.create();return function(c,
b,d,e,h,n){b||(b=3);d||(d=0);for(e=e?Math.min(e*b+d,c.length):c.length;d<e;d+=b)a[0]=c[d],a[1]=c[d+1],a[2]=c[d+2],h(a,a,n),c[d]=a[0],c[d+1]=a[1],c[d+2]=a[2];return c}}();b.angle=function(a,c){var d=b.fromValues(a[0],a[1],a[2]),e=b.fromValues(c[0],c[1],c[2]);b.normalize(d,d);b.normalize(e,e);d=b.dot(d,e);return 1<d?0:Math.acos(d)};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]};b.equals=function(a,c){var b=a[0],
d=a[1],e=a[2],h=c[0],n=c[1],g=c[2];return Math.abs(b-h)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(h))&&Math.abs(d-n)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(e-g)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))};g.exports=b},function(g,e,d){var m=d(23),b={create:function(){var a=new m.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var c=new m.ARRAY_TYPE(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},fromValues:function(a,c,b,d){var e=new m.ARRAY_TYPE(4);
e[0]=a;e[1]=c;e[2]=b;e[3]=d;return e},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a},set:function(a,c,b,d,e){a[0]=c;a[1]=b;a[2]=d;a[3]=e;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];a[3]=c[3]*b[3];return a};b.mul=b.multiply;b.divide=function(a,
c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];a[3]=c[3]/b[3];return a};b.div=b.divide;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);a[3]=Math.min(c[3],b[3]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);
a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);a[3]=Math.max(c[3],b[3]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;return a};b.scaleAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;a[2]=c[2]+b[2]*d;a[3]=c[3]+b[3]*d;return a};b.distance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2],h=c[3]-a[3];return Math.sqrt(b*b+d*d+e*
e+h*h)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2],h=c[3]-a[3];return b*b+d*d+e*e+h*h};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return Math.sqrt(c*c+b*b+d*d+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return c*c+b*b+d*d+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=
1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var b=c[0],d=c[1],e=c[2],h=c[3],n=b*b+d*d+e*e+h*h;0<n&&(n=1/Math.sqrt(n),a[0]=b*n,a[1]=d*n,a[2]=e*n,a[3]=h*n);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,b,d){var e=c[0],h=c[1],n=c[2];c=c[3];a[0]=e+d*(b[0]-e);a[1]=h+d*(b[1]-h);a[2]=n+d*(b[2]-n);a[3]=c+d*(b[3]-c);return a};b.random=function(a,c){c=c||1;a[0]=m.RANDOM();a[1]=m.RANDOM();a[2]=m.RANDOM();a[3]=m.RANDOM();b.normalize(a,a);b.scale(a,
a,c);return a};b.transformMat4=function(a,c,b){var d=c[0],e=c[1],h=c[2];c=c[3];a[0]=b[0]*d+b[4]*e+b[8]*h+b[12]*c;a[1]=b[1]*d+b[5]*e+b[9]*h+b[13]*c;a[2]=b[2]*d+b[6]*e+b[10]*h+b[14]*c;a[3]=b[3]*d+b[7]*e+b[11]*h+b[15]*c;return a};b.transformQuat=function(a,c,b){var d=c[0],e=c[1],h=c[2],n=b[0],g=b[1],p=b[2];b=b[3];var m=b*d+g*h-p*e,q=b*e+p*d-n*h,r=b*h+n*e-g*d,d=-n*d-g*e-p*h;a[0]=m*b+d*-n+q*-p-r*-g;a[1]=q*b+d*-g+r*-n-m*-p;a[2]=r*b+d*-p+m*-g-q*-n;a[3]=c[3];return a};b.forEach=function(){var a=b.create();
return function(c,b,d,e,h,n){b||(b=4);d||(d=0);for(e=e?Math.min(e*b+d,c.length):c.length;d<e;d+=b)a[0]=c[d],a[1]=c[d+1],a[2]=c[d+2],a[3]=c[d+3],h(a,a,n),c[d]=a[0],c[d+1]=a[1],c[d+2]=a[2],c[d+3]=a[3];return c}}();b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};b.equals=function(a,c){var b=a[0],d=a[1],e=a[2],h=a[3],n=c[0],g=c[1],p=c[2],A=c[3];return Math.abs(b-n)<=m.EPSILON*Math.max(1,Math.abs(b),
Math.abs(n))&&Math.abs(d-g)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(e-p)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(h-A)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))};g.exports=b},function(g,e,d){var m=d(23),b={create:function(){var a=new m.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var c=new m.ARRAY_TYPE(2);c[0]=a[0];c[1]=a[1];return c},fromValues:function(a,c){var b=new m.ARRAY_TYPE(2);b[0]=a;b[1]=c;return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},
set:function(a,b,d){a[0]=b;a[1]=d;return a},add:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];return a},subtract:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];return a}};b.sub=b.subtract;b.multiply=function(a,b,d){a[0]=b[0]*d[0];a[1]=b[1]*d[1];return a};b.mul=b.multiply;b.divide=function(a,b,d){a[0]=b[0]/d[0];a[1]=b[1]/d[1];return a};b.div=b.divide;b.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};b.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};b.min=
function(a,b,d){a[0]=Math.min(b[0],d[0]);a[1]=Math.min(b[1],d[1]);return a};b.max=function(a,b,d){a[0]=Math.max(b[0],d[0]);a[1]=Math.max(b[1],d[1]);return a};b.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};b.scale=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;return a};b.scaleAndAdd=function(a,b,d,e){a[0]=b[0]+d[0]*e;a[1]=b[1]+d[1]*e;return a};b.distance=function(a,b){var d=b[0]-a[0],e=b[1]-a[1];return Math.sqrt(d*d+e*e)};b.dist=b.distance;b.squaredDistance=function(a,b){var d=
b[0]-a[0],e=b[1]-a[1];return d*d+e*e};b.sqrDist=b.squaredDistance;b.length=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)};b.len=b.length;b.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};b.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};b.normalize=function(a,b){var d=b[0],e=b[1],d=d*d+e*e;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d);return a};b.dot=function(a,b){return a[0]*b[0]+a[1]*
b[1]};b.cross=function(a,b,d){b=b[0]*d[1]-b[1]*d[0];a[0]=a[1]=0;a[2]=b;return a};b.lerp=function(a,b,d,e){var l=b[0];b=b[1];a[0]=l+e*(d[0]-l);a[1]=b+e*(d[1]-b);return a};b.random=function(a,b){b=b||1;var d=2*m.RANDOM()*Math.PI;a[0]=Math.cos(d)*b;a[1]=Math.sin(d)*b;return a};b.transformMat2=function(a,b,d){var e=b[0];b=b[1];a[0]=d[0]*e+d[2]*b;a[1]=d[1]*e+d[3]*b;return a};b.transformMat2d=function(a,b,d){var e=b[0];b=b[1];a[0]=d[0]*e+d[2]*b+d[4];a[1]=d[1]*e+d[3]*b+d[5];return a};b.transformMat3=function(a,
b,d){var e=b[0];b=b[1];a[0]=d[0]*e+d[3]*b+d[6];a[1]=d[1]*e+d[4]*b+d[7];return a};b.transformMat4=function(a,b,d){var e=b[0];b=b[1];a[0]=d[0]*e+d[4]*b+d[12];a[1]=d[1]*e+d[5]*b+d[13];return a};b.forEach=function(){var a=b.create();return function(b,d,e,l,h,n){d||(d=2);e||(e=0);for(l=l?Math.min(l*d+e,b.length):b.length;e<l;e+=d)a[0]=b[e],a[1]=b[e+1],h(a,a,n),b[e]=a[0],b[e+1]=a[1];return b}}();b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};
b.equals=function(a,b){var d=a[0],e=a[1],l=b[0],h=b[1];return Math.abs(d-l)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&Math.abs(e-h)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))};g.exports=b},function(g,e){e.approxEqual=function(d,e){return d===e?!0:1E-6>Math.abs(d-e)/Math.min(Math.abs(d),Math.abs(e))}},function(g,e){e.partitionArray=function(d,e,b,a){for(;e<b;){var c=d[e];a(c)?++e:(--b,d[e]=d[b],d[b]=c)}return b};e.maybePadArray=function(d,e){if(d.length===e)return d;var b=new d.constructor(e);
b.set(d);return b};e.getFortranOrderStrides=function(d){for(var e=d.length,b=Array(e),a=b[0]=1>=arguments.length||void 0===arguments[1]?1:arguments[1],c=1;c<e;++c)a*=d[c-1],b[c]=a;return b}},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){for(var c=$jscomp.makeIterator(y),d=c.next();!d.done;d=c.next())if(d=d.value,d=d(a,b),null!=d)return d;throw Error("No chunk format handler found.");}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=function t(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},l=d(35),h=d(36),n=d(19),v=d(39);g=d(8);var p=d(21),A=d(40),q=d(53),r=d(41),w=
d(37),u=p.mat4.create();d=function(c){function d(a,c,e,h){m(this,d);var f=b(this,Object.getPrototypeOf(d).call(this));f.gl=a;f.chunkManager=c;f.layerManager=e;f.navigationState=h;f.dataToViewport=p.mat4.create();f.viewportToDevice=p.mat4.create();f.dataToDevice=p.mat4.create();f.visibleChunks=new Map;f.viewChanged=new w.Signal;f.renderingStale=!0;f.visibleChunksStale=!0;f.visibleLayersStale=!1;f.visibleLayerList=[];f.newVisibleLayers=new Set;f.offscreenFramebuffer=new q.OffscreenFramebuffer(f.gl,
{numDataBuffers:1,depthBuffer:!1,stencilBuffer:!0});p.mat4.identity(f.dataToViewport);f.initializeCounterpart(f.chunkManager.rpc,{type:"SliceView",chunkManager:c.rpcId});f.updateVisibleLayers();f.registerSignalBinding(h.changed.add(function(){f.updateViewportFromNavigationState()}));f.updateViewportFromNavigationState();f.registerSignalBinding(e.layersChanged.add(function(){!f.visibleLayersStale&&f.hasValidViewport&&(f.visibleLayersStale=!0,setTimeout(f.updateVisibleLayers.bind(f),0))}));f.viewChanged.add(function(){f.renderingStale=
!0});f.registerSignalBinding(c.chunkQueueManager.visibleChunksChanged.add(f.viewChanged.dispatch,f.viewChanged));return f}a(d,c);f(d,[{key:"updateViewportFromNavigationState",value:function(){var a=this.navigationState;a.valid&&(a.toMat4(u),this.setViewportToDataMatrix(u))}},{key:"updateVisibleLayers",value:function(){if(!this.hasValidViewport)return!1;this.visibleLayersStale=!1;var a=this.visibleLayers,b=this.rpc,c={id:this.rpcId},d=this.newVisibleLayers,e=!1,h=this.visibleLayerList;h.length=0;for(var f=
$jscomp.makeIterator(this.layerManager.readyRenderLayers()),l=f.next();!l.done;l=f.next())l=l.value,l instanceof v.RenderLayer&&(d.add(l),h.push(l),a.has(l)||(a.set(l,[]),l.redrawNeeded.add(this.viewChanged.dispatch,this.viewChanged),c.layerId=l.rpcId,b.invoke("SliceView.addVisibleLayer",c),e=!0));h=$jscomp.makeIterator(a.keys());for(f=h.next();!f.done;f=h.next())f=f.value,d.has(f)||(a.delete(f),f.redrawNeeded.remove(this.viewChanged.dispatch,this.viewChanged),c.layerId=f.rpcId,b.invoke("SliceView.removeVisibleLayer",
c),e=!0);d.clear();e&&(this.visibleSourcesStale=!0);this.viewChanged.dispatch();return e}},{key:"onViewportChanged",value:function(){var a=this.width,b=this.height,c=this.viewportToDevice,d=this.dataToViewport,e=this.dataToDevice;p.mat4.ortho(c,-a/2,a/2,b/2,-b/2,-1,1);p.mat4.multiply(e,c,d);this.visibleChunksStale=!0;this.viewChanged.dispatch()}},{key:"setViewportSize",value:function(a,b){return k(Object.getPrototypeOf(d.prototype),"setViewportSize",this).call(this,a,b)?(this.rpc.invoke("SliceView.updateView",
{id:this.rpcId,width:a,height:b}),!0):!1}},{key:"onViewportToDataMatrixChanged",value:function(){var a=this.viewportToData;p.mat4.invert(this.dataToViewport,a);this.rpc.invoke("SliceView.updateView",{id:this.rpcId,viewportToData:a})}},{key:"onHasValidViewport",value:function(){this.updateVisibleLayers()}},{key:"updateRendering",value:function(){if(this.renderingStale&&this.hasValidViewport&&0!==this.width&&0!==this.height){this.renderingStale=!1;this.maybeUpdateVisibleChunks();var a=this.gl,b=this.offscreenFramebuffer;
b.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);a.clearStencil(0);a.clearColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.disable(a.DEPTH_TEST);a.stencilOpSeparate(a.FRONT_AND_BACK,a.KEEP,a.KEEP,a.REPLACE);for(var c=0,d=$jscomp.makeIterator(this.visibleLayerList),e=d.next();!e.done;e=d.next())e=e.value,a.clear(a.STENCIL_BUFFER_BIT),a.stencilFuncSeparate(a.FRONT_AND_BACK,a.GREATER,1,1),1===c&&(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)),
e.draw(this),++c;a.disable(a.BLEND);a.disable(a.STENCIL_TEST);b.unbind()}}},{key:"maybeUpdateVisibleChunks",value:function(){if(!this.visibleChunksStale&&!this.visibleSourcesStale)return!1;this.visibleChunksStale=!1;this.updateVisibleChunks();return!0}},{key:"updateVisibleChunks",value:function(){var a=this.visibleChunks;this.computeVisibleChunks(function(b){var c=a.get(b);void 0===c?(c=[],a.set(b,c)):c.length=0;return c},function(a,b,c){a=p.vec3Key(c);b[b.length]=a})}}]);return d}(n.SliceViewBase);
e.SliceView=d;var y=[];e.registerChunkFormatHandler=function(a){y.push(a)};d=function(d){function e(a,d){m(this,e);var h=b(this,Object.getPrototypeOf(e).call(this,a));h.spec=d;h.chunkFormatHandler=h.registerDisposer(c(a.chunkQueueManager.gl,d));return h}a(e,d);f(e,[{key:"initializeCounterpart",value:function(a,b){this.spec.toObject(b.spec={});k(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"getValueAt",value:function(a){for(var b=p.vec3.create(),c=this.spec,
d=c.chunkLayout,e=d.offset,d=d.size,h=0;3>h;++h)b[h]=Math.floor((a[h]-e[h])/d[h]);h=p.vec3Key(b);h=this.chunks.get(h);if(!h)return null;for(var c=c.voxelSize,f=0;3>f;++f)b[f]=Math.floor((a[f]-e[f]-b[f]*d[f])/c[f]);a=h.chunkDataSize;for(e=0;3>e;++e)if(b[e]>=a[e])return;return h.getValueAt(b)}},{key:"getChunk",value:function(a){return this.chunkFormatHandler.getChunk(this,a)}},{key:"chunkFormat",get:function(){return this.chunkFormatHandler.chunkFormat}}]);return e}(h.ChunkSource);e.VolumeChunkSource=
d;h=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this,a));e.chunkGridPosition=c.chunkGridPosition;e.chunkDataSize=c.chunkDataSize||a.spec.chunkDataSize;e.state=l.ChunkState.SYSTEM_MEMORY;return e}a(d,c);f(d,[{key:"chunkFormat",get:function(){return this.source.chunkFormat}}]);return d}(h.Chunk);e.VolumeChunk=h;g=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.gl=a;e.copyVertexPositionsBuffer=e.registerDisposer(A.Buffer.fromData(e.gl,
new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.copyTexCoordsBuffer=e.registerDisposer(A.Buffer.fromData(e.gl,new Float32Array([0,0,0,1,1,1,1,0]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.textureCoordinateAdjustment=new Float32Array(4);var h=new r.ShaderBuilder(a);h.addVarying("vec2","vTexCoord");h.addUniform("sampler2D","uSampler");h.addInitializer(function(b){a.uniform1i(b.uniform("uSampler"),0)});h.addUniform("vec4","uColorFactor");h.addUniform("vec4",
"uBackgroundColor");h.addUniform("mat4","uProjectionMatrix");h.addUniform("vec4","uTextureCoordinateAdjustment");h.require(c);h.setFragmentMain("\nvec4 sampledColor = texture2D(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, vec4(0,0,0,0));\n");h.addAttribute("vec4","aVertexPosition");h.addAttribute("vec2","aTexCoord");h.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + aTexCoord * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n");
e.shader=e.registerDisposer(h.build());return e}a(d,c);f(d,[{key:"draw",value:function(a,b,c,d,e,h,f,l){var n=this.gl,k=this.shader,g=this.textureCoordinateAdjustment;g[0]=e;g[1]=h;g[2]=f-e;g[3]=l-h;k.bind();n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,a);n.uniformMatrix4fv(k.uniform("uProjectionMatrix"),!1,b);n.uniform4fv(k.uniform("uColorFactor"),c);n.uniform4fv(k.uniform("uBackgroundColor"),d);n.uniform4fv(k.uniform("uTextureCoordinateAdjustment"),g);a=k.attribute("aVertexPosition");
this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);k=k.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(k,2);n.drawArrays(n.TRIANGLE_FAN,0,4);n.disableVertexAttribArray(a);n.disableVertexAttribArray(k);n.bindTexture(n.TEXTURE_2D,null)}}],[{key:"get",value:function(a,b,c){return a.memoize.get(b,function(){return new d(a,c)})}}]);return d}(g.RefCounted);e.SliceViewRenderHelper=g},function(g,e){var d=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();(function(b){b[b.GPU_MEMORY=0]="GPU_MEMORY";b[b.SYSTEM_MEMORY=1]="SYSTEM_MEMORY";b[b.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER";b[b.DOWNLOADING=3]="DOWNLOADING";b[b.QUEUED=4]="QUEUED";b[b.NEW=5]="NEW";b[b.FAILED=6]="FAILED";b[b.EXPIRED=7]="EXPIRED"})(e.ChunkState||(e.ChunkState={}));(function(b){b[b.FIRST_TIER=0]="FIRST_TIER";b[b.FIRST_ORDERED_TIER=
0]="FIRST_ORDERED_TIER";b[b.VISIBLE=0]="VISIBLE";b[b.PREFETCH=1]="PREFETCH";b[b.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER";b[b.RECENT=2]="RECENT";b[b.LAST_TIER=2]="LAST_TIER"})(e.ChunkPriorityTier||(e.ChunkPriorityTier={}));var m=function(){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.itemCapacity=this.availableItems=a;this.sizeCapacity=this.availableSize=c}d(b,[{key:"adjust",value:function(a,b){this.availableItems+=a;this.availableSize+=b}},
{key:"toString",value:function(){return this.availableItems+"/"+this.itemCapacity+" items, "+this.availableSize+"/"+this.sizeCapacity+" size"}},{key:"toObject",value:function(){return{itemCapacity:this.itemCapacity,sizeCapacity:this.sizeCapacity}}}],[{key:"fromObject",value:function(a){return new b(a.itemCapacity,a.sizeCapacity)}}]);return b}();m.INFINITE=new m(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);e.AvailableCapacity=m},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var c=function v(a,b,c){null===a&&
(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(35);g=d(7);var l=d(37),h=d(38);d=function(){function b(c){a(this,
b);this.source=c;this.state=k.ChunkState.SYSTEM_MEMORY}f(b,[{key:"copyToGPU",value:function(a){this.state=k.ChunkState.GPU_MEMORY}},{key:"freeGPUMemory",value:function(a){this.state=k.ChunkState.SYSTEM_MEMORY}},{key:"gl",get:function(){return this.source.gl}}]);return b}();e.Chunk=d;d=function(c){function d(b,c,e){a(this,d);var h=m(this,Object.getPrototypeOf(d).call(this));h.gl=c;h.visibleChunksChanged=new l.Signal;h.pendingChunkUpdates=null;h.pendingChunkUpdatesTail=null;h.chunkUpdateDeadline=null;
h.chunkUpdateDelay=30;h.initializeCounterpart(b,{type:"ChunkQueueManager",gpuMemoryCapacity:e.gpuMemory.toObject(),systemMemoryCapacity:e.systemMemory.toObject(),downloadCapacity:e.download.toObject()});return h}b(d,c);f(d,[{key:"scheduleChunkUpdate",value:function(){var a=this.chunkUpdateDeadline,b=void 0,b=null===a||Date.now()<a?0:this.chunkUpdateDelay;setTimeout(this.processPendingChunkUpdates.bind(this),b)}},{key:"processPendingChunkUpdates",value:function(){var a=this.chunkUpdateDeadline;if(null!==
a&&Date.now()>a)setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);else{var a=this.pendingChunkUpdates,b=this.rpc.get(a.source),c=a.state;if(c===k.ChunkState.EXPIRED)b.deleteChunk(a.id);else{var d=void 0,e=a.id;a["new"]?(d=b.getChunk(a),b.addChunk(e,d)):d=b.chunks.get(e);if(c!==d.state)switch(c){case k.ChunkState.GPU_MEMORY:d.copyToGPU(this.gl);this.visibleChunksChanged.dispatch();break;case k.ChunkState.SYSTEM_MEMORY:d.freeGPUMemory(this.gl);break;default:throw Error("INTERNAL ERROR: Invalid chunk state: "+
k.ChunkState[c]);}}null!=(this.pendingChunkUpdates=a.nextUpdate)?this.scheduleChunkUpdate():this.pendingChunkUpdatesTail=null}}}]);return d}(g.SharedObject);e.ChunkQueueManager=d;g.registerRPC("Chunk.update",function(a){var b=this.get(a.source).chunkManager.chunkQueueManager,c=b.pendingChunkUpdatesTail;null==c?(b.pendingChunkUpdates=a,b.pendingChunkUpdatesTail=a,b.scheduleChunkUpdate()):(c.nextUpdate=a,b.pendingChunkUpdatesTail=a)});d=function(c){function d(b){a(this,d);var c=m(this,Object.getPrototypeOf(d).call(this));
c.chunkQueueManager=b;c.chunkSourceCache=new Map;c.registerDisposer(b.addRef());c.initializeCounterpart(b.rpc,{type:"ChunkManager",chunkQueueManager:b.rpcId});return c}b(d,c);f(d,[{key:"getChunkSource",value:function(a,b,c){var d=this.chunkSourceCache,e=d.get(a);void 0===e&&(e=new h.Memoize,d.set(a,e));return e.get(b,c)}}]);return d}(g.SharedObject);e.ChunkManager=d;g=function(d){function e(b){a(this,e);var c=m(this,Object.getPrototypeOf(e).call(this));c.chunkManager=b;c.chunks=new Map;c.registerDisposer(b.addRef());
return c}b(e,d);f(e,[{key:"initializeCounterpart",value:function(a,b){b.chunkManager=this.chunkManager.rpcId;c(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"deleteChunk",value:function(a){this.chunks.delete(a)}},{key:"addChunk",value:function(a,b){this.chunks.set(a,b)}},{key:"getChunk",value:function(a){return null}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return e}(g.SharedObject);e.ChunkSource=g},function(g,e,d){var m;
(function(b){function a(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}function c(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function f(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){f.prototype.dispatch.apply(a,arguments)}}a.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):
a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+
", isBound:"+this.isBound()+", active:"+this.active+"]"}};f.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(b,c,d,e){var f=this._indexOfListener(b,d);if(-1!==f){if(b=this._bindings[f],b.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else b=new a(this,b,c,d,e),this._addBinding(b);this.memorize&&this._prevParams&&b.execute(this._prevParams);return b},
_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,d){c(a,"add");return this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){c(a,"addOnce");return this._registerListener(a,!0,
b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=
b);if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};f.Signal=f;!(m=function(){return f}.call(e,d,e,g),void 0!==m&&(g.exports=m))})(this)},function(g,e){var d=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=
b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),m=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.map=new Map}d(b,[{key:"get",value:function(a,b){var d=this.map,e=d.get(a);void 0===e?(e=b(),e.registerDisposer(function(){d.delete(a)}),d.set(a,e)):e.addRef();return e}}]);return b}();e.Memoize=m},function(g,
e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){for(var b=0,c=0;3>c;++c)0>a[c]&&(b+=1<<c);return b}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(40),l=d(41);g=d(8);var h=d(21),n=d(42),v=d(35),p=d(37),A=d(7),q=function(c){function d(a){m(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));
c.outputVertexIndices=c.registerDisposer(k.Buffer.fromData(a,new Float32Array([0,1,2,3,4,5]),a.ARRAY_BUFFER,a.STATIC_DRAW));c.vertexBasePositions=[0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1];a=[0,1,2,4,5,3,6,7];for(var e=[0,1,2,5,3,4,6,7],h=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],f=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],n=[],l=0;8>l;++l)for(var g=
0;g<h.length;++g)n.push(a[f[8*e[l]+h[g]]]);c.vertexIndices=new Int32Array(n);return c}a(d,c);f(d,null,[{key:"get",value:function(a){return a.memoize.get("SliceViewShaderBuffers",function(){return new d(a)})}}]);return d}(g.RefCounted),r=function(d){function e(a){m(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.data=c.registerDisposer(q.get(a));return c}a(e,d);f(e,[{key:"defineShader",value:function(a){var b=this.data;a.addAttribute("highp float","aVertexIndexFloat");a.addUniform("highp vec3",
"uTranslation");a.addUniform("highp mat4","uProjectionMatrix");a.addUniform("highp vec3","uPlaneNormal");a.addUniform("highp float","uPlaneDistance");a.addUniform("highp ivec2","uVertexIndex",24);a.addUniform("highp vec3","uVertexBasePosition",8);a.addInitializer(function(a){a.gl.uniform3fv(a.uniform("uVertexBasePosition"),new Float32Array(b.vertexBasePositions))});a.addUniform("highp vec3","uChunkSize");a.addVarying("highp vec3","vChunkPosition");a.setVertexMain("\nint vertexIndex = int(aVertexIndexFloat);\nfor (int e = 0; e < 4; ++e) {\n  highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n  highp vec3 v1 = uChunkSize * uVertexBasePosition[vidx.x];\n  highp vec3 v2 = uChunkSize * uVertexBasePosition[vidx.y];\n  highp vec3 vStart = v1 + uTranslation;\n  highp vec3 vDir = v2 - v1;\n  highp float denom = dot(vDir, uPlaneNormal);\n  if (abs(denom) > 1e-6) {\n    highp float lambda = (uPlaneDistance - dot(vStart, uPlaneNormal)) / denom;\n    if ((lambda >= 0.0) && (lambda <= 1.0)) {\n      highp vec3 position = vStart + lambda * vDir;\n      gl_Position = uProjectionMatrix * vec4(position, 1.0);\n      vChunkPosition = mix(uVertexBasePosition[vidx.x], uVertexBasePosition[vidx.y], lambda);\n      break;\n    }\n  }\n}\n")}},
{key:"computeVerticesDebug",value:function(a,b,d,e,f){for(var n=c(d),n=this.data.vertexIndices.subarray(48*n,48*(n+1)),l=[0,0],k=[h.vec3.create(),h.vec3.create()],g=h.vec3.create(),p=h.vec3.create(),v=h.vec3.create(),q=h.vec3.create(),m=h.vec3.create(),r=new Float32Array(this.data.vertexBasePositions),u=function(a){return r.subarray(3*a,3*a+3)},w=0;6>w;++w)for(var A=0;4>A;++A){for(var I=0;2>I;++I)l[I]=n[2*(4*w+A)+I],h.vec3.multiply(k[I],a,u(l[I]));h.vec3.add(g,k[0],e);h.vec3.subtract(p,k[1],k[0]);
I=h.vec3.dot(p,d);if(1E-6<Math.abs(I)){var O=(b-h.vec3.dot(g,d))/I;if(0<=O&&1>=O){h.vec3.scaleAndAdd(v,g,p,O);h.vec3.transformMat4(q,h.vec4.fromValues(v[0],v[1],v[2],1),f);h.vec3.scale(m,u(l[0]),1-O);h.vec3.scaleAndAdd(m,m,u(l[1]),O);console.log("vertex "+w+" at "+q+", vChunkPosition = "+m+", edge dir = "+p+", denom = "+I);break}}}}},{key:"beginSlice",value:function(a,b,d,e){var h=e.viewportAxes[2],f=c(h);a.uniformMatrix4fv(b.uniform("uProjectionMatrix"),!1,d);a.uniform3fv(b.uniform("uPlaneNormal"),
h.subarray(0,3));a.uniform1f(b.uniform("uPlaneDistance"),e.viewportPlaneDistanceToOrigin);d=b.attribute("aVertexIndexFloat");this.data.outputVertexIndices.bindToVertexAttrib(d,1);a.uniform2iv(b.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*f,48*(f+1)))}},{key:"endSlice",value:function(a,b){var c=b.attribute("aVertexIndexFloat");a.disableVertexAttribArray(c)}},{key:"setupChunkSize",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkSize"),c)}},{key:"drawChunk",value:function(a,b,c){a.uniform3fv(b.uniform("uTranslation"),
c);a.drawArrays(a.TRIANGLE_FAN,0,6)}}],[{key:"get",value:function(a){return a.memoize.get("sliceview.VolumeSliceVertexComputationManager",function(){return new e(a)})}}]);return e}(g.RefCounted);d=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.chunkManager=a;e.sources=null;e.shader=null;e.shaderUpdated=!0;e.redrawNeeded=new p.Signal;e.voxelSize=null;e.boundingBox=null;e.rpcId=null;e.vertexComputationManager=r.get(e.gl);Promise.resolve(c).then(function(b){var c=
e.sources=b.getSources(a);b=[];for(var c=$jscomp.makeIterator(c),d=c.next();!d.done;d=c.next()){var f=d.value,d=[];b.push(d);for(var f=$jscomp.makeIterator(f),n=f.next();!n.done;n=f.next())d.push(n.value.rpcId)}c=e.registerDisposer(new A.SharedObject);c.initializeCounterpart(a.rpc,{type:"sliceview/RenderLayer",sources:b});e.rpcId=c.rpcId;b=e.sources[0][0].spec;e.voxelSize=b.voxelSize;e.boundingBox=new h.BoundingBox(b.lowerVoxelBound,b.upperVoxelBound);e.setReady(!0)});return e}a(d,c);f(d,[{key:"initializeShader",
value:function(){if(this.shaderUpdated){this.shaderUpdated=!1;var a=this.getShader();this.disposeShader();this.shader=a}}},{key:"disposeShader",value:function(){this.shader&&(this.shader.dispose(),this.shader=null)}},{key:"dispose",value:function(){this.disposeShader()}},{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next())for(var c=$jscomp.makeIterator(c.value),d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d;return null}},
{key:"getShaderKey",value:function(){return""}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey()+"/"+this.chunkFormat.shaderKey;return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"buildShader",value:function(){var a=new l.ShaderBuilder(this.gl);this.defineShader(a);return a.build()}},{key:"defineShader",value:function(a){this.vertexComputationManager.defineShader(a);a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragData[0] = color;\n}\n");this.chunkFormat.defineShader(a)}},
{key:"beginSlice",value:function(a){var b=a.dataToDevice,c=this.gl,d=this.shader;d.bind();this.vertexComputationManager.beginSlice(c,d,b,a);return d}},{key:"endSlice",value:function(a){this.vertexComputationManager.endSlice(this.gl,a)}},{key:"draw",value:function(a){var b=a.visibleLayers.get(this);if(0!==b.length){this.initializeShader();var c=this.gl,d=h.vec3.create(),e=h.vec3.create(),f=this.beginSlice(a),n=this.vertexComputationManager,l=this.chunkFormat;l.beginDrawing(c,f);for(var b=$jscomp.makeIterator(b),
k=b.next();!k.done;k=b.next()){var k=k.value,g=k.spec.chunkLayout,p=g.offset,q=k.chunks,m=g.size,r=null;if(g=a.visibleChunks.get(g))for(var g=$jscomp.makeIterator(g),u=g.next();!u.done;u=g.next())if((u=q.get(u.value))&&u.state===v.ChunkState.GPU_MEMORY){var w=u.chunkDataSize;w!==r&&(r=w,h.vec3.multiply(e,r,k.spec.voxelSize),n.setupChunkSize(c,f,e));h.vec3.multiply(d,m,u.chunkGridPosition);h.vec3.add(d,d,p);l.bindChunk(c,f,u);n.drawChunk(c,f,d)}}l.endDrawing(c,f);this.endSlice(f)}}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}},
{key:"chunkFormat",get:function(){return this.sources[0][0].chunkFormat}}]);return d}(n.RenderLayer);e.RenderLayer=d},function(g,e){var d=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),m=function(){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.gl=a;
this.bufferType=c;this.gl=a;this.buffer=a.createBuffer();void 0===this.bufferType&&(this.bufferType=a.ARRAY_BUFFER)}d(b,[{key:"bind",value:function(){this.gl.bindBuffer(this.bufferType,this.buffer)}},{key:"bindToVertexAttrib",value:function(a,b){var d=2>=arguments.length||void 0===arguments[2]?this.gl.FLOAT:arguments[2],e=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],l=4>=arguments.length||void 0===arguments[4]?0:arguments[4],h=5>=arguments.length||void 0===arguments[5]?0:arguments[5];
this.bind();this.gl.enableVertexAttribArray(a);this.gl.vertexAttribPointer(a,b,d,e,l,h)}},{key:"setData",value:function(a,b){var d=this.gl;void 0===b&&(b=d.STATIC_DRAW);this.bind();d.bufferData(this.bufferType,a,b)}},{key:"dispose",value:function(){this.gl.deleteBuffer(this.buffer);this.gl=this.buffer=null}}],[{key:"fromData",value:function(a,c,d,e){a=new b(a,d);a.setData(c,e);return a}}]);return b}();e.Buffer=m},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(c),Error("Error creating shader: "+
a);return c}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);e.getShader=a;var f=function(d){function e(b,c,d,f,l){m(this,e);var k;k=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");k=!k||"object"!==typeof k&&"function"!==
typeof k?this:k;k.gl=b;k.vertexSource=c;k.fragmentSource=d;k.attributes=new Map;k.uniforms=new Map;k.textureUnits=null;c=k.vertexShader=a(b,c,b.VERTEX_SHADER);var g=k.fragmentShader=a(b,d,b.FRAGMENT_SHADER);d=k.program=b.createProgram();b.attachShader(d,c);b.attachShader(d,g);b.linkProgram(d);if(!b.getProgramParameter(d,b.LINK_STATUS))throw b=b.getProgramInfoLog(d),Error("Could not initialize shaders: "+b);g=k.uniforms;c=k.attributes;if(f){f=$jscomp.makeIterator(f);for(var u=f.next();!u.done;u=f.next())u=
u.value,g.set(u,b.getUniformLocation(d,u))}if(l)for(l=$jscomp.makeIterator(l),f=l.next();!f.done;f=l.next())f=f.value,c.set(f,b.getAttribLocation(d,f));return k}b(e,d);c(e,[{key:"uniform",value:function(a){return this.uniforms.get(a)}},{key:"attribute",value:function(a){return this.attributes.get(a)}},{key:"textureUnit",value:function(a){return this.textureUnits.get(a)}},{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"disposed",value:function(){var a=this.gl;a.deleteShader(this.vertexShader);
this.vertexShader=null;a.deleteShader(this.fragmentShader);this.fragmentShader=null;a.deleteProgram(this.program);this.uniforms=this.attributes=this.gl=this.program=null}}]);return e}(g.RefCounted);e.ShaderProgram=f;var k=function(){function a(){m(this,a);this.code="";this.parts=new Set}c(a,[{key:"add",value:function(a){if(!this.parts.has(a))switch(this.parts.add(a),typeof a){case "string":this.code+=a;break;case "function":this.add(a());break;default:if(Array.isArray(a)){a=$jscomp.makeIterator(a);
for(var b=a.next();!b.done;b=a.next())this.add(b.value)}else throw Error("Invalid code type");}}},{key:"toString",value:function(){return this.code}}]);return a}();e.ShaderCode=k;g=function(){function a(b){m(this,a);this.gl=b;this.nextTextureUnit=this.nextSymbolID=0;this.varyingsCode=this.attributesCode=this.uniformsCode="";this.fragmentExtensionsSet=new Set;this.fragmentExtensions="";this.vertexCode=new k;this.vertexMain="";this.fragmentCode=new k;this.fragmentMain="";this.required=new Set;this.uniforms=
[];this.attributes=[];this.initializers=[];this.textureUnits=new Map}c(a,[{key:"allocateTextureUnit",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?1:arguments[1];if(this.textureUnits.has(a))throw Error("Duplicate texture unit symbol: "+a);var c=this.nextTextureUnit;this.nextTextureUnit+=b;this.textureUnits.set(a,c);return c}},{key:"addTextureSampler2D",value:function(a,b,c){var d=this.allocateTextureUnit(b,c);this.addUniform("highp sampler2D",a,c);this.addInitializer(function(b){if(c){for(var e=
new Int32Array(c),f=0;f<c;++f)e[f]=f+d;b.gl.uniform1iv(b.uniform(a),e)}else b.gl.uniform1i(b.uniform(a),d)});return d}},{key:"symbol",value:function(a){return a+this.nextSymbolID++}},{key:"addAttribute",value:function(a,b){this.attributes.push(b);this.attributesCode+="attribute "+a+" "+b+";\n";return b}},{key:"addVarying",value:function(a,b){this.varyingsCode+="varying "+a+" "+b+";\n"}},{key:"addUniform",value:function(a,b,c){this.uniforms.push(b);this.uniformsCode=null!=c?this.uniformsCode+("uniform "+
a+" "+b+"["+c+"];\n"):this.uniformsCode+("uniform "+a+" "+b+";\n");return b}},{key:"addFragmentExtension",value:function(a){this.fragmentExtensionsSet.has(a)||(this.fragmentExtensionsSet.add(a),this.fragmentExtensions+="#extension "+a+" : require\n")}},{key:"addVertexCode",value:function(a){this.vertexCode.add(a)}},{key:"addFragmentCode",value:function(a){this.fragmentCode.add(a)}},{key:"setVertexMain",value:function(a){this.vertexMain=a}},{key:"setFragmentMain",value:function(a){this.fragmentMain=
a}},{key:"addInitializer",value:function(a){this.initializers.push(a)}},{key:"require",value:function(a){this.required.has(a)||(this.required.add(a),a(this))}},{key:"build",value:function(){var a=new f(this.gl,"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.attributesCode+"\n"+this.varyingsCode+"\n"+this.vertexCode+"\nvoid main() {\n"+this.vertexMain+"\n}\n","\n"+this.fragmentExtensions+"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.varyingsCode+"\n"+this.fragmentCode+"\nvoid main() {\n"+
this.fragmentMain+"\n}\n",this.uniforms,this.attributes);a.textureUnits=this.textureUnits;var b=this.initializers;if(0<b.length){a.bind();for(var b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())c=c.value,c(a)}return a}}]);return a}();e.ShaderBuilder=g},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=
[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,
e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(37);g=d(8);var l=d(43),h=d(21),n=d(44),v=d(45);d=function(c){function d(){m(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.ready=!1;a.layerChanged=new k.Signal;a.readyStateChanged=new k.Signal;a.voxelSize=null;a.boundingBox=null;return a}a(d,c);f(d,[{key:"setReady",value:function(a){this.ready=
a;this.readyStateChanged.dispatch();this.layerChanged.dispatch()}},{key:"handleAction",value:function(a){}},{key:"getValueAt",value:function(a){}}]);return d}(g.RefCounted);e.RenderLayer=d;d=function(c){function d(){var a=0>=arguments.length||void 0===arguments[0]?[]:arguments[0];m(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.layersChanged=new k.Signal;c.readyStateChanged=new k.Signal;c.specificationChanged=new k.Signal;c.renderLayers=[];a.forEach(c.addRenderLayer.bind(c));return c}
a(d,c);f(d,[{key:"addRenderLayer",value:function(a){this.renderLayers.push(a);var b=this.layersChanged,c=this.readyStateChanged;this.registerDisposer(a);this.registerSignalBinding(a.layerChanged.add(b.dispatch,b));this.registerSignalBinding(a.readyStateChanged.add(c.dispatch,c));b.dispatch()}},{key:"getValueAt",value:function(a,b,c){var d=void 0,e=this.renderLayers;if(-1!==e.indexOf(b))return c;b=$jscomp.makeIterator(e);for(c=b.next();!c.done&&(c=c.value,!c.ready||(d=c.getValueAt(a),void 0===d));c=
b.next());return d}},{key:"toJSON",value:function(){return null}},{key:"makeDropdown",value:function(a){return null}},{key:"handleAction",value:function(a){}}]);return d}(g.RefCounted);e.UserLayer=d;var p=function(c){function d(a){var c=1>=arguments.length||void 0===arguments[1]?null:arguments[1],e=2>=arguments.length||void 0===arguments[2]?!0:arguments[2];m(this,d);var f=b(this,Object.getPrototypeOf(d).call(this));f.name=a;f.visible=e;f.readyStateChanged=new k.Signal;f.layerChanged=new k.Signal;
f.specificationChanged=new k.Signal;f.wasDisposed=!1;f.layer_=null;f.layer=c;return f}a(d,c);f(d,[{key:"updateSignalBindings",value:function(a,b){b(a.layersChanged,this.handleLayerChanged,this);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);b(a.specificationChanged,this.specificationChanged.dispatch,this.specificationChanged)}},{key:"handleLayerChanged",value:function(){this.visible&&this.layerChanged.dispatch()}},{key:"setVisible",value:function(a){a!==this.visible&&
(this.visible=a,this.layerChanged.dispatch())}},{key:"disposed",value:function(){this.wasDisposed=!0}},{key:"layer",get:function(){return this.layer_},set:function(a){var b=this.layer_;null!=b&&this.updateSignalBindings(b,n.removeSignalBinding);this.layer_=a;null!=a&&(this.updateSignalBindings(a,n.addSignalBinding),this.readyStateChanged.dispatch(),this.handleLayerChanged())}}]);return d}(g.RefCounted);e.ManagedUserLayer=p;d=function(d){function e(){m(this,e);for(var a=arguments.length,c=Array(a),
d=0;d<a;d++)c[d]=arguments[d];var f,a=b(this,(f=Object.getPrototypeOf(e)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.managedLayers=[];a.layersChanged=new k.Signal;a.readyStateChanged=new k.Signal;a.specificationChanged=new k.Signal;a.boundPositions=new WeakSet;return a}a(e,d);f(e,[{key:"updateSignalBindings",value:function(a,b){b(a.layerChanged,this.layersChanged.dispatch,this.layersChanged);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);b(a.specificationChanged,
this.specificationChanged.dispatch,this.specificationChanged)}},{key:"addManagedLayer",value:function(a){this.updateSignalBindings(a,n.addSignalBinding);this.managedLayers.push(a);this.layersChanged.dispatch();return a}},{key:"addUserLayer",value:function(a,b,c){a=new p(a,b,c);return this.addManagedLayer(a)}},{key:"readyRenderLayers",value:function(){function a(n,g){for(;;)switch(b){case 0:l=$jscomp.makeIterator(k.managedLayers),h=l.next();case 1:if(h.done){b=3;break}f=h.value;if(f.visible&&f.layer){b=
4;break}b=2;break;case 4:e=$jscomp.makeIterator(f.layer.renderLayers),d=e.next();case 5:if(d.done){b=7;break}c=d.value;if(c.ready){b=8;break}b=6;break;case 8:return b=9,{value:c,done:!1};case 9:if(void 0===g){b=10;break}b=-1;throw g;case 10:case 6:d=e.next();b=5;break;case 7:case 2:h=l.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,h,l,k=this,n={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}},{key:"unbindManagedLayer",value:function(a){this.updateSignalBindings(a,n.removeSignalBinding);a.dispose()}},{key:"clear",value:function(){for(var a=$jscomp.makeIterator(this.managedLayers),b=a.next();!b.done;b=a.next())this.unbindManagedLayer(b.value);this.managedLayers.length=0;this.layersChanged.dispatch()}},{key:"removeManagedLayer",value:function(a){var b=this.managedLayers.indexOf(a);if(-1===b)throw Error("Internal error: invalid managed layer.");
this.unbindManagedLayer(a);this.managedLayers.splice(b,1);this.layersChanged.dispatch()}},{key:"reorderManagedLayer",value:function(a,b){var d=this.managedLayers.length;a===b||0>a||a>=d||0>b||b>=d||(d=this.managedLayers.splice(a,1),d=c(d,1)[0],this.managedLayers.splice(b,0,d),this.layersChanged.dispatch())}},{key:"disposed",value:function(){this.clear()}},{key:"getLayerByName",value:function(a){return this.managedLayers.find(function(b){return b.name===a})}},{key:"initializePosition",value:function(a){var b=
this;if(!a.valid&&!this.updatePositionFromLayers(a)){var c=this.boundPositions;if(!c.has(a)){c.add(a);var d=function(){b.updatePositionFromLayers(a);a.valid&&(b.readyStateChanged.remove(d),b.boundPositions.delete(a))};this.readyStateChanged.add(d)}}}},{key:"updatePositionFromLayers",value:function(a){if(!a.valid)for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value.layer,null!=c)for(var c=$jscomp.makeIterator(c.renderLayers),d=c.next();!d.done;d=c.next())if(d=
d.value,d.ready&&(a.voxelSize.valid||null==d.voxelSize||(h.vec3.copy(a.voxelSize.size,d.voxelSize),a.voxelSize.setValid()),!a.spatialCoordinatesValid&&!a.voxelCoordinatesValid&&null!=d.boundingBox)){var d=d.boundingBox,e=h.vec3.create();h.vec3.add(e,d.lower,d.upper);h.vec3.scale(e,e,.5);a.setVoxelCoordinates(e)}}},{key:"invokeAction",value:function(a){for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value,c.visible){c=c.layer;c.handleAction(a);for(var c=$jscomp.makeIterator(c.renderLayers),
d=c.next();!d.done;d=c.next())d=d.value,d.ready&&d.handleAction(a)}}},{key:"renderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(n,g){for(;;)switch(c){case 0:k=$jscomp.makeIterator(a.managedLayers),l=k.next();case 1:if(l.done){c=3;break}h=l.value;f=$jscomp.makeIterator(h.layer.renderLayers);e=f.next();case 4:if(e.done){c=6;break}d=e.value;c=7;return{value:d,done:!1};case 7:if(void 0===g){c=8;break}c=-1;throw g;
case 8:case 5:e=f.next();c=4;break;case 6:case 2:l=k.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,l,k,n={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n},b}},{key:"visibleRenderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(n,
g){for(;;)switch(c){case 0:k=$jscomp.makeIterator(a.managedLayers),l=k.next();case 1:if(l.done){c=3;break}h=l.value;if(h.visible){c=4;break}c=2;break;case 4:f=$jscomp.makeIterator(h.layer.renderLayers),e=f.next();case 5:if(e.done){c=7;break}d=e.value;c=8;return{value:d,done:!1};case 8:if(void 0===g){c=9;break}c=-1;throw g;case 9:case 6:e=f.next();c=5;break;case 7:case 2:l=k.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,l,k,n={next:function(a){return b(a,void 0)},
throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n},b}}]);return e}(g.RefCounted);e.LayerManager=d;d=function(){function a(){var b=this;m(this,a);this.changed=new k.Signal;this.position=h.vec3.create();this.active=!1;this.pickedRenderLayer=null;this.pickedValue=new l.Uint64(0,0);this.stale=!1;this.triggerUpdate=v(function(){b.update()},50,{leading:!0,trailing:!0})}f(a,[{key:"updateUnconditionally",
value:function(){this.triggerUpdate.cancel();this.update();return this.active}},{key:"updateIfStale",value:function(){this.stale&&this.update()}},{key:"update",value:function(){var a=this.updater;this.stale=!1;a?this.setActive(a(this)):this.setActive(!1)}},{key:"setActive",value:function(a){this.stale=!1;if(this.active!==a||!0===a)this.active=a,this.changed.dispatch()}}]);return a}();e.MouseSelectionState=d;d=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));
e.layerManager=a;e.mouseState=c;e.values=new Map;e.changed=new k.Signal;e.needsUpdate=!0;e.registerSignalBinding(c.changed.add(e.handleChange,e));e.registerSignalBinding(a.layersChanged.add(function(){e.handleLayerChange()}));return e}a(d,c);f(d,[{key:"handleLayerChange",value:function(){this.mouseState.active&&this.handleChange()}},{key:"handleChange",value:function(){this.needsUpdate=!0;this.changed.dispatch()}},{key:"update",value:function(){if(this.needsUpdate){this.needsUpdate=!1;var a=this.values,
b=this.mouseState;a.clear();if(b.active)for(var c=b.position,d=$jscomp.makeIterator(this.layerManager.managedLayers),e=d.next();!e.done;e=d.next()){var e=e.value,f=e.layer;e.visible&&f&&a.set(f,f.getValueAt(c,b.pickedRenderLayer,b.pickedValue))}}}},{key:"get",value:function(a){this.update();return this.values.get(a)}}]);return d}(g.RefCounted);e.LayerSelectedValues=d;g=function(c){function d(a,c,e,f){m(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.layerManager=a;h.renderLayerType=c;
h.layerAdded=e;h.layerRemoved=f;h.visibleLayers=new Set;h.newVisibleLayers=new Set;h.updatePending=null;h.registerSignalBinding(a.layersChanged.add(h.handleLayersChanged,h));h.updateVisibleLayers();return h}a(d,c);f(d,[{key:"handleLayersChanged",value:function(){if(null===this.updatePending){var a=this;this.updatePending=setTimeout(function(){a.updatePending=null;a.updateVisibleLayers()},0)}}},{key:"disposed",value:function(){this.cancelUpdate();this.visibleLayers.forEach(this.layerRemoved);this.visibleLayers.clear()}},
{key:"cancelUpdate",value:function(){var a=this.updatePending;null!==a&&clearTimeout(a)}},{key:"updateVisibleLayers",value:function(){for(var a=this.visibleLayers,b=this.newVisibleLayers,c=this.renderLayerType,d=this.layerAdded,e=this.layerRemoved,f=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),h=f.next();!h.done;h=f.next())h=h.value,h instanceof c&&(b.add(h),a.has(h)||(a.add(h),d(h)));c=$jscomp.makeIterator(a);for(d=c.next();!d.done;d=c.next())d=d.value,b.has(d)||(a.delete(d),e(d));
b.clear()}},{key:"getVisibleLayers",value:function(){null!==this.updatePending&&(this.cancelUpdate(),this.updateVisibleLayers());return this.visibleLayers}}]);return d}(g.RefCounted);e.VisibleRenderLayerTracker=g},function(g,e){var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=new Uint32Array(2),b=[],
a=2;for(;36>=a;++a){var c=Math.floor(32/Math.log2(a)),f=Math.pow(a,c),k=Math.floor(c/2),l=Math.pow(a,k),k=Math.pow(a,c-k),h="^[0-"+String.fromCharCode(48+Math.min(9,a-1));10<a&&(h+="a-"+String.fromCharCode(97+a-11),h+="A-"+String.fromCharCode(65+a-11));h+="]{1,"+Math.ceil(64/Math.log2(a))+"}$";b[a]={lowDigits:c,lowBase:f,lowBase1:l,lowBase2:k,pattern:new RegExp(h)}}a=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0],c=1>=arguments.length||void 0===arguments[1]?
0:arguments[1];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.low=b;this.high=c}d(a,[{key:"clone",value:function(){return new a(this.low,this.high)}},{key:"assign",value:function(a){this.low=a.low;this.high=a.high}},{key:"toString",value:function(){var a=0>=arguments.length||void 0===arguments[0]?10:arguments[0],c=this.low,d=this.high;if(0===d)return c.toString(a);var d=4294967296*d,e=b[a],f=e.lowBase,e=e.lowDigits,h=d%f,d=Math.floor(d/f),c=c+h,d=d+Math.floor(c/
f),c=(c%f).toString(a);return d.toString(a)+"0".repeat(e-c.length)+c}},{key:"parseString",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?10:arguments[1],d=b[c],e=d.lowDigits,f=d.lowBase,h=d.lowBase1,l=d.lowBase2;if(!d.pattern.test(a))return!1;if(a.length<=e)return this.low=parseInt(a,c),this.high=0,!0;e=a.length-e;d=parseInt(a.substr(e),c);c=parseInt(a.substr(0,e),c);f=Math.floor(c*f/4294967296);h=d+c%4294967296*h%4294967296*l%4294967296;4294967296<h&&(++f,h-=4294967296);if(h>>>
0!==h||f>>>0!==f)return!1;this.low=h;this.high=f;return!0}},{key:"valid",value:function(){var a=this.low,b=this.high;return a>>>0===a&&b>>>0===b}}],[{key:"less",value:function(a,b){return a.high<b.high||a.high===b.high&&a.low<b.low}},{key:"equal",value:function(a,b){return a.low===b.low&&a.high===b.high}},{key:"min",value:function(b,c){return a.less(b,c)?b:c}},{key:"random",value:function(){crypto.getRandomValues(m);return new a(m[0],m[1])}},{key:"parseString",value:function(b){var c=1>=arguments.length||
void 0===arguments[1]?10:arguments[1],d=new a;if(!d.parseString(b,c))throw Error("Failed to parse string as uint64 value: "+JSON.stringify(b)+".");return d}}]);return a}();a.ZERO=new a(0,0);e.Uint64=a},function(g,e){e.removeSignalBinding=function(d,e,b){d.remove(e,b)};e.addSignalBinding=function(d,e,b){d.add(e,b)}},function(g,e,d){var m=d(46),b=d(47);g.exports=function(a,c,d){var e=!0,l=!0;if("function"!=typeof a)throw new TypeError("Expected a function");b(d)&&(e="leading"in d?!!d.leading:e,l="trailing"in
d?!!d.trailing:l);return m(a,c,{leading:e,maxWait:c,trailing:l})}},function(g,e,d){var m=d(47),b=d(48),a=d(49),c=Math.max,f=Math.min;g.exports=function(d,e,h){function g(a){var b=r,c=w;r=w=void 0;B=a;return y=d.apply(c,b)}function v(a){var b=a-t;a-=B;return void 0===t||b>=e||0>b||z&&a>=u}function p(){var a=b();if(v(a))return A(a);var c=setTimeout,d;d=a-B;a=e-(a-t);d=z?f(a,u-d):a;x=c(p,d)}function A(a){x=void 0;if(D&&r)return g(a);r=w=void 0;return y}function q(){var a=b(),c=v(a);r=arguments;w=this;
t=a;if(c){if(void 0===x)return B=a=t,x=setTimeout(p,e),C?g(a):y;if(z)return x=setTimeout(p,e),g(t)}void 0===x&&(x=setTimeout(p,e));return y}var r,w,u,y,x,t,B=0,C=!1,z=!1,D=!0;if("function"!=typeof d)throw new TypeError("Expected a function");e=a(e)||0;m(h)&&(C=!!h.leading,u=(z="maxWait"in h)?c(a(h.maxWait)||0,e):u,D="trailing"in h?!!h.trailing:D);q.cancel=function(){B=0;r=t=w=x=void 0};q.flush=function(){return void 0===x?y:A(b())};return q}},function(g,e){g.exports=function(d){var e=typeof d;return!!d&&
("object"==e||"function"==e)}},function(g,e){g.exports=function(){return Date.now()}},function(g,e,d){var m=d(50),b=d(47),a=d(51),c=0/0,f=/^\s+|\s+$/g,k=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,h=/^0o[0-7]+$/i,n=parseInt;g.exports=function(d){if("number"==typeof d)return d;if(a(d))return c;b(d)&&(d=m(d.valueOf)?d.valueOf():d,d=b(d)?d+"":d);if("string"!=typeof d)return 0===d?d:+d;d=d.replace(f,"");var e=l.test(d);return e||h.test(d)?n(d.slice(2),e?2:8):k.test(d)?c:+d}},function(g,e,d){var m=d(47),b=Object.prototype.toString;
g.exports=function(a){a=m(a)?b.call(a):"";return"[object Function]"==a||"[object GeneratorFunction]"==a}},function(g,e,d){var m=d(52),b=Object.prototype.toString;g.exports=function(a){return"symbol"==typeof a||m(a)&&"[object Symbol]"==b.call(a)}},function(g,e){g.exports=function(d){return!!d&&"object"==typeof d}},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var f=d(54),k=d(55),l=d(40),h=d(21);d=function(d){function e(a){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],d=c.numDataBuffers,d=void 0===d?1:d,f=c.depthBuffer,f=void 0===f?!1:f,c=c.stencilBuffer,c=void 0===c?!1:c;m(this,e);var h=b(this,Object.getPrototypeOf(e).call(this));h.gl=a;h.width=null;h.height=null;h.framebuffer=h.gl.createFramebuffer();h.depthBuffer=
null;h.dataTextures=[];h.attachmentVerified=!1;h.tempPixel=new Uint8Array(4);h.fullAttachmentList=[];h.singleAttachmentList=[h.gl.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];for(var l=h.dataTextures,k=h.fullAttachmentList,g=0;g<d;++g)l[g]=a.createTexture(),k[g]=a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+g;if(f||c)h.depthBuffer=a.createRenderbuffer();h.useStencilBuffer=c;return h}a(e,d);c(e,[{key:"disposed",value:function(){var a=this.gl,b=this.depthBuffer;a.deleteFramebuffer(this.framebuffer);null!=
b&&a.deleteRenderbuffer(b);for(var b=$jscomp.makeIterator(this.dataTextures),c=b.next();!c.done;c=b.next())a.deleteTexture(c.value)}},{key:"resize",value:function(a,b){if(!this.hasSize(a,b)){this.width=a;this.height=b;for(var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer,h=$jscomp.makeIterator(this.dataTextures),l=h.next();!l.done;l=h.next())f.resizeTexture(c,l.value,a,b);e&&(c.bindRenderbuffer(c.RENDERBUFFER,e),c.renderbufferStorage(c.RENDERBUFFER,d?c.DEPTH_STENCIL:c.DEPTH_COMPONENT16,a,b),
c.bindRenderbuffer(c.RENDERBUFFER,null))}}},{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"bind",value:function(a,b){this.resize(a,b);var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffer);e&&c.framebufferRenderbuffer(c.FRAMEBUFFER,d?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e);this.dataTextures.forEach(function(a,b){c.framebufferTexture2D(c.FRAMEBUFFER,c.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+
b,c.TEXTURE_2D,a,0)});c.WEBGL_draw_buffers.drawBuffersWEBGL(this.fullAttachmentList);this.verifyAttachment();c.viewport(0,0,a,b)}},{key:"unbind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}},{key:"bindSingle",value:function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.dataTextures[a],0);b.WEBGL_draw_buffers.drawBuffersWEBGL(this.singleAttachmentList)}},{key:"readPixel",value:function(a,
b,c){var d=this.gl,e=this.tempPixel;try{this.bindSingle(a),d.readPixels(b,c,1,1,d.RGBA,d.UNSIGNED_BYTE,e)}finally{d.bindFramebuffer(d.FRAMEBUFFER,null)}return e}},{key:"readPixelAsUint32",value:function(a,b,c){a=this.readPixel(a,b,c);return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)}},{key:"verifyAttachment",value:function(){if(!this.attachmentVerified){var a=this.gl;if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer configuration not supported");this.attachmentVerified=
!0}}}]);return e}(g.RefCounted);e.OffscreenFramebuffer=d;d=function(d){function e(a){m(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.gl=a;c.copyVertexPositionsBuffer=c.registerDisposer(l.Buffer.fromData(c.gl,new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.copyTexCoordsBuffer=c.registerDisposer(l.Buffer.fromData(c.gl,new Float32Array([0,0,0,1,1,1,1,0]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.trivialTextureShader=c.registerDisposer(k.trivialTextureShader(c.gl));
return c}a(e,d);c(e,[{key:"draw",value:function(a){var b=this.gl,c=this.trivialTextureShader;c.bind();b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniform("uSampler"),0);b.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,h.identityMat4);a=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);c=c.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(c,2);b.drawArrays(b.TRIANGLE_FAN,0,4);b.disableVertexAttribArray(a);b.disableVertexAttribArray(c);
b.bindTexture(b.TEXTURE_2D,null)}}],[{key:"get",value:function(a){return a.memoize.get("OffscreenCopyHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);e.OffscreenCopyHelper=d},function(g,e){function d(d){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)}e.setRawTextureParameters=d;e.resizeTexture=
function(e,b,a,c){var f=4>=arguments.length||void 0===arguments[4]?e.RGBA:arguments[4],k=5>=arguments.length||void 0===arguments[5]?e.UNSIGNED_BYTE:arguments[5];e.activeTexture(e.TEXTURE0+e.tempTextureUnit);e.bindTexture(e.TEXTURE_2D,b);d(e);e.texImage2D(e.TEXTURE_2D,0,f,a,c,0,f,k,null);e.bindTexture(e.TEXTURE_2D,null)}},function(g,e,d){var m=d(41);e.trivialTextureShader=function(b){return b.memoize.get("trivialTextureShader",function(){var a=new m.ShaderBuilder(b);a.addVarying("vec2","vTexCoord");
a.addUniform("sampler2D","uSampler");a.addUniform("mat4","uProjectionMatrix");a.setFragmentMain("gl_FragColor = texture2D(uSampler, vTexCoord);");a.addAttribute("vec4","aVertexPosition");a.addAttribute("vec2","aTexCoord");a.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})};e.trivialColorShader=function(b){return b.memoize.get("trivialColorShader",function(){var a=new m.ShaderBuilder(b);a.addVarying("vec4","vColor");a.setFragmentMain("gl_FragColor = vColor;");
a.addAttribute("vec4","aVertexPosition");a.addAttribute("vec4","aColor");a.addUniform("mat4","uProjectionMatrix");a.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})};e.trivialUniformColorShader=function(b){return b.memoize.get("trivialUniformColorShader",function(){var a=new m.ShaderBuilder(b);a.addUniform("mat4","uProjectionMatrix");a.addAttribute("vec4","aVertexPosition");a.addUniform("vec4","uColor");a.setFragmentMain("gl_FragColor = uColor;");
a.setVertexMain("gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})}},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,
configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var c=function y(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:y(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(41),l=d(21),h=d(57),n=d(67);g=d(36);var v=d(35),p=d(40),A=d(7),q=function(){function b(){a(this,b);this.tempLightVec=l.vec4.create();this.tempPickID=new Float32Array(4)}f(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec3","aVertexNormal");a.addVarying("highp vec3","vColor");
a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");a.require(h.perspectivePanelEmit);a.setVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(aVertexPosition, 1.0));\nvec3 normal = (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = lightingFactor * uColor;\n");
a.setFragmentMain("emit(vec4(vColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,b,c){var d=c.dataToDevice,e=c.lightDirection,f=c.ambientLighting;c=c.directionalLighting;a.uniformMatrix4fv(b.uniform("uProjection"),!1,d);d=this.tempLightVec;l.vec3.scale(d,e,c);d[3]=f;a.uniform4fv(b.uniform("uLightDirection"),d)}},{key:"beginObject",value:function(a,b,c,d,e){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,c);a.uniform4fv(b.uniform("uPickID"),n.setVec4FromUint32(this.tempPickID,e));a.uniform3fv(b.uniform("uColor"),
d)}},{key:"getShader",value:function(a){var b=this;return a.memoize.get("mesh/MeshShaderManager",function(){var c=new k.ShaderBuilder(a);b.defineShader(c);return c.build()})}},{key:"drawFragment",value:function(a,b,c){c.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);c.normalBuffer.bindToVertexAttrib(b.attribute("aVertexNormal"),3);c.indexBuffer.bind();a.drawElements(a.TRIANGLES,c.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"));
a.disableVertexAttribArray(b.attribute("aVertexNormal"))}}]);return b}();e.MeshShaderManager=q;d=function(c){function d(b,c,e){a(this,d);var f=m(this,Object.getPrototypeOf(d).call(this));f.chunkManager=b;f.source=c;f.displayState=e;f.meshShaderManager=new q;f.shader=f.registerDisposer(f.meshShaderManager.getShader(f.gl));var h=function(){f.redrawNeeded.dispatch()};f.registerSignalBinding(e.segmentColorHash.changed.add(h));f.registerSignalBinding(e.visibleSegments.changed.add(h));f.registerSignalBinding(e.segmentSelectionState.changed.add(h));
f.registerDisposer(new A.SharedObject).initializeCounterpart(b.rpc,{type:"mesh/MeshLayer",chunkManager:b.rpcId,source:c.addCounterpartRef(),visibleSegmentSet:e.visibleSegments.rpcId});f.setReady(!0);return f}b(d,c);f(d,[{key:"draw",value:function(a){var b=this.gl,c=this.shader;c.bind();var d=this.meshShaderManager;d.beginLayer(b,c,a);var e=this.source.fragmentSource.objectChunks;a=a.pickIDs;var f=l.mat4.create();l.mat4.identity(f);for(var h=l.vec3.create(),k=this.displayState,g=k.segmentColorHash,
n=k.segmentSelectionState,k=$jscomp.makeIterator(k.visibleSegments),p=k.next();!p.done;p=k.next()){var p=p.value,m=e.get(p.low+":"+p.high);if(void 0!==m){g.compute(h,p);if(n.isSelected(p))for(var q=0;3>q;++q)h[q]=.5*h[q]+.5;d.beginObject(b,c,f,h,a.register(this,p));p=$jscomp.makeIterator(m);for(m=p.next();!m.done;m=p.next())m=m.value,m.state===v.ChunkState.GPU_MEMORY&&d.drawFragment(b,c,m)}}d.endLayer(b,c)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return d}(h.PerspectiveViewRenderLayer);
e.MeshLayer=d;var r=function(d){function e(b,c){a(this,e);var d=m(this,Object.getPrototypeOf(e).call(this,b));d.objectKey=c.objectKey;d.vertexPositions=c.vertexPositions;var f=d.indices=c.indices;d.numIndices=f.length;d.vertexNormals=c.vertexNormals;return d}b(e,d);f(e,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=p.Buffer.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=p.Buffer.fromData(a,this.indices,
a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.normalBuffer=p.Buffer.fromData(a,this.vertexNormals,a.ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose();this.normalBuffer.dispose()}}]);return e}(g.Chunk);e.FragmentChunk=r;var w=function(d){function e(b,c){a(this,e);var d=m(this,Object.getPrototypeOf(e).call(this,b));d.meshSource=c;d.objectChunks=new Map;d.initializeCounterpart(b.rpc,
{type:"mesh/FragmentSource"});return d}b(e,d);f(e,[{key:"addChunk",value:function(a,b){c(Object.getPrototypeOf(e.prototype),"addChunk",this).call(this,a,b);var d=this.objectChunks,f=b.objectKey,h=d.get(f);void 0===h&&(h=new Set,d.set(f,h));h.add(b)}},{key:"deleteChunk",value:function(a){var b=this.chunks.get(a);c(Object.getPrototypeOf(e.prototype),"deleteChunk",this).call(this,a);a=this.objectChunks;var d=b.objectKey,f=a.get(d);f.delete(b);0===f.size&&a.delete(d)}},{key:"getChunk",value:function(a){return new r(this,
a)}}]);return e}(g.ChunkSource);e.FragmentSource=w;d=function(d){function e(){a(this,e);for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];var f,b=m(this,(f=Object.getPrototypeOf(e)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));b.fragmentSource=new w(b.chunkManager,b);return b}b(e,d);f(e,[{key:"initializeCounterpart",value:function(a,b){b.fragmentSource=this.fragmentSource.addCounterpartRef();c(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,
a,b)}}]);return e}(g.ChunkSource);e.MeshSource=d},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(e.glsl_perspectivePanelEmit)}var f=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:D(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},k=function(){function a(b,
c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),l=d(58);g=d(42);var h=d(42),n=d(59),v=d(60),p=d(34),A=d(65),q=d(21),r=d(66),w=d(53),u=d(67),y=d(37);d(68);d(69);var x=function(c){function d(){m(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],
$jscomp.arrayFromIterable(c))));a.redrawNeeded=new y.Signal;return a}a(d,c);k(d,[{key:"draw",value:function(a){}},{key:"drawPicking",value:function(a){}}]);return d}(g.RenderLayer);e.PerspectiveViewRenderLayer=x;(function(a){a[a.COLOR=0]="COLOR";a[a.Z=1]="Z";a[a.PICK=2]="PICK";a[a.NUM_TEXTURES=3]="NUM_TEXTURES"})(e.OffscreenTextures||(e.OffscreenTextures={}));var t=e.OffscreenTextures;e.glsl_perspectivePanelEmit=[u.glsl_packFloat01ToFixedPoint,"\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+
t.COLOR+"] = color;\n  gl_FragData["+t.Z+"] = packFloat01ToFixedPoint(1.0 - gl_FragCoord.z);\n  gl_FragData["+t.PICK+"] = pickId;\n}\n"];e.perspectivePanelEmit=c;var B=q.vec3.create(),C=q.mat4.create();d=function(d){function e(a,d,f){m(this,e);var k=b(this,Object.getPrototypeOf(e).call(this,a,d,f));k.visibleLayerTracker=k.registerDisposer(new h.VisibleRenderLayerTracker(k.viewer.layerManager,x,function(a){a.redrawNeeded.add(k.scheduleRedraw,k);k.scheduleRedraw()},function(a){a.redrawNeeded.remove(k.scheduleRedraw,
k);k.scheduleRedraw()}));k.sliceViews=new Set;k.projectionMat=q.mat4.create();k.inverseProjectionMat=q.mat4.create();k.modelViewMat=q.mat4.create();k.width=null;k.height=null;k.pickIDs=new n.PickIDManager;k.axesLineHelper=k.registerDisposer(l.AxesLineHelper.get(k.gl));k.sliceViewRenderHelper=k.registerDisposer(p.SliceViewRenderHelper.get(k.gl,"SliceViewRenderHelper:PerspectivePanel",c));k.offscreenFramebuffer=new w.OffscreenFramebuffer(k.gl,{numDataBuffers:t.NUM_TEXTURES,depthBuffer:!0,stencilBuffer:!0});
k.offscreenCopyHelper=w.OffscreenCopyHelper.get(k.gl);k.registerSignalBinding(k.navigationState.changed.add(function(){k.viewportChanged()}));a=k.registerDisposer(new A.TrackableBooleanCheckbox(f.showSliceViews));a.element.className="perspective-panel-show-slice-views noselect";d=document.createElement("label");d.className="perspective-panel-show-slice-views noselect";d.appendChild(document.createTextNode("Slices"));d.appendChild(a.element);k.element.appendChild(d);k.registerSignalBinding(f.showSliceViews.changed.add(function(){k.scheduleRedraw()}));
k.registerSignalBinding(f.showAxisLines.changed.add(function(){k.scheduleRedraw()}));return k}a(e,d);k(e,[{key:"updateProjectionMatrix",value:function(){var a=this.projectionMat;q.mat4.perspective(a,Math.PI/4,this.width/this.height,10,5E3);var b=this.modelViewMat;this.navigationState.toMat4(b);q.vec3.set(B,1,-1,-1);q.mat4.scale(b,b,B);var c=q.vec3.set(B,0,0,100);q.mat4.translate(b,b,c);q.mat4.invert(C,b);q.mat4.multiply(a,a,C);q.mat4.invert(this.inverseProjectionMat,a)}},{key:"viewportChanged",value:function(){this.context.scheduleRedraw()}},
{key:"onResize",value:function(){this.width=this.element.clientWidth;this.height=this.element.clientHeight;this.viewportChanged()}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.dispose();this.sliceViews.clear()}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;if(!this.navigationState.valid)return!1;var b=a.position,c=this.offscreenFramebuffer,d=this.width,e=this.height;if(!c.hasSize(d,e))return!1;var f=this.mouseX,
h=e-this.mouseY,k=c.readPixel(t.Z,f,h),k=1-u.unpackFloat01FromFixedPoint(k);if(1===k)return!1;b[0]=2*f/d-1;b[1]=2*h/e-1;b[2]=2*k-1;q.vec3.transformMat4(b,b,this.inverseProjectionMat);this.pickIDs.setMouseState(a,c.readPixelAsUint32(t.PICK,f,h));return!0}},{key:"onMousedown",value:function(a){if(event.target===this.element&&(f(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.navigationState.valid&&0===a.button)){var b=this;r.startRelativeMouseDrag(a,function(a,c,d){b.navigationState.pose.rotateRelative(q.kAxes[1],
-c/4*Math.PI/180);b.navigationState.pose.rotateRelative(q.kAxes[0],d/4*Math.PI/180);b.viewer.navigationState.changed.dispatch()})}}},{key:"draw",value:function(){if(this.navigationState.valid){for(var a=$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.updateRendering();a=this.gl;this.offscreenFramebuffer.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.enable(a.DEPTH_TEST);var c=this.projectionMat;
this.updateProjectionMatrix();var d=q.vec4.create();q.vec4.transformMat4(d,q.kAxes[2],this.modelViewMat);q.vec4.normalize(d,d);b=this.pickIDs;b.clear();for(var b={dataToDevice:c,lightDirection:d.subarray(0,3),ambientLighting:.2,directionalLighting:.8,pickIDs:b},e=this.visibleLayerTracker.getVisibleLayers(),f=$jscomp.makeIterator(e),h=f.next();!h.done;h=f.next())h.value.draw(b);if(this.viewer.showSliceViews.value)for(var f=this.sliceViewRenderHelper,h=$jscomp.makeIterator(this.sliceViews),k=h.next();!k.done;k=
h.next()){var k=k.value,l=.2+.8*Math.abs(q.vec3.dot(d,k.viewportAxes[2])),g=C;q.mat4.identity(g);g[0]=k.width/2;g[5]=-k.height/2;q.mat4.multiply(g,k.viewportToData,g);q.mat4.multiply(g,c,g);f.draw(k.offscreenFramebuffer.dataTextures[0],g,q.vec4.fromValues(l,l,l,1),q.vec4.fromValues(.5,.5,.5,1),0,0,1,1)}this.viewer.showAxisLines.value&&(q.mat4.identity(C),C[0]=1600,C[5]=1600,C[10]=1600,d=this.navigationState.position.spatialCoordinates,C[12]=d[0],C[13]=d[1],C[14]=d[2],C[15]=1,q.mat4.multiply(C,c,C),
a.WEBGL_draw_buffers.drawBuffersWEBGL([a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]),this.axesLineHelper.draw(C,!1));a.WEBGL_draw_buffers.drawBuffersWEBGL([a.NONE,a.WEBGL_draw_buffers.COLOR_ATTACHMENT1_WEBGL,a.WEBGL_draw_buffers.COLOR_ATTACHMENT2_WEBGL]);c=$jscomp.makeIterator(e);for(d=c.next();!d.done;d=c.next())d.value.drawPicking(b);a.disable(a.DEPTH_TEST);this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[t.COLOR])}}},
{key:"zoomByMouse",value:function(a){this.navigationState.zoomBy(a)}},{key:"navigationState",get:function(){return this.viewer.navigationState}}]);return e}(v.RenderedDataPanel);e.PerspectivePanel=d},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var a=d(40),c=d(55);d=function(d){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d;d=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.gl=b;d.vertexBuffer=d.registerDisposer(a.Buffer.fromData(b,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),b.ARRAY_BUFFER,b.STATIC_DRAW));d.colorBuffer=d.registerDisposer(a.Buffer.fromData(b,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),b.ARRAY_BUFFER,b.STATIC_DRAW));d.trivialColorShader=d.registerDisposer(c.trivialColorShader(b));return d}m(e,d);b(e,[{key:"draw",value:function(a){var b=1>=arguments.length||
void 0===arguments[1]?!0:arguments[1],c=this.trivialColorShader,d=this.gl;c.bind();d.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a);var e=c.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(e,4);c=c.attribute("aColor");this.colorBuffer.bindToVertexAttrib(c,4);b&&(d.colorMask(!1,!1,!1,!0),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.colorMask(!0,!0,!0,!0),d.enable(d.BLEND),d.blendFunc(d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA));d.lineWidth(1);d.drawArrays(d.LINES,0,6);b&&d.disable(d.BLEND);
d.disableVertexAttribArray(e);d.disableVertexAttribArray(c)}}],[{key:"get",value:function(a){return a.memoize.get("SliceViewPanel:AxesLineHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);e.AxesLineHelper=d},function(g,e){var d=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),m=function(){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");this.renderLayers=[null];this.lowValues=[0];this.highValues=[0]}d(b,[{key:"clear",value:function(){this.renderLayers.length=1;this.lowValues.length=1;this.highValues.length=1}},{key:"register",value:function(a,b){var d=this.renderLayers,e=this.lowValues,l=this.highValues,h=d.length;d[h]=a;e[h]=b.low;l[h]=b.high;return h}},{key:"setMouseState",value:function(a,b){a.pickedRenderLayer=this.renderLayers[b];var d=a.pickedValue;d.low=this.lowValues[b];
d.high=this.highValues[b]}}]);return b}();e.PickIDManager=m},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(61);var c=d(21),f=d(63);d(64);e.KEY_COMMANDS=new Map;d=function(a){for(var b=c.AXES_NAMES[a],d=function(d){var f=0>d?"-":"+";e.KEY_COMMANDS.set("rotate-relative-"+b+f,function(){this.navigationState.pose.rotateRelative(c.kAxes[a],
.1*d)});var k=c.vec3.create();e.KEY_COMMANDS.set(""+b+f,function(){var b=this.navigationState;k[0]=0;k[1]=0;k[2]=0;k[a]=d;b.pose.translateVoxelsRelative(k)})},f=$jscomp.makeIterator([-1,1]),k=f.next();!k.done;k=f.next())d(k.value)};for(var k=0;3>k;++k)d(k);e.KEY_COMMANDS.set("snap",function(){this.navigationState.pose.snap()});e.KEY_COMMANDS.set("zoom-in",function(){this.navigationState.zoomBy(.5)});e.KEY_COMMANDS.set("zoom-out",function(){this.navigationState.zoomBy(2)});var l=c.vec3.create();g=
function(d){function k(a,b,c){if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");var d=m(this,Object.getPrototypeOf(k).call(this,a,b));d.viewer=c;d.mouseX=0;d.mouseY=0;d.mouseStateUpdater=d.updateMouseState.bind(d);b.classList.add("rendered-data-panel");d.registerEventListener(b,"mousemove",d.onMousemove.bind(d));d.registerEventListener(b,"mouseleave",d.onMouseout.bind(d));d.registerEventListener(b,"mousedown",d.onMousedown.bind(d),!1);d.registerEventListener(b,"wheel",
d.onMousewheel.bind(d),!1);d.registerEventListener(b,"dblclick",function(){d.viewer.layerManager.invokeAction("select")});return d}b(k,d);a(k,[{key:"onMouseout",value:function(a){a=this.viewer.mouseState;a.updater=void 0;a.setActive(!1)}},{key:"onKeyCommand",value:function(a){return(a=e.KEY_COMMANDS.get(a))?(a.call(this),!0):!1}},{key:"onMousemove",value:function(a){var b=this.element;a.target===b&&(this.mouseX=a.offsetX-b.clientLeft,this.mouseY=a.offsetY-b.clientTop,a=this.viewer.mouseState,a.updater=
this.mouseStateUpdater,a.triggerUpdate())}},{key:"onMousewheel",value:function(a){if(a.ctrlKey)this.onMousemove(a),this.zoomByMouse(f.getWheelZoomAmount(a));else{var b=this.navigationState;l[0]=0;l[1]=0;l[2]=(0<a.wheelDelta?1:-1)*(a.shiftKey?10:1);b.pose.translateVoxelsRelative(l)}a.preventDefault()}},{key:"onMousedown",value:function(a){if(event.target===this.element&&(this.onMousemove(a),2===a.button&&(a=this.viewer.mouseState,a.updateUnconditionally()))){var b=this.navigationState.pose.position;
c.vec3.copy(b.spatialCoordinates,a.position);b.changed.dispatch()}}}]);return k}(g.RenderedPanel);e.RenderedDataPanel=g},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=d(62),k=d(37);g=d(8);d=function(d){function e(a,c){m(this,e);var d=
b(this,Object.getPrototypeOf(e).call(this));d.context=a;d.element=c;d.gl=a.gl;d.registerEventListener(c,"mouseenter",function(a){d.context.setActivePanel(d)});a.addPanel(d);return d}a(e,d);c(e,[{key:"scheduleRedraw",value:function(){this.context.scheduleRedraw()}},{key:"setGLViewport",value:function(){var a=this.element,b=a.offsetLeft+a.clientLeft,c=a.clientWidth,d=a.clientHeight,e=a.offsetTop+a.clientTop+d,a=this.gl;a.enable(a.SCISSOR_TEST);e=this.context.canvas.height-e;a.viewport(b,e,c,d);a.scissor(b,
e,c,d)}},{key:"onKeyCommand",value:function(a){return!1}},{key:"disposed",value:function(){this.context.removePanel(this)}}]);return e}(g.RefCounted);e.RenderedPanel=d;g=function(d){function e(a){m(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.container=a;c.canvas=document.createElement("canvas");c.updateStarted=new k.Signal;c.updateFinished=new k.Signal;c.panels=new Set;c.activePanel=null;c.updatePending=null;c.needsRedraw=!1;var d=c.canvas;d.className="gl-canvas";a.appendChild(d);
c.gl=f.initializeWebGL(d);c.registerEventListener(window,"resize",c.onResize.bind(c));return c}a(e,d);c(e,[{key:"disposed",value:function(){null!=this.updatePending&&(cancelAnimationFrame(this.updatePending),this.updatePending=null)}},{key:"addPanel",value:function(a){this.panels.add(a);null==this.activePanel&&this.setActivePanel(a)}},{key:"setActivePanel",value:function(a){var b=this.activePanel;null!=b&&b.element.attributes.removeNamedItem("isActivePanel");null!=a&&a.element.setAttribute("isActivePanel",
"true");this.activePanel=a}},{key:"removePanel",value:function(a){this.panels.delete(a);a===this.activePanel&&this.setActivePanel(null);a.dispose()}},{key:"onResize",value:function(){this.scheduleRedraw();for(var a=$jscomp.makeIterator(this.panels),b=a.next();!b.done;b=a.next())b.value.onResize()}},{key:"scheduleUpdate",value:function(){null===this.updatePending&&(this.updatePending=requestAnimationFrame(this.update.bind(this)))}},{key:"scheduleRedraw",value:function(){this.needsRedraw||(this.needsRedraw=
!0,this.scheduleUpdate())}},{key:"update",value:function(){this.updatePending=null;this.updateStarted.dispatch();if(this.needsRedraw){this.needsRedraw=!1;var a=this.gl,b=this.canvas;b.width=b.offsetWidth;b.height=b.offsetHeight;this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a=$jscomp.makeIterator(this.panels);for(b=a.next();!b.done;b=a.next()){var b=b.value,c=b.element;0!==c.clientWidth&&0!==c.clientHeight&&(b.setGLViewport(),b.draw())}}this.updateFinished.dispatch()}}]);
return e}(g.RefCounted);e.DisplayContext=g},function(g,e,d){var m=d(38);e.DEBUG_SHADERS=!1;e.initializeWebGL=function(b){var a=null,a={antialias:!1,stencil:!0};e.DEBUG_SHADERS&&(console.log("DEBUGGING via preserveDrawingBuffer"),a.preserveDrawingBuffer=!0);a=b.getContext("webgl",a)||b.getContext("experimental-webgl",a);a.memoize=new m.Memoize;a.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);a.maxTextureImageUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);a.tempTextureUnit=a.maxTextureImageUnits-
1;a.WEBGL_draw_buffers=a.getExtension("WEBGL_draw_buffers");if(!a.WEBGL_draw_buffers)throw Error("WEBGL_draw_buffers extension not available");b=$jscomp.makeIterator(["OES_texture_float","OES_element_index_uint"]);for(var c=b.next();!c.done;c=b.next())if(c=c.value,!a.getExtension(c))throw Error(c+" extension not available");return a}},function(g,e){e.getWheelZoomAmount=function(d){var e=.005,b=d.deltaMode;1===b?e=.1:2===b&&(e=2);return Math.exp(d.deltaY*e)}},function(g,e){},function(g,e,d){function m(a,
b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=d(37);g=d(8);d=function(){function b(c,d){a(this,b);this.value_=c;this.defaultValue=d;this.changed=new f.Signal}c(b,[{key:"toggle",value:function(){this.value=!this.value}},{key:"toJSON",value:function(){return this.value_===
this.defaultValue?void 0:this.value_}},{key:"restoreState",value:function(a){void 0===a&&(a=this.defaultValue);if(!0===a||!1===a)this.value=a}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}();e.TrackableBoolean=d;d=function(d){function e(b){a(this,e);var c=m(this,Object.getPrototypeOf(e).call(this));c.model=b;c.element=document.createElement("input");var d=c.element;d.type="checkbox";c.registerSignalBinding(b.changed.add(c.updateCheckbox,
c));c.updateCheckbox();c.registerEventListener(d,"change",function(a){b.value=this.checked});return c}b(e,d);c(e,[{key:"updateCheckbox",value:function(){this.element.checked=this.model.value}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a)}}]);return e}(g.RefCounted);e.TrackableBooleanCheckbox=d;g=function(d){function e(b,c){a(this,e);var d=m(this,Object.getPrototypeOf(e).call(this));d.model=b;d.element=c;d.updateVisibility();d.registerSignalBinding(b.changed.add(function(){d.updateVisibility()}));
return d}b(e,d);c(e,[{key:"updateVisibility",value:function(){this.element.style.display=this.model.value?"":"none"}}]);return e}(g.RefCounted);e.ElementVisibilityFromTrackableBoolean=g},function(g,e){e.startRelativeMouseDrag=function(d,e){var b=d.view.document,a=d.screenX,c=d.screenY,f=function(b){var d=a-b.screenX,f=c-b.screenY;a=b.screenX;c=b.screenY;e(b,d,f)},k=d.button,g=function(a){a.button===k&&(b.removeEventListener("mousemove",f,!0),b.removeEventListener("mouseup",g,!1))};b.addEventListener("mousemove",
f,!0);b.addEventListener("mouseup",g,!1)}},function(g,e){e.glsl_packFloat01ToFixedPoint="\nvec4 packFloat01ToFixedPoint(const float value) {\n  const vec4 shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n  const vec4 mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 result = fract(value * shift);\n  result -= result.xxyz * mask;\n  return result * 256.0 / 255.0;\n}\n";e.unpackFloat01FromFixedPoint=function(d){return(d[3]+1/256*d[2]+1/65536*d[1]+1/16777216*d[0])/256};
e.glsl_hsvToRgb="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";e.glsl_uint64="\nstruct uint64_t {\n  vec4 low, high;\n};\n";e.glsl_getSubscriptsFromNormalized="\nvec3 getSubscriptsFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return floor(min(normalizedPosition * size, size - 1.0));\n}\n";
e.glsl_getFortranOrderIndex="\nfloat getFortranOrderIndex(vec3 subscripts, vec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n";e.glsl_getFortranOrderIndexFromNormalized=[e.glsl_getSubscriptsFromNormalized,e.glsl_getFortranOrderIndex,"\nfloat getFortranOrderIndexFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return getFortranOrderIndex(getSubscriptsFromNormalized(normalizedPosition, size), size);\n}\n"];e.glsl_imod="\nfloat imod(float x, float y) {\n  return x - y * floor(x / y);\n}\n";
e.glsl_exactDot="\nfloat exactDot(vec4 a, vec4 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\nfloat exactDot(vec3 a, vec3 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n";e.fract=function(d){return d-Math.floor(d)};e.step=function(d,e){return e<d?0:1};e.mod=function(d,e){return d%e};e.exp2=function(d){return Math.pow(2,d)};e.glsl_packFloat="\nvec4 packFloatIntoVec4(float f) {\n  float magnitude = abs(f); \n  if (magnitude == 0.0) {\n     return vec4(0,0,0,0);\n  }\n  float sign =  step(0.0, -f);\n  float exponent = floor(log2(magnitude)); \n  float mantissa = magnitude / exp2(exponent); \n  // Denormalized values if all exponent bits are zero\n  if (mantissa < 1.0) {\n     exponent -= 1.0;\n  }\n\n  exponent +=  127.0;\n\n  vec4 result;\n  result[3] = 128.0 * sign + floor(exponent / 2.0);\n  result[2] = 128.0 * mod(exponent, 2.0) +  mod(floor(mantissa * float(128.0)),128.0);\n  result[1] = floor( mod(floor(mantissa* exp2(float(23.0 - 8.0))), exp2(8.0)));\n  result[0] = floor( exp2(23.0)* mod(mantissa, exp2(-15.0)));\n  return result / 255.0;\n}\n";
e.glsl_debugFunctions=[e.glsl_packFloat];e.encodeBytesToFloat32=function(d){d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);for(var e=d.length,b=new Float32Array(e),a=0;a<e;++a)b[a]=d[a]/255;return b};e.setVec4FromUint32=function(d,e){for(var b=0;4>b;++b)d[b]=(e>>8*b&255)/255;return d};e.getUint32FromVec4=function(d){return 255*d[0]+65280*d[1]+16711680*d[2]+4278190080*d[3]}},function(g,e){},function(g,e){},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){var c=JSON.stringify({hostnames:a,token:b}),d=D.get(c);if(void 0!==d)return d;d=r.sendHttpRequest(r.openShardedHttpRequest(a,"/ocp/ca/"+b+"/info/"),"json");D.set(c,d);return d}
function c(b,c){var d=c.match(z);if(null===d)throw Error("Invalid volume path "+JSON.stringify(c));var e=w.stableStringify({hostnames:b,path:c}),f=E.get(e);if(void 0!==f)return f;var h=d[1],k=d[2],g=w.parseQueryStringParameters(d[3]||""),d=a(b,h).then(function(a){return new C(b,h,a,k,g)});E.set(e,d);return d}function f(a){var b=a.match(G);if(null===b)throw Error("Invalid ndstore volume path: "+JSON.stringify(a));return c([b[1]],b[2])}function k(a){var b=JSON.stringify(a),c=F.get(b);if(void 0!==c)return c;
a=r.sendHttpRequest(r.openShardedHttpRequest(a,"/ocp/ca/public_tokens/"),"json").then(function(a){return w.parseArray(a,w.verifyString)});F.set(b,a);return a}function l(b,c){var d=c.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===d)return Promise.reject(null);if(void 0===d[2]){var e=function(){var a=d[1]||"";return{v:k(b).then(function(b){return{offset:0,completions:A.getPrefixMatchesWithDescriptions(a,b,function(a){return a+"/"},function(a){})}})}}();if("object"===typeof e)return e.v}return u.cancellableThen(a(b,
d[1]),function(a){var b=[];"object"!==typeof a||null===a||Array.isArray(a)||function(){var c=a.channels;if("object"===typeof c&&null!==c&&!Array.isArray(c)){var e=Object.keys(c);b=A.getPrefixMatchesWithDescriptions(d[2],e,function(a){return a},function(a){a=c[a];return a.channel_type+" ("+a.datatype+")"})}}();return{offset:d[1].length+1,completions:b}})}function h(a){var b=a.match(G);return null===b?Promise.reject(null):u.cancellableThen(l([b[1]],b[2]),function(a){return A.applyCompletionOffset(b[1].length+
1,a)})}var n=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(17);var v=d(19),p=d(34),A=d(18),q=d(21),r=d(14),w=d(11),u=d(6),y=new Map;y.set("uint8",v.DataType.UINT8);y.set("uint16",v.DataType.UINT16);y.set("uint32",v.DataType.UINT32);y.set("uint64",v.DataType.UINT64);var x=new Map;x.set("image",v.VolumeType.IMAGE);
x.set("annotation",v.VolumeType.SEGMENTATION);var t=new Set(["npz","raw","jpeg"]),B=function(a){function c(a,b,d,e,f,h,k){m(this,c);b=Object.getPrototypeOf(c).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.hostnames=d;b.key=e;b.channel=f;b.resolution=h;b.encoding=k;b.initializeCounterpart(a.rpc,{type:"ndstore/VolumeChunkSource",hostnames:d,key:e,channel:f,resolution:h,encoding:k});
return b}b(c,a);n(c,[{key:"toString",value:function(){return"ndstore:volume:"+this.hostnames[0]+"/"+this.key+"/"+this.channel+"/"+this.resolution+"/"+this.encoding}}]);return c}(p.VolumeChunkSource);e.VolumeChunkSource=B;var C=function(){function a(b,c,d,e,f){m(this,a);this.hostnames=b;this.key=c;this.response=d;this.parameters=f;b=d.channels;c=Object.keys(b);if(void 0===e){if(1!==c.length)throw Error("Dataset contains multiple channels: "+JSON.stringify(c));e=c[0]}else if(-1===c.indexOf(e))throw Error("Specified channel "+
JSON.stringify(e)+" is not one of the supported channels "+JSON.stringify(c));this.channel=e;e=b[e];b=x.get(e.channel_type);void 0===b&&(b=v.VolumeType.UNKNOWN);this.volumeType=b;e=e.datatype;if(void 0===(this.dataType=y.get(e)))throw Error("Unsupported data type "+JSON.stringify(e));this.numChannels=1}n(a,[{key:"getSources",value:function(a){var b=this,c=[],d=this.volumeType,e=this.response.dataset,f=w.verifyOptionalString(this.parameters.encoding);if(void 0===f)f=d===v.VolumeType.IMAGE?"jpeg":"npz";
else if(!t.has(f))throw Error("Invalid encoding: "+JSON.stringify(f)+".");for(var h=function(h){var k=w.parseIntVec(q.vec3.create(),e.neariso_imagesize[h]),g=w.parseFiniteVec(q.vec3.create(),e.neariso_voxelres[h]),l=[];c.push(l);for(var n=w.parseFiniteVec(q.vec3.create(),e.neariso_offset[h]),m=q.vec3.create(),p=q.vec3.create(),t=0;3>t;++t){var u=n[t];m[t]=Math.ceil(u);p[t]=Math.floor(u+k[t])}k=function(c){var d=w.stableStringify({spec:c,key:b.key,channel:b.channel,resolution:h});l.push(a.getChunkSource(B,
d,function(){return new B(a,c,b.hostnames,b.key,b.channel,h,f)}))};g=$jscomp.makeIterator(v.VolumeChunkSpecification.getDefaults({volumeType:d,voxelSize:g,dataType:b.dataType,lowerVoxelBound:m,upperVoxelBound:p}));for(m=g.next();!m.done;m=g.next())k(m.value)},k=$jscomp.makeIterator(Object.keys(e.neariso_imagesize)),g=k.next();!g.done;g=k.next())h(g.value);return c}},{key:"getMeshSource",value:function(a){return null}}]);return a}();e.MultiscaleVolumeChunkSource=C;var z=/^([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/,
D=new Map;e.getVolumeInfo=a;var E=new Map;e.getShardedVolume=c;var G=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/;e.getVolume=f;var F=new Map;e.getPublicTokens=k;e.tokenAndChannelCompleter=l;e.volumeCompleter=h;g.registerDataSourceFactory("ndstore",{description:"NDstore",volumeCompleter:h,getVolume:f})},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function c(a,b,c){z.verifyObject(a);var d=z.verifyObjectProperty(a,"Base",function(a){return new E(a)});switch(d.typeName){case "uint8blk":case "grayscale8":return new F(a,
b,d,w.VolumeType.IMAGE,c);case "imagetile":return new M(a,b,d);case "labels64":case "labelblk":return new F(a,b,d,w.VolumeType.SEGMENTATION,c);default:throw Error("DVID data type "+JSON.stringify(d.typeName)+" is not supported.");}}function f(a){try{for(var b=z.verifyObjectAsMap(a,function(a){return new J(a)}),c=new Map,d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next()){var f=A(e.value,2),h=f[0],k=f[1];c.set(h,k);for(var g=$jscomp.makeIterator(k.nodes),l=g.next();!l.done;l=g.next()){var n=l.value;
if(n!=h){var m=new J(void 0);m.alias=k.alias;m.description=k.description;m.errors=k.errors;m.dataInstances=k.dataInstances;c.set(n,m)}}}for(var p=$jscomp.makeIterator(c),t=p.next();!t.done;t=p.next()){var q=A(t.value,2);q[1].uuid=q[0]}return c}catch(v){throw Error("Failed to parse DVID repositories info: "+v.message);}}function k(a){var b=z.stableStringify(a),c=H.get(b);void 0===c&&(c=C.sendHttpRequest(C.openShardedHttpRequest(a,"/api/repos/info","GET"),"json").then(function(a){return new P(a)}),
a="repository info for DVID server "+a[0],x.StatusMessage.forPromise(c,{initialMessage:"Retrieving "+a+".",delay:!0,errorPrefix:"Error retrieving "+a+": "}),H.set(b,c));return c}function l(a,b,c,d){return k(a).then(function(e){e=e.getNode(b);var f=e.dataInstances.get(c);if(!(f instanceof F||f instanceof M))throw Error("Invalid data instance "+c+".");var h=z.stableStringify({baseUrls:a,nodeKey:e.uuid,dataInstanceKey:c,level2:d}),k=O.get(h);void 0===k&&(k=new I(a,e.uuid,c,d,f),O.set(h,k));return k})}
function h(a){var b=a.match(R);if(null===b)throw Error("Invalid DVID URL: "+JSON.stringify(a)+".");return l([b[1]],b[2],b[3],"0")}function n(a,b){return{offset:0,completions:t.getPrefixMatchesWithDescriptions(b,a.dataInstances.values(),function(a){return a.name},function(a){return""+a.base.typeName})}}function v(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===c)throw Error("Invalid DVID URL syntax.");if(void 0===c[2])return{offset:0,completions:t.getPrefixMatchesWithDescriptions(b,
a.repositories.values(),function(a){return a.uuid+"/"},function(a){return a.alias+": "+a.description})};var d=c[1],e=a.getNode(d);return t.applyCompletionOffset(d.length+1,n(e,c[2]))}function p(a){a=a.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===a)return Promise.reject(null);var b=a[1],c=a[2];return k([b]).then(function(a){return t.applyCompletionOffset(b.length+1,v(a,c))})}var A=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();
if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),k;!(d=(k=h.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(g){e=!0,f=g}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),q=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=d(72);g=d(17);var w=d(19),u=d(20),y=d(34),x=d(4),t=d(18),B=d(21),C=d(14),z=d(11),D=new Map;D.set("uint8",w.DataType.UINT8);D.set("uint32",w.DataType.UINT32);D.set("uint64",w.DataType.UINT64);var E=function(){function b(c){a(this,b);this.obj=c;z.verifyObject(c);z.verifyObjectProperty(c,"TypeName",z.verifyString)}q(b,[{key:"typeName",get:function(){return this.obj.TypeName}}]);
return b}();e.DataInstanceBaseInfo=E;d=function S(b,c,d){a(this,S);this.obj=b;this.name=c;this.base=d};e.DataInstanceInfo=d;var G=function(c){function d(b,c,e){a(this,d);c=m(this,Object.getPrototypeOf(d).call(this,b,c));c.parameters=e;c.initializeCounterpart(b.rpc,{type:"dvid/VolumeChunkSource",parameters:e});return c}b(d,c);q(d,[{key:"toString",value:function(){return r.volumeSourceToString(this.parameters)}}]);return d}(y.VolumeChunkSource);e.VolumeChunkSource=G;var F=function(c){function d(b,c,
e,f,h){a(this,d);e=m(this,Object.getPrototypeOf(d).call(this,b,c,e));e.volumeType=f;b=z.verifyObjectProperty(b,"Extended",z.verifyObject);f=z.verifyObjectProperty(b,"Values",function(a){return z.parseArray(a,z.verifyObject)});if(1>f.length)throw Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");e.numLevels=1;for(h=new Set(h);;)if(h.has(c+"_"+e.numLevels.toString()))e.numLevels+=1;else break;e.dataType=z.verifyObjectProperty(f[0],"DataType",
function(a){return z.verifyMapKey(a,D)});e.lowerVoxelBound=z.verifyObjectProperty(b,"MinPoint",function(a){return z.parseIntVec(B.vec3.create(),a)});e.upperVoxelBound=z.verifyObjectProperty(b,"MaxPoint",function(a){return z.parseIntVec(B.vec3.create(),a)});e.voxelSize=z.verifyObjectProperty(b,"VoxelSize",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyFinitePositiveFloat)});e.numChannels=1;return e}b(d,c);q(d,[{key:"getSources",value:function(a,b){for(var c=this,d=[],e=function(e){var f=
B.vec3.clone(c.voxelSize),h=B.vec3.fromValues(64,64,64);f[0]*=Math.pow(2,e);f[1]*=Math.pow(2,e);f[2]*=Math.pow(2,e);for(var k=u.ChunkLayout.get(B.vec3.multiply(B.vec3.create(),f,h)),g=B.vec3.create(),l=B.vec3.create(),n=0;3>n;++n)g[n]=Math.floor(c.voxelSize[n]/f[n]*c.lowerVoxelBound[n]),l[n]=Math.ceil(c.voxelSize[n]/f[n]*c.upperVoxelBound[n]);var m=new w.VolumeChunkSpecification(k,h,c.numChannels,c.dataType,g,l),p={baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:b.dataInstanceKey,level2:e.toString()};
e=[a.getChunkSource(G,z.stableStringify(p),function(){return new G(a,m,p)})];d.push(e)},f=0;f<this.numLevels;++f)e(f);return d}}]);return d}(d);e.VolumeDataInstanceInfo=F;var K=function T(b){a(this,T);z.verifyObject(b);this.resolution=z.verifyObjectProperty(b,"Resolution",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyFinitePositiveFloat)});this.tileSize=z.verifyObjectProperty(b,"TileSize",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyPositiveInt)})};e.TileLevelInfo=
K;var L=[[0,1,2],[0,2,1],[1,2,0]],N=function(c){function d(b,c,e){a(this,d);c=m(this,Object.getPrototypeOf(d).call(this,b,c));c.parameters=e;c.initializeCounterpart(b.rpc,{type:"dvid/TileChunkSource",parameters:e});return c}b(d,c);q(d,[{key:"toString",value:function(){return r.tileSourceToString(this.parameters)}}]);return d}(y.VolumeChunkSource);e.TileChunkSource=N;var M=function(c){function d(b,c,e){a(this,d);c=m(this,Object.getPrototypeOf(d).call(this,b,c,e));b=z.verifyObjectProperty(b,"Extended",
z.verifyObject);c.levels=z.verifyObjectProperty(b,"Levels",function(a){return z.verifyObjectAsMap(a,function(a){return new K(a)})});e=c.levels.get("0");if(void 0===e)throw Error("Level 0 is not defined.");c.voxelSize=e.resolution;var f=z.verifyObjectProperty(b,"MinTileCoord",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyInt)}),h=z.verifyObjectProperty(b,"MaxTileCoord",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyInt)});c.lowerVoxelBound=B.vec3.multiply(B.vec3.create(),
e.tileSize,f);c.upperVoxelBound=B.vec3.multiply(B.vec3.create(),e.tileSize,h);b=z.verifyObjectProperty(b,"Encoding",function(a){return a});switch(b){case 2:c.encoding=r.TileEncoding.JPEG;break;default:throw Error("Unsupported tile encoding: "+JSON.stringify(b)+".");}return c}b(d,c);q(d,[{key:"getSources",value:function(a,b){for(var c=this,d=[],e=function(e){k=A(e,2);var f=k[0],h=k[1];e=L.map(function(d){for(var e=B.vec3.clone(c.voxelSize),k=B.vec3.fromValues(1,1,1),g=$jscomp.makeIterator(d),l=g.next();!l.done;l=
g.next())l=l.value,e[l]=h.resolution[l],k[l]=h.tileSize[l];for(var g=u.ChunkLayout.get(B.vec3.multiply(B.vec3.create(),e,k)),l=B.vec3.create(),n=B.vec3.create(),m=0;3>m;++m)l[m]=Math.floor(c.voxelSize[m]/e[m]*c.lowerVoxelBound[m]),n[m]=Math.ceil(c.voxelSize[m]/e[m]*c.upperVoxelBound[m]);var p=new w.VolumeChunkSpecification(g,k,c.numChannels,c.dataType,l,n),t={baseUrls:b.baseUrls,nodeKey:b.nodeKey,level2:"0",dataInstanceKey:b.dataInstanceKey,encoding:c.encoding,level:f,dims:d[0]+"_"+d[1]};return a.getChunkSource(G,
z.stableStringify(t),function(){return new N(a,p,t)})});d.push(e)},f=$jscomp.makeIterator(this.levels),h=f.next();!h.done;h=f.next()){var k;e(h.value)}return d}},{key:"dataType",get:function(){return w.DataType.UINT8}},{key:"volumeType",get:function(){return w.VolumeType.IMAGE}},{key:"numChannels",get:function(){return 1}}]);return d}(d);e.TileDataInstanceInfo=M;e.parseDataInstance=c;var J=function Q(b){a(this,Q);this.errors=[];this.dataInstances=new Map;this.nodes=new Set;if(void 0!==b){z.verifyObject(b);
this.alias=z.verifyObjectProperty(b,"Alias",z.verifyString);this.description=z.verifyObjectProperty(b,"Description",z.verifyString);for(var d=z.verifyObjectProperty(b,"DataInstances",z.verifyObject),e=$jscomp.makeIterator(Object.keys(d)),f=e.next();!f.done;f=e.next()){f=f.value;try{this.dataInstances.set(f,c(d[f],f,Object.keys(d)))}catch(h){f="Failed to parse data instance "+JSON.stringify(f)+": "+h.message,console.log(f),this.errors.push(f)}}b=z.verifyObjectProperty(b,"DAG",z.verifyObject);b=z.verifyObjectProperty(b,
"Nodes",z.verifyObject);b=$jscomp.makeIterator(Object.keys(b));for(d=b.next();!d.done;d=b.next())this.nodes.add(d.value)}};e.RepositoryInfo=J;e.parseRepositoriesInfo=f;var P=function(){function b(c){a(this,b);this.repositories=f(c)}q(b,[{key:"getNode",value:function(a){for(var b=[],c=$jscomp.makeIterator(this.repositories.keys()),d=c.next();!d.done;d=c.next())d=d.value,d.startsWith(a)&&b.push(d);if(1!==b.length)throw Error("Node key "+JSON.stringify(a)+" matches "+JSON.stringify(b)+" nodes.");return this.repositories.get(a)}}]);
return b}();e.ServerInfo=P;var H=new Map;e.getServerInfo=k;var I=function(){function b(c,d,e,f,h){a(this,b);this.baseUrls=c;this.nodeKey=d;this.dataInstanceKey=e;this.level2=f;this.info=h}q(b,[{key:"getSources",value:function(a){return this.info.getSources(a,{baseUrls:this.baseUrls,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey,level2:this.level2})}},{key:"getMeshSource",value:function(a){return null}},{key:"dataType",get:function(){return this.info.dataType}},{key:"numChannels",get:function(){return this.info.numChannels}},
{key:"volumeType",get:function(){return this.info.volumeType}}]);return b}();e.MultiscaleVolumeChunkSource=I;var O=new Map;e.getShardedVolume=l;var R=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/;e.getVolume=h;e.completeInstanceName=n;e.completeNodeAndInstance=v;e.volumeCompleter=p;g.registerDataSourceFactory("dvid",{description:"DVID",volumeCompleter:p,getVolume:h})},function(g,e){(function(d){d[d.JPEG=0]="JPEG"})(e.TileEncoding||(e.TileEncoding={}));var d=e.TileEncoding;e.volumeSourceToString=
function(d){return"dvid:volume:"+d.baseUrls[0]+"/"+d.nodeKey+"/"+d.dataInstanceKey+"/"+d.level2};e.tileSourceToString=function(e){return"dvid:volume:"+e.baseUrls[0]+"/"+e.nodeKey+"/"+e.dataInstanceKey+"/"+e.dims+"/"+e.level+"/"+d[e.encoding]}},function(g,e,d){function m(b){return a.getShardedVolume(c,b)}function b(b){return a.tokenAndChannelCompleter(c,b)}g=d(17);var a=d(70),c=["http://openconnecto.me","http://www.openconnecto.me"];e.getVolume=m;e.volumeCompleter=b;g.registerDataSourceFactory("openconnectome",
{description:"NDstore server hosted at openconnecto.me",getVolume:m,volumeCompleter:b})},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b,c,d){return a.getChunkSource(D,JSON.stringify({baseUrls:b,path:c,lod:d}),function(){return new D(a,b,c,d)})}function f(a,b,d){b=u.parseSpecialUrl(b);b=h(b,2);return c(a,b[0],b[1],d)}function k(a,b){var c=w.stableStringify({baseUrls:a,path:b}),d=E.get(c);if(void 0!==d)return d;d=u.sendHttpRequest(u.openShardedHttpRequest(a,
b+"/info"),"json").then(function(c){return new z(a,b,c)});E.set(c,d);return d}function l(a){a=u.parseSpecialUrl(a);a=h(a,2);return k(a[0],a[1])}var h=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),k;!(d=(k=h.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(g){e=!0,f=g}finally{try{if(!d&&
h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=d(75),p=d(19);g=d(34);var A=d(56),q=d(17),r=d(21),w=d(11),u=d(14),y=new Map;y.set("uint8",p.DataType.UINT8);y.set("uint32",
p.DataType.UINT32);y.set("uint64",p.DataType.UINT64);var x=new Map;x.set("image",p.VolumeType.IMAGE);x.set("segmentation",p.VolumeType.SEGMENTATION);var t=new Map;t.set("raw",v.VolumeChunkEncoding.RAW);t.set("jpeg",v.VolumeChunkEncoding.JPEG);t.set("compressed_segmentation",v.VolumeChunkEncoding.COMPRESSED_SEGMENTATION);var B=function(c){function d(a,c,e,f,h){m(this,d);c=b(this,Object.getPrototypeOf(d).call(this,a,c));c.baseUrls=e;c.path=f;c.encoding=h;c.initializeCounterpart(a.rpc,{type:"precomputed/VolumeChunkSource",
baseUrls:e,path:f,encoding:h});return c}a(d,c);n(d,[{key:"toString",value:function(){return"precomputed:volume:"+this.baseUrls[0]+"/"+this.path}}]);return d}(g.VolumeChunkSource);e.VolumeChunkSource=B;var C=function F(a){m(this,F);if("object"!==typeof a||Array.isArray(a))throw Error("Failed to parse volume metadata.");this.resolution=w.parseFiniteVec(r.vec3.create(),a.resolution);this.voxelOffset=w.parseIntVec(r.vec3.create(),a.voxel_offset);this.size=w.parseIntVec(r.vec3.create(),a.size);this.chunkSizes=
w.parseArray(a.chunk_sizes,function(a){return w.parseFiniteVec(r.vec3.create(),a)});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");var b=a.encoding,c=t.get(b);if(void 0===c)throw Error("Invalid chunk encoding: "+JSON.stringify(b));this.encoding=c;c===v.VolumeChunkEncoding.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=w.parseIntVec(r.vec3.create(),a.compressed_segmentation_block_size));this.key=a.key;if("string"!==typeof this.key)throw Error("No key specified.");
},z=function(){function a(b,c,d){m(this,a);this.baseUrls=b;this.path=c;this.response=d;if("object"!==typeof d||Array.isArray(d))throw Error("Failed to parse volume metadata.");c=d.data_type;b=y.get(c);if(void 0===b)throw Error("Invalid data type: "+JSON.stringify(c));c=d.num_channels;if("number"!==typeof c)throw Error("Invalid number of channels.");this.numChannels=c;this.dataType=b;b=d.type;c=x.get(b);if(void 0===c)throw Error("Invalid volume type: "+JSON.stringify(b));this.volumeType=c;b=d.mesh;
if(void 0!==b&&"string"!==typeof b)throw Error('Invalid "mesh" field.');this.mesh=b;this.scales=w.parseArray(d.scales,function(a){return new C(a)})}n(a,[{key:"getMeshSource",value:function(a){var b=this.mesh;return void 0===b?null:c(a,this.baseUrls,this.path+"/"+b,0)}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return Array.from(p.VolumeChunkSpecification.getDefaults({voxelSize:c.resolution,dataType:b.dataType,numChannels:b.numChannels,lowerVoxelBound:c.voxelOffset,
upperVoxelBound:r.vec3.add(r.vec3.create(),c.voxelOffset,c.size),volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,compressedSegmentationBlockSize:c.compressedSegmentationBlockSize})).map(function(d){var e=b.path+"/"+c.key,f=w.stableStringify({spec:d,baseUrls:b.baseUrls,path:e,encoding:c.encoding});return a.getChunkSource(B,f,function(){return new B(a,d,b.baseUrls,e,c.encoding)})})})}}]);return a}();e.MultiscaleVolumeChunkSource=z;var D=function(c){function d(a,c,e,f){m(this,d);a=b(this,Object.getPrototypeOf(d).call(this,
a));a.baseUrls=c;a.path=e;a.lod=f;a.initializeCounterpart(a.chunkManager.rpc,{type:"precomputed/MeshSource",baseUrls:c,path:e,lod:f});return a}a(d,c);n(d,[{key:"toString",value:function(){return"precomputed:mesh:"+this.baseUrls[0]+"/"+this.path}}]);return d}(A.MeshSource);e.MeshSource=D;e.getShardedMeshSource=c;e.getMeshSource=f;var E=new Map;e.getShardedVolume=k;e.getVolume=l;q.registerDataSourceFactory("precomputed",{description:"Precomputed file-backed data source",getVolume:l,getMeshSource:f})},
function(g,e,d){d(14);g=e.VolumeChunkEncoding||(e.VolumeChunkEncoding={});g[g.RAW=0]="RAW";g[g.JPEG=1]="JPEG";g[g.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"},function(g,e,d){var m=d(77),b=d(135);window.addEventListener("DOMContentLoaded",function(){var a=window.viewer=m.makeDefaultViewer();b.makeDefaultKeyBindings(a.keyMap)})},function(g,e,d){d(78);d(79);var m=d(61),b=d(86);e.makeDefaultViewer=function(){var a=new m.DisplayContext(document.getElementById("container"));return new b.Viewer(a)}},
function(g,e){},function(g,e,d){d(80);d(82)},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function y(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:y(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(19),l=d(21);g=d(8);var h=d(67),n=d(43),v=d(34),p=d(33);d=d(81);var A=function(c){function d(a,c,e,f){m(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.chunkDataSize=c;var k=a.maxTextureSize,g=c[0]*c[1]*c[2]*f;a=void 0;h.chunkDataSize=c;if(e*c[0]<=k&&c[1]*c[2]*f<=k)a=c[0];else if(e*c[0]*c[1]<=k&&c[2]*f<=k)a=c[0]*c[1];else if(a=Math.ceil(g/k),a*e>k)throw Error("Chunk data size exceeds maximum texture size: "+
e+" * "+g);c=Math.ceil(g/a);h.textureWidth=a*e;h.textureHeight=c;h.textureAccessCoefficients=Float32Array.of(1/a,1/(a*c));return h}a(d,c);f(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.UncompressedTextureLayout:"+l.vec3Key(b)+","+c+","+e,function(){return new d(a,b,c,e)})}}]);return d}(g.RefCounted),q=function(d){function e(a,c,d,f){m(this,e);f=b(this,Object.getPrototypeOf(e).call(this,f));f.dataType=c;f.numChannels=d;switch(c){case k.DataType.UINT8:f.texelsPerElement=
1;f.textureFormat=a.LUMINANCE;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=1;f.arrayConstructor=Uint8Array;break;case k.DataType.UINT16:f.texelsPerElement=1;f.textureFormat=a.LUMINANCE_ALPHA;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=2;f.arrayConstructor=Uint8Array;break;case k.DataType.UINT64:f.texelsPerElement=2;f.textureFormat=a.RGBA;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=4;f.arrayConstructor=Uint8Array;break;case k.DataType.UINT32:f.texelsPerElement=1;f.textureFormat=
a.RGBA;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=4;f.arrayConstructor=Uint8Array;break;case k.DataType.FLOAT32:f.texelsPerElement=1;f.textureFormat=a.LUMINANCE;f.texelType=a.FLOAT;f.arrayElementsPerTexel=1;f.arrayConstructor=Float32Array;break;default:throw Error("Unsupported dataType: "+c);}return f}a(e,d);f(e,[{key:"defineShader",value:function(a){c(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);a.addUniform("highp vec3","uChunkDataSize");a.addUniform("highp vec2",
"uUncompressedTextureAccessCoefficients");a.addFragmentCode("\nvec3 getPositionWithinChunk () {\n  return floor(min(vChunkPosition * uChunkDataSize, uChunkDataSize - 1.0));\n}\nvec2 getDataTextureCoords () {\n  vec3 chunkDataPosition = getPositionWithinChunk();\n  float offset = chunkDataPosition.x + uChunkDataSize.x * (chunkDataPosition.y + uChunkDataSize.y * chunkDataPosition.z);\n  return vec2(fract(offset * uUncompressedTextureAccessCoefficients.x),\n              offset * uUncompressedTextureAccessCoefficients.y);\n}\n");
switch(this.dataType){case k.DataType.UINT8:case k.DataType.FLOAT32:a.addFragmentCode("\nfloat getDataValue () {\n  return texture2D(uVolumeChunkSampler, getDataTextureCoords()).x;\n}\n");break;case k.DataType.UINT16:a.addFragmentCode(h.glsl_uint64);a.addFragmentCode("\nuint64_t getDataValue () {\n  uint64_t value;\n  vec2 texCoords = getDataTextureCoords();\n  value.low = vec4(texture2D(uVolumeChunkSampler, texCoords).xw, 0.0, 0.0);\n  value.high = vec4(0, 0, 0, 0);\n  return value;\n}\n");break;
case k.DataType.UINT32:a.addFragmentCode(h.glsl_uint64);a.addFragmentCode("\nuint64_t getDataValue () {\n  uint64_t value;\n  vec2 texCoords = getDataTextureCoords();\n  value.low = texture2D(uVolumeChunkSampler, texCoords);\n  value.high = vec4(0, 0, 0, 0);\n  return value;\n}\n");break;case k.DataType.UINT64:a.addFragmentCode(h.glsl_uint64),a.addFragmentCode("\nuint64_t getDataValue () {\n  uint64_t value;\n  vec2 texCoords = getDataTextureCoords();\n  value.low = texture2D(uVolumeChunkSampler, texCoords);\n  value.high = texture2D(uVolumeChunkSampler, vec2(texCoords.x + 0.5 * uUncompressedTextureAccessCoefficients.x, texCoords.y));\n  return value;\n}\n")}}},
{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c.chunkDataSize);a.uniform2fv(b.uniform("uUncompressedTextureAccessCoefficients"),c.textureAccessCoefficients)}},{key:"getTextureLayout",value:function(a,b){return A.get(a,b,this.texelsPerElement,this.numChannels)}}],[{key:"get",value:function(a,b,c){var d="sliceview.UncompressedChunkFormat:"+b+":"+c;return a.memoize.get(d,function(){return new e(a,b,c,d)})}}]);return e}(d.SingleTextureChunkFormat),r=function(c){function d(){m(this,
d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);f(d,[{key:"setTextureData",value:function(a){var b=this.source,c=b.chunkFormatHandler,d=c.chunkFormat,e=void 0;this.textureLayout=this.chunkDataSize===b.spec.chunkDataSize?e=c.textureLayout.addRef():e=d.getTextureLayout(a,this.chunkDataSize);var b=e.textureWidth*e.textureHeight*d.arrayElementsPerTexel,c=d.arrayConstructor,f=this.data;f.constructor!==c&&(f=new c(f.buffer,f.byteOffset,f.byteLength/c.BYTES_PER_ELEMENT));b=p.maybePadArray(f,
b);a.texImage2D(a.TEXTURE_2D,0,d.textureFormat,e.textureWidth,e.textureHeight,0,d.textureFormat,d.texelType,b)}},{key:"getValueAt",value:function(a){var b=this.chunkDataSize,b=a[0]+b[0]*(a[1]+b[1]*a[2]),c=this.chunkFormat.dataType;a=this.data;switch(c){case k.DataType.UINT8:case k.DataType.FLOAT32:case k.DataType.UINT16:case k.DataType.UINT32:return a[b];case k.DataType.UINT64:return b*=2,new n.Uint64(a[b],a[b+1])}throw Error("Invalid data type: "+c);}}]);return d}(d.SingleTextureVolumeChunk);e.UncompressedVolumeChunk=
r;var w=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.chunkFormat=e.registerDisposer(q.get(a,c.dataType,c.numChannels));e.textureLayout=e.registerDisposer(e.chunkFormat.getTextureLayout(a,c.chunkDataSize));return e}a(d,c);f(d,[{key:"getChunk",value:function(a,b){return new r(a,b)}}]);return d}(g.RefCounted);e.UncompressedChunkFormatHandler=w;v.registerChunkFormatHandler(function(a,b){return null==b.compressedSegmentationBlockSize?new w(a,b):null})},function(g,
e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var k=d(54);d=d(34);$jscomp.initSymbol();var l=Symbol("SingleTextureVolumeChunk.textureUnit");$jscomp.initSymbol();var h=Symbol("SingleTextureVolumeChunk.textureLayout");g=function(c){function d(a){m(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.shaderKey=a;return c}a(d,c);f(d,[{key:"defineShader",value:function(a){a.addTextureSampler2D("uVolumeChunkSampler",l)}},{key:"beginDrawing",value:function(a,b){var c=b.textureUnit(l);a.activeTexture(a.TEXTURE0+
c);b[h]=null}},{key:"endDrawing",value:function(a,b){a.bindTexture(a.TEXTURE_2D,null);b[h]=null}},{key:"bindChunk",value:function(a,b,c){var d=c.textureLayout;b[h]!==d&&(b[h]=d,this.setupTextureLayout(a,b,d));a.bindTexture(a.TEXTURE_2D,c.texture)}}]);return d}(g.RefCounted);e.SingleTextureChunkFormat=g;d=function(d){function e(a,c){m(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,a,c));d.texture=null;d.data=c.data;return d}a(e,d);f(e,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(e.prototype),
"copyToGPU",this).call(this,a);var b=this.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.pixelStorei(a.UNPACK_ALIGNMENT,1);k.setRawTextureParameters(a);this.setTextureData(a);a.bindTexture(a.TEXTURE_2D,null)}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);a.deleteTexture(this.texture);this.texture=null;this.textureLayout.dispose();this.textureLayout=null}}]);return e}(d.VolumeChunk);e.SingleTextureVolumeChunk=d},function(g,
e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function B(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:B(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(19),l=d(21);g=d(8);var h=d(43),n=d(67),v=d(34),p=d(33),A=d(81),q=d(83),r=d(85),w=function(c){function d(a,c,e,f){m(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.chunkDataSize=c;h.subchunkSize=e;var k=a.maxTextureSize;a=Math.ceil(f/k);if(a>k)throw Error("Chunk data size exceeds maximum texture size: "+f);f=Math.ceil(f/a);h.textureWidth=a;h.textureHeight=f;h.textureAccessCoefficients=Float32Array.of(1/a,1/(a*f));f=h.subchunkGridSize=
l.vec3.create();for(a=0;3>a;++a)f[a]=Math.ceil(c[a]/e[a]);return h}a(d,c);f(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.CompressedSegmentationTextureLayout:"+l.vec3Key(b)+","+l.vec3Key(c)+","+e,function(){return new d(a,b,c,e)})}}]);return d}(g.RefCounted),u=function(d){function e(a,c,d){m(this,e);d=b(this,Object.getPrototypeOf(e).call(this,d));d.dataType=a;d.subchunkSize=c;return d}a(e,d);f(e,[{key:"defineShader",value:function(a){c(Object.getPrototypeOf(e.prototype),
"defineShader",this).call(this,a);var b=function(a){return"compressedSegmentationChunkFormat_"+a};a.addUniform("highp vec2","uCompressedSegmentationTextureAccessCoefficients");a.addUniform("highp vec3","uSubchunkGridSize");a.addUniform("highp vec3","uChunkDataSize");a.addFragmentCode(n.glsl_getFortranOrderIndexFromNormalized);a.addFragmentCode(n.glsl_uint64);var d="\nvec4 "+b("readTextureValue")+"(float offset) {\n  offset += 0.5;\n  return texture2D(uVolumeChunkSampler,\n                   vec2(fract(offset * uCompressedSegmentationTextureAccessCoefficients.x),\n                        offset * uCompressedSegmentationTextureAccessCoefficients.y));\n}\nuint64_t getDataValue () {\n  const vec3 uSubchunkSize = "+
l.vec3.str(this.subchunkSize)+";\n\n  vec3 chunkPosition = getSubscriptsFromNormalized(vChunkPosition, uChunkDataSize);\n\n  // TODO: maybe premultiply this and store as uniform.\n  vec3 subchunkGridPosition = floor(chunkPosition / uSubchunkSize);\n  float subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  float subchunkHeaderOffset = subchunkGridOffset * 2.0;\n\n  vec4 subchunkHeader0 = "+b("readTextureValue")+
"(subchunkHeaderOffset);\n  vec4 subchunkHeader1 = "+b("readTextureValue")+"(subchunkHeaderOffset + 1.0);\n\n  float outputValueOffset = dot(subchunkHeader0.xyz, vec3(255, 256 * 255, 256 * 256 * 255));\n  float encodingBits = subchunkHeader0[3] * 255.0;\n  if (encodingBits > 0.0) {\n    vec3 subchunkPosition = floor(min(chunkPosition - subchunkGridPosition * uSubchunkSize, uSubchunkSize - 1.0));\n    float subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    highp float encodedValueBaseOffset = dot(subchunkHeader1.xyz, vec3(255.0, 256.0 * 255.0, 256.0 * 256.0 * 255.0));\n    highp float encodedValueOffset = floor(encodedValueBaseOffset + subchunkOffset * encodingBits / 32.0);\n    vec4 encodedValue = "+
b("readTextureValue")+"(encodedValueOffset);\n    float wordOffset = mod(subchunkOffset * encodingBits, 32.0);\n    // If the value is in the first byte, then 0 <= wordOffset < 8.\n    // We need to mod by 2**encodedBits\n    float wordShifter = pow(2.0, -wordOffset);\n    float encodedValueMod = pow(2.0, encodingBits);\n    float encodedValueShifted;\n    if (wordOffset < 16.0) {\n      encodedValueShifted = dot(encodedValue.xy, vec2(255.0, 255.0 * 256.0));\n    } else {\n      encodedValueShifted = dot(encodedValue.zw, vec2(255.0 * 256.0 * 256.0, 255.0 * 256.0 * 256.0 * 256.0));\n    }\n    encodedValueShifted = floor(encodedValueShifted * wordShifter);\n    float decodedValue = mod(encodedValueShifted, encodedValueMod);\n    outputValueOffset += decodedValue * "+
(this.dataType===k.DataType.UINT64?"2.0":"1.0")+";\n  }\n  uint64_t value;\n  value.low = "+b("readTextureValue")+"(outputValueOffset);\n",d=this.dataType===k.DataType.UINT64?d+("\n  value.high = "+b("readTextureValue")+"(outputValueOffset+1.0);\n"):d+"\n  value.high = vec4(0.0, 0.0, 0.0, 0.0);\n";a.addFragmentCode(d+"\n  return value;\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c.chunkDataSize);a.uniform3fv(b.uniform("uSubchunkGridSize"),c.subchunkGridSize);
a.uniform2fv(b.uniform("uCompressedSegmentationTextureAccessCoefficients"),c.textureAccessCoefficients)}},{key:"getTextureLayout",value:function(a,b,c){return w.get(a,b,this.subchunkSize,c)}}],[{key:"get",value:function(a,b,c){var d="sliceview.CompressedSegmentationChunkFormat:"+b+","+l.vec3Key(c);return a.memoize.get(d,function(){return new e(b,c,d)})}}]);return e}(A.SingleTextureChunkFormat),y=function(c){function d(){m(this,d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);
f(d,[{key:"setTextureData",value:function(a){var b=this.data,c=this.textureLayout=this.chunkFormat.getTextureLayout(a,this.chunkDataSize,b.length),b=p.maybePadArray(b,c.textureWidth*c.textureHeight);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c.textureWidth,c.textureHeight,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(b.buffer,b.byteOffset,b.byteLength))}},{key:"getValueAt",value:function(a){var b=this.chunkDataSize,c=this.chunkFormat;if(c.dataType===k.DataType.UINT64){var d=new h.Uint64;return q.readSingleChannelValue(d,
this.data,0,b,c.subchunkSize,a)}return r.readSingleChannelValue(this.data,0,b,c.subchunkSize,a)}}]);return d}(A.SingleTextureVolumeChunk);e.CompressedSegmentationVolumeChunk=y;var x=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this)),f=c.dataType;if(f!==k.DataType.UINT64&&f!==k.DataType.UINT32)throw Error("Unsupported compressed segmentation data type: "+k.DataType[f]);e.chunkFormat=e.registerDisposer(u.get(a,c.dataType,c.compressedSegmentationBlockSize));return e}
a(d,c);f(d,[{key:"getChunk",value:function(a,b){return new y(a,b)}}]);return d}(g.RefCounted);e.CompressedSegmentationChunkFormatHandler=x;v.registerChunkFormatHandler(function(a,b){return null!=b.compressedSegmentationBlockSize?new x(a,b):null})},function(g,e,d){function m(b,d,e,g,h,n){e=a.decodeValueOffset(d,e,g,h,n,2);b.low=d[e];b.high=d[e+1];return b}function b(b,d,e,g,h){var n=g[0]*g[1]*g[2]*2;if(n!==b.length)throw Error("Output length "+b.length+" is not equal to expected length "+n+".");for(var n=
g[0],m=g[1],p=g[2],A=[0,0,0],q=0,r=0;r<p;++r){A[2]=r;for(var w=0;w<m;++w){A[1]=w;for(var u=0;u<n;++u){A[0]=u;var y=a.decodeValueOffset(d,e,g,h,A,2);b[q++]=d[e+y];b[q++]=d[e+y+1]}}}return b}var a=d(84);e.readSingleChannelValue=m;e.readValue=function(a,b,d,e,h,g){return m(a,b,d+b[g[3]],e,h,g)};e.decodeChannel=b;e.decodeChannels=function(a,d,e,g,h){var n=g[0]*g[1]*g[2]*2,m=n*g[3];if(m!==a.length)throw Error("Output length "+a.length+" is not equal to expected length "+m+".");for(var m=g[3],p=0;p<m;++p)b(a.subarray(n*
p,n*(p+1)),d,e+d[p],g,h);return a}},function(g,e){e.decodeValueOffset=function(d,e,b,a,c,f){for(var k=0,g=0,h=1,n=1,v=0;3>v;++v)var p=c[v],A=a[v],q=p%A,k=k+Math.floor(p/A)*h,h=h*Math.ceil(b[v]/A),g=g+q*n,n=n*A;a=e+2*k;b=d[a];a=d[a+1];c=b&16777215;b=b>>24&255;0<b&&(c+=f*(d[(e+a&16777215)+Math.floor(g*b/32)]>>g*b%32&(1<<b)-1));return c}},function(g,e,d){function m(b,d,e,g,h){d=a.decodeValueOffset(b,d,e,g,h,1);return b[d]}function b(b,d,e,g,h){var n=g[0]*g[1]*g[2]*1;if(n!==b.length)throw Error("Output length "+
b.length+" is not equal to expected length "+n+".");for(var n=g[0],m=g[1],p=g[2],A=[0,0,0],q=0,r=0;r<p;++r){A[2]=r;for(var w=0;w<m;++w){A[1]=w;for(var u=0;u<n;++u){A[0]=u;var y=a.decodeValueOffset(d,e,g,h,A,1);b[q++]=d[e+y]}}}return b}var a=d(84);e.readSingleChannelValue=m;e.readValue=function(a,b,d,e,h){return m(a,b+a[h[3]],d,e,h)};e.decodeChannel=b;e.decodeChannels=function(a,d,e,g,h){var n=g[0]*g[1]*g[2]*1,m=n*g[3];if(m!==a.length)throw Error("Output length "+a.length+" is not equal to expected length "+
m+".");for(var m=g[3],p=0;p<m;++p)b(a.subarray(n*p,n*(p+1)),d,e+d[p],g,h);return a}},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){var b=e.LAYOUTS.find(function(b){return b[0]===a});if(void 0===b)throw Error("Invalid layout name: "+JSON.stringify(a)+".");return b}function f(a){return c(a)[0]}var k=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);
Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),l=d(35),h=d(36),n=d(87),v=d(42),p=d(92),A=d(125),q=d(93),r=d(129),w=d(130),u=d(88),y=d(57),x=d(131),t=d(34),B=d(107),C=d(65),z=d(105),D=d(133);g=d(8);var E=d(10),G=d(21),F=d(89),K=d(7),L=d(37);d(134);d(68);var N=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeOrthogonalSliceViews(),h=c.display,g={mouseState:c.mouseState,
layerManager:c.layerManager,navigationState:c.perspectiveNavigationState,showSliceViews:c.showPerspectiveSliceViews,showAxisLines:c.showAxisLines},k={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar},l={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:new C.TrackableBoolean(!1,!1)},n=[r.withFlex(1,r.box("column",[r.withFlex(1,
r.box("row",[r.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[0],k))}),r.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[1],l))})])),r.withFlex(1,r.box("row",[r.withFlex(1,function(a){a.className="gllayoutcell noselect";a=e.registerDisposer(new y.PerspectivePanel(h,a,g));for(var b=$jscomp.makeIterator(f),c=b.next();!c.done;c=b.next())a.sliceViews.add(c.value.addRef())}),r.withFlex(1,
function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[2],l))})]))]))];r.box("row",n)(a);h.onResize();return e}a(d,c);k(d,[{key:"disposed",value:function(){E.removeChildren(this.rootElement)}}]);return d}(g.RefCounted);e.FourPanelLayout=N;var M=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeSliceView(),h={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,
showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar};r.box("row",[r.withFlex(1,function(a){e.registerDisposer(new B.SliceViewPanel(c.display,a,f,h))})])(a);c.display.onResize();return e}a(d,c);k(d,[{key:"disposed",value:function(){E.removeChildren(this.rootElement)}}]);return d}(g.RefCounted);e.SinglePanelLayout=M;e.LAYOUTS=[["4panel",function(a,b){return new N(a,b)}],["xy",function(a,b){return new M(a,b)}]];e.getLayoutByName=c;e.validateLayoutName=f;d=function(d){function g(a){m(this,g);var c=
b(this,Object.getPrototypeOf(g).call(this));c.display=a;c.navigationState=c.registerDisposer(new w.NavigationState);c.perspectiveNavigationState=new w.NavigationState(new w.Pose(c.navigationState.position),1);c.mouseState=new v.MouseSelectionState;c.layerManager=c.registerDisposer(new v.LayerManager);c.showAxisLines=new C.TrackableBoolean(!0,!0);c.showScaleBar=new C.TrackableBoolean(!0,!0);c.showPerspectiveSliceViews=new C.TrackableBoolean(!0,!0);c.layerSelectedValues=c.registerDisposer(new v.LayerSelectedValues(c.layerManager,
c.mouseState));c.worker=new K.RPC(new Worker("/neuroglancer/chunk_worker.bundle.js"));c.resetInitiated=new L.Signal;c.chunkQueueManager=new h.ChunkQueueManager(c.worker,c.display.gl,{gpuMemory:new l.AvailableCapacity(1E6,1E9),systemMemory:new l.AvailableCapacity(1E7,2E9),download:new l.AvailableCapacity(32,Number.POSITIVE_INFINITY)});c.chunkManager=new h.ChunkManager(c.chunkQueueManager);c.keyMap=new F.KeySequenceMap;c.keyCommands=new Map;c.layerSpecification=new q.LayerListSpecification(c.layerManager,c.chunkManager,
c.worker,c.layerSelectedValues,c.navigationState.voxelSize);c.layoutName=new z.TrackableValue(e.LAYOUTS[0][0],f,e.LAYOUTS[0][0]);c.registerSignalBinding(a.updateStarted.add(c.onUpdateDisplay,c));c.registerSignalBinding(a.updateFinished.add(c.onUpdateDisplayFinished,c));c.registerEventListener(document,"contextmenu",function(a){a.preventDefault();return!1});D.registerTrackable("layers",c.layerSpecification);D.registerTrackable("navigation",c.navigationState);D.registerTrackable("showAxisLines",c.showAxisLines);
D.registerTrackable("showScaleBar",c.showScaleBar);D.registerTrackable("perspectiveOrientation",c.perspectiveNavigationState.pose.orientation);D.registerTrackable("perspectiveZoom",c.perspectiveNavigationState.zoomFactor);D.registerTrackable("showSlices",c.showPerspectiveSliceViews);D.registerTrackable("layout",c.layoutName);c.registerSignalBinding(c.navigationState.changed.add(c.handleNavigationStateChanged,c));c.layerManager.initializePosition(c.navigationState.position);c.layerManager.layersChanged.add(function(){0===
c.layerManager.managedLayers.length&&(c.navigationState.voxelSize.reset(),c.navigationState.reset(),c.perspectiveNavigationState.pose.orientation.reset(),c.perspectiveNavigationState.zoomFactor.reset(),c.resetInitiated.dispatch(),c.layerManager.initializePosition(c.navigationState.position),u.overlaysOpen||new p.LayerDialog(c.layerSpecification))});c.registerSignalBinding(c.chunkQueueManager.visibleChunksChanged.add(function(){c.layerSelectedValues.handleLayerChange()}));c.chunkQueueManager.visibleChunksChanged.add(a.scheduleRedraw,
a);c.makeUI();c.registerDisposer(new F.GlobalKeyboardShortcutHandler(c.keyMap,c.onKeyCommand.bind(c)));c.layoutName.changed.add(function(){if(void 0!==c.dataDisplayLayout){var a=c.dataDisplayLayout.rootElement;c.dataDisplayLayout.dispose();c.createDataDisplayLayout(a)}});var d=c.keyCommands;d.set("toggle-layout",function(){this.toggleLayout()});d.set("snap",function(){this.navigationState.pose.snap()});d.set("add-layer",function(){this.layerPanel.addLayerMenu();return!0});d.set("help",c.showHelpDialog);
a=function(a){d.set("toggle-layer-"+a,function(){var b=a-1,c=this.layerManager.managedLayers;b<c.length&&(b=c[b],b.setVisible(!b.visible))})};for(var k=1;9>=k;++k)a(k);a=function(a){d.set(a,function(){this.layerManager.invokeAction(a)})};for(var k=$jscomp.makeIterator(["recolor","clear-segments"]),n=k.next();!n.done;n=k.next())a(n.value);d.set("toggle-axis-lines",function(){this.showAxisLines.toggle()});d.set("toggle-scale-bar",function(){this.showScaleBar.toggle()});c.keyCommands.set("toggle-show-slices",
function(){this.showPerspectiveSliceViews.toggle()});0===c.layerManager.managedLayers.length&&new p.LayerDialog(c.layerSpecification);return c}a(g,d);k(g,[{key:"makeUI",value:function(){var a=this,b=this.display,c=document.createElement("div");c.setAttribute("class","gllayoutcontainer noselect");b.container.appendChild(c);r.box("column",[r.box("row",[r.withFlex(1,function(b){return new x.PositionStatusPanel(b,a)}),function(b){var c=document.createElement("button");c.className="help-button";c.textContent=
"?";c.title="Help";b.appendChild(c);a.registerEventListener(c,"click",function(){a.showHelpDialog()})}]),function(b){a.layerPanel=new A.LayerPanel(b,a.layerSpecification)},r.withFlex(1,function(b){a.createDataDisplayLayout(b)})])(c);this.display.onResize()}},{key:"createDataDisplayLayout",value:function(a){this.dataDisplayLayout=(0,c(this.layoutName.value)[1])(a,this)}},{key:"toggleLayout",value:function(){var a=c(this.layoutName.value),a=e.LAYOUTS.indexOf(a);this.layoutName.value=e.LAYOUTS[(a+1)%
e.LAYOUTS.length][0]}},{key:"showHelpDialog",value:function(){new n.KeyBindingHelpDialog(this.keyMap)}},{key:"onUpdateDisplay",value:function(){D.delayHashUpdate();this.chunkQueueManager.chunkUpdateDeadline=null}},{key:"onUpdateDisplayFinished",value:function(){this.mouseState.updateIfStale()}},{key:"onKeyCommand",value:function(a){var b=this.keyCommands.get(a);return b&&b.call(this)?!0:(b=this.display.activePanel)?b.onKeyCommand(a):!1}},{key:"makeSliceView",value:function(a){var b=void 0,b=void 0===
a?this.navigationState:new w.NavigationState(new w.Pose(this.navigationState.pose.position,w.OrientationState.makeRelative(this.navigationState.pose.orientation,a)),this.navigationState.zoomFactor);return new t.SliceView(this.gl,this.chunkManager,this.layerManager,b)}},{key:"makeOrthogonalSliceViews",value:function(){var a=[];a.push(this.makeSliceView(void 0));var b=G.quat.rotateX(G.quat.create(),G.quat.create(),Math.PI/2);a.push(this.makeSliceView(b));b=G.quat.rotateY(G.quat.create(),G.quat.create(),
Math.PI/2);a.push(this.makeSliceView(b));return a}},{key:"handleNavigationStateChanged",value:function(){var a=this.chunkQueueManager;null===a.chunkUpdateDeadline&&(a.chunkUpdateDeadline=Date.now()+10);this.mouseState.stale=!0}},{key:"gl",get:function(){return this.display.gl}}]);return g}(g.RefCounted);e.Viewer=d},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a){return a.startsWith("key")?a.substring(3):a.startsWith("digit")||a.startsWith("arrow")?a.substring(5):a}function a(a){return a.split("+").map(b).join("+")}var c=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();
$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),k;!(d=(k=g.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(m){e=!0,f=m}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();g=d(88);var f=d(89);d(91);var k=new f.KeySequenceMap;k.bind("escape","close");e.formatKeyName=b;e.formatKeyStroke=a;d=function(b){function d(b){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");
var e;e=Object.getPrototypeOf(d).call(this,k);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;var f=e.content;f.classList.add("describe-key-bindings");var g=document.createElement("div"),l=document.createElement("div");l.className="dl";b=$jscomp.makeIterator(b.entries());for(var m=b.next();!m.done;m=b.next()){var w=c(m.value,2),m=w[0],w=w[1],u=document.createElement("div"),y=document.createElement("div");
y.className="definition-outer-container";u.className="definition-container";var x=document.createElement("div");x.className="dt";x.textContent=m.map(a).join(" ");m=document.createElement("div");m.className="dd";m.textContent=w;u.appendChild(x);u.appendChild(m);l.appendChild(y);y.appendChild(u)}g.appendChild(l);f.appendChild(g);return e}m(d,b);return d}(g.Overlay);e.KeyBindingHelpDialog=d},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}();g=d(8);var a=d(89);d(90);e.overlaysOpen=0;d=function(c){function d(b){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");var c;c=Object.getPrototypeOf(d).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.keySequenceMap=b;++e.overlaysOpen;var h=c.container=document.createElement("div");h.className="overlay";var g=c.content=document.createElement("div");g.className="overlay-content";h.appendChild(g);document.body.appendChild(h);c.keyboardShortcutHandler=
c.registerDisposer(new a.GlobalKeyboardShortcutHandler(b,c.commandReceived.bind(c)));return c}m(d,c);b(d,[{key:"commandReceived",value:function(a){"close"===a&&this.dispose();return!1}},{key:"disposed",value:function(){--e.overlaysOpen;document.body.removeChild(this.container)}}]);return d}(g.RefCounted);e.Overlay=d},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){return(a.ctrlKey?1:0)|(a.altKey?2:0)|(a.metaKey?4:0)|(a.shiftKey?8:0)}function f(a,b){var c="";b&1&&(c+="control+");
b&2&&(c+="alt+");b&4&&(c+="meta+");b&8&&(c+="shift+");return c+a}function k(a){return a.code.toLowerCase()}function l(a){a=a.toLowerCase().replace(" ","");for(var b=a.split("+"),c=void 0,d=0,b=$jscomp.makeIterator(b),e=b.next();!e.done;e=b.next())switch(e=e.value,e){case "control":d|=1;break;case "alt":d|=2;break;case "meta":d|=4;break;case "shift":d|=8;break;default:c=void 0===c?e:null}if(null==c)throw Error("Invalid stroke "+JSON.stringify(a));return f(c,d)}function h(a){"string"===typeof a&&(a=
a.replace(/[ +]*\+[ +]*/g,"+").replace(/[ ]+/g," ").toLowerCase(),a=a.split(" "));a=a.map(l);if(0===a.length)throw Error("Key sequence must not be empty");return a}function n(a){return JSON.stringify(a.join(" "))}function v(a){function b(u,y){for(;;)switch(c){case 0:p=1>=t.length||void 0===t[1]?[]:t[1],m=$jscomp.makeIterator(a),n=m.next();case 1:if(n.done){c=3;break}l=n.value;k=q(l,2);g=k[0];h=k[1];f=[].concat($jscomp.arrayFromIterable(p),[g]);if("string"!==typeof h){c=4;break}c=6;return{value:[f,
h],done:!1};case 6:if(void 0===y){c=7;break}c=-1;throw y;case 7:c=5;break;case 4:e=$jscomp.makeIterator(v(h,f));case 8:if((d=e.next(u)).done){c=9;break}c=10;return{value:d.value,done:!1};case 10:if(void 0===y){c=11;break}c=-1;throw y;case 11:c=8;break;case 9:case 5:case 2:n=m.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,g,k,l,n,m,p,t=arguments,u={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();u[Symbol.iterator]=function(){return this};return u}function p(a,b,c){void 0===B&&(B=new y(window,new t,function(){return!1}));C.push([B.keySequenceMap,B.handler,z]);B.setKeySequenceMap(a);B.handler=b;z=c}function A(){var a=C.pop(),a=q(a,3),b=a[1],c=a[2];B.setKeySequenceMap(a[0]);B.handler=b;z=c}var q=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;
try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),g;!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,
e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var w=new Set("f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 escape pause".split(" ")),u=new Set("color date datetime datetime-local email month number password search tel text time url week".split(" ")),y=function(d){function e(a,c,d){m(this,e);var f=b(this,Object.getPrototypeOf(e).call(this));f.target=a;f.keySequenceMap=c;f.handler=d;f.modifierShortcutsAreGlobal=!0;f.allShortcutsAreGlobal=!1;f.allowSpaceKeyOnButtons=!1;f.reset();
f.registerEventListener(a,"keydown",f.handleKeyDown.bind(f),!0);return f}a(e,d);r(e,[{key:"reset",value:function(){this.currentNode=this.keySequenceMap.root;this.lastStrokeTime=Number.NEGATIVE_INFINITY}},{key:"setKeySequenceMap",value:function(a){this.keySequenceMap=a;this.reset()}},{key:"shouldIgnoreEvent",value:function(a,b){var c=b.target,d=c.tagName;if(c===this.target)return!1;var e="TEXTAREA"===d||"INPUT"===d||"BUTTON"===d||"SELECT"===d,f=!e&&(c.isContentEditable||c.ownerDocument&&"on"===c.ownerDocument.designMode);
return!e&&!f||this.allShortcutsAreGlobal||w.has(a)?!1:f||this.modifierShortcutsAreGlobal&&(b.altKey||b.ctrlKey||b.metaKey)?!0:"INPUT"===d&&u.has(c.type)?"enter"!==a:"INPUT"===d||"BUTTON"===d?this.allowSpaceKeyOnButtons?!1:"space"===a:!0}},{key:"handleKeyDown",value:function(a){var b=k(a);if(!this.shouldIgnoreEvent(b,a)){var b=f(b,c(a)),d=this.keySequenceMap.root,e=this.currentNode,h=e.get(b),g=Date.now();e!==d&&(void 0===h||g>this.lastStrokeTime+1500)&&(this.currentNode=d,h=e.get(b));void 0!==h&&
("string"===typeof h?(this.reset(),this.handler(h)&&a.preventDefault()):(this.currentNode=h,this.lastStrokeTime=g,a.preventDefault()))}}}]);return e}(g.RefCounted);e.KeyboardShortcutHandler=y;e.getEventStrokeIdentifier=function(a){return f(k(a),c(a))};var x;(function(a){a[a.CONTROL=1]="CONTROL";a[a.ALT=2]="ALT";a[a.META=4]="META";a[a.SHIFT=8]="SHIFT"})(x||(x={}));e.getEventModifierMask=c;e.getStrokeIdentifier=f;e.getEventKeyName=k;e.parseKeyStroke=l;e.parseKeySequence=h;e.formatKeySequence=n;var t=
function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?null:arguments[0];m(this,a);this.root=new Map;null!=b&&this.bindMultiple(b)}r(a,[{key:"bind",value:function(a,b){for(var c=h(a),d=this.root,e=c.length-1,f=0;f<e;++f){var g=c[f],k=d.get(g);void 0===k&&(k=new Map,d.set(g,k));if("string"===typeof k)throw Error("Error binding key sequence "+n(c)+": prefix "+n(c.slice(0,f+1))+" is already bound to action "+JSON.stringify(k));d=k}e=c[e];f=d.get(e);if(void 0!==f)throw Error("Key sequence "+
n(c)+" is already bound to action "+JSON.stringify(f));d.set(e,b)}},{key:"bindMultiple",value:function(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.bind(c,a[c])}},{key:"entries",value:function(){return v(this.root)}}]);return a}();e.KeySequenceMap=t;var B=void 0,C=[],z=void 0;e.pushGlobalKeyboardHandler=p;e.popGlobalKeyboardHandler=A;x=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.keySequenceMap=a;e.handler=
c;p(a,c,e);return e}a(d,c);r(d,[{key:"disposed",value:function(){if(z===this)A();else{var a=this,b=C.findIndex(function(b){return b[2]===a});C.splice(b,1)}}}]);return d}(g.RefCounted);e.GlobalKeyboardShortcutHandler=x},function(g,e){},function(g,e){},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(88);var c=d(17),f=d(93),k=d(19),l=d(89),h=d(6),n=d(117),v=d(121),
p=d(123);d(124);var A=new l.KeySequenceMap;A.bind("escape","close");d=function(d){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=m(this,Object.getPrototypeOf(e).call(this,A));d.manager=a;d.existingLayer=b;d.statusElement=document.createElement("div");d.submitElement=document.createElement("button");d.namePromptElement=document.createElement("label");d.nameInputElement=document.createElement("input");d.sourceValid=!1;d.nameValid=!0;var g=d.content;
g.classList.add("add-layer-overlay");var k=document.createElement("form");k.className="source-form";d.registerEventListener(k,"submit",function(a){a.preventDefault();d.validateSource(!0)});var l=document.createElement("label");l.textContent="Source:";var q=d.sourceInput=d.registerDisposer(new n.AutocompleteTextInput({completer:function(a){return h.cancellableThen(c.volumeCompleter(a),function(a){return{completions:a.completions,makeElement:n.makeCompletionElementWithDescription,offset:a.offset,showSingleResult:!0}})},
delay:0}));q.element.classList.add("add-layer-source");q.inputElement.addEventListener("blur",function(a){d.validateSource(!1)});d.submitElement.disabled=!0;q.inputChanged.add(function(){h.cancelPromise(d.volumePromise);d.volumePromise=void 0;d.sourceValid=!1;d.submitElement.disabled=!0;d.statusElement.textContent=""});k.appendChild(l);k.appendChild(q.element);v.associateLabelWithElement(l,q.inputElement);l=p.makeHiddenSubmitButton();k.appendChild(l);g.appendChild(k);var z=d.statusElement,D=d.namePromptElement,
E=d.nameInputElement,k=d.submitElement;z.className="dialog-status";l=document.createElement("form");l.className="name-form";D.textContent="Name:";E.className="add-layer-name";E.autocomplete="off";E.spellcheck=!1;E.type="text";d.registerEventListener(E,"input",function(){d.validateName()});k.type="submit";v.associateLabelWithElement(D,E);l.appendChild(D);l.appendChild(E);l.appendChild(k);g.appendChild(l);g.appendChild(z);void 0!==b?(void 0!==b.sourceUrl?(q.value=b.sourceUrl,d.validateSource()):d.sourceValid=
!0,q.disabled=!0,E.value=b.name,d.validateName(),k.textContent="Save",E.focus()):(g=d.manager.layerManager.managedLayers,0<g.length&&(g=g[g.length-1],g instanceof f.ManagedUserLayerWithSpecification&&(g=g.sourceUrl,void 0!==g&&(z=c.findSourceGroup(g),q.value=g.substring(0,z),q.inputElement.setSelectionRange(0,z)))),q.inputElement.focus(),k.textContent="Add Layer");d.registerEventListener(l,"submit",function(a){a.preventDefault();d.submit()});return d}b(e,d);a(e,[{key:"isNameValid",value:function(){var a=
this.nameInputElement.value;if(""===a)return!1;a=this.manager.layerManager.getLayerByName(a);return void 0===a||a===this.existingLayer}},{key:"submit",value:function(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.layerManager.addManagedLayer(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),this.dispose())}},{key:"validateName",value:function(){var a=
this.nameInputElement;(this.nameValid=this.isNameValid())?(a.classList.add("valid-input"),a.classList.remove("invalid-input")):(a.classList.remove("valid-input"),a.classList.add("invalid-input"));this.validityChanged()}},{key:"validityChanged",value:function(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}},{key:"validateSource",value:function(){var a=this,b=0>=arguments.length||void 0===arguments[0]?!1:arguments[0],d=this.sourceInput.value;if(""!==d){try{var e=c.suggestLayerName(d),
f=this.nameInputElement;if(""===this.nameInputElement.value){for(var g=e,l=0;void 0!==this.manager.layerManager.getLayerByName(g);)g=e+ ++l;f.value=g;f.setSelectionRange(0,g.length);this.validateName()}b&&f.focus()}catch(n){this.setError(n.message);return}this.setInfo("Validating volume source...");b=new Promise(function(a){a(c.getVolume(d))});this.volumePromise=h.cancellableThen(b,function(b){a.sourceValid=!0;a.setInfo(k.VolumeType[b.volumeType].toLowerCase()+": "+b.numChannels+"-channel "+k.DataType[b.dataType].toLowerCase());
a.validityChanged()});b.catch(function(b){b!==h.CANCELLED&&a.setError(b.message)})}}},{key:"setInfo",value:function(a){this.statusElement.className="dialog-status dialog-status-info";this.statusElement.textContent=a}},{key:"setError",value:function(a){this.statusElement.className="dialog-status dialog-status-error";this.statusElement.textContent=a}}]);return e}(g.Overlay);e.LayerDialog=d},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){return A.StatusMessage.forPromise(new Promise(function(b){b(h.getVolume(a))}),
{initialMessage:"Retrieving metadata for volume "+a+".",delay:!0,errorPrefix:"Error retrieving metadata for volume "+a+": "})}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(19),l=d(37);g=d(42);var h=d(17),n=d(8),v=d(94),p=d(115),A=d(4),q=d(11);e.getVolumeWithStatusMessage=c;var r=function(c){function d(a,
c,e){m(this,d);a=b(this,Object.getPrototypeOf(d).call(this,a));a.initialSpecification=c;a.manager=e;return a}a(d,c);f(d,[{key:"toJSON",value:function(){var a=this.layer;if(!a)return this.initialSpecification;a=a.toJSON();this.visible||(a.visible=!1);return a}}]);return d}(g.ManagedUserLayer);e.ManagedUserLayerWithSpecification=r;d=function(d){function e(a,c,d,f,h){m(this,e);var g=b(this,Object.getPrototypeOf(e).call(this));g.layerManager=a;g.chunkManager=c;g.worker=d;g.layerSelectedValues=f;g.voxelSize=
h;g.changed=new l.Signal;g.registerSignalBinding(a.layersChanged.add(g.changed.dispatch,g.changed));g.registerSignalBinding(a.specificationChanged.add(g.changed.dispatch,g.changed));return g}a(e,d);f(e,[{key:"restoreState",value:function(a){q.verifyObject(a);this.layerManager.clear();for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.layerManager.addManagedLayer(this.getLayer(c,a[c]))}},{key:"getLayer",value:function(a,b){var d=new r(a,b,this);"string"===typeof b&&
(b={source:b});q.verifyObject(b);var e=q.verifyObjectProperty(b,"type",q.verifyOptionalString);d.visible=q.verifyObjectProperty(b,"visible",function(a){if(void 0===a||!0===a)return!0;if(!1===a)return!1;throw Error("Expected boolean, but received: "+JSON.stringify(a)+".");});var f=d.sourceUrl=q.verifyObjectProperty(b,"source",q.verifyOptionalString);if(void 0===e){var h=this;if(void 0===f)throw Error("Either layer 'type' or 'source' URL must be specified.");c(f).then(function(a){if(-1!==h.layerManager.managedLayers.indexOf(d))switch(a.volumeType){case k.VolumeType.IMAGE:a=
new p.ImageUserLayer(h,b);d.layer=a;break;case k.VolumeType.SEGMENTATION:a=new v.SegmentationUserLayer(h,b);d.layer=a;break;default:throw Error("Unsupported source type.");}})}else if("image"===e)d.layer=new p.ImageUserLayer(this,b);else if("segmentation"===e)d.layer=new v.SegmentationUserLayer(this,b);else throw Error("Layer type not specified.");return d}},{key:"toJSON",value:function(){for(var a={},b=0,c=$jscomp.makeIterator(this.layerManager.managedLayers),d=c.next();!d.done;d=c.next())d=d.value,
a[d.name]=d.toJSON(),++b;return 0===b?void 0:a}}]);return e}(n.RefCounted);e.LayerListSpecification=d},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:z(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},k=d(42),l=d(95),h=d(100),n=d(102),v=d(103),p=d(43),A=d(104),q=d(17),r=d(56),w=d(106);g=d(8);var u=d(110),y=d(93),x=d(112),t=d(11);d(114);d=function(d){function e(a,c){m(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,[]));d.manager=a;d.segmentColorHash=l.SegmentColorHash.getDefault();d.segmentSelectionState=new n.SegmentSelectionState;d.selectedAlpha=
A.trackableAlphaValue(.5);d.notSelectedAlpha=A.trackableAlphaValue(0);d.wasDisposed=!1;d.visibleSegments=v.Uint64Set.makeWithCounterpart(a.worker);d.visibleSegments.changed.add(function(){d.specificationChanged.dispatch()});d.segmentSelectionState.bindTo(a.layerSelectedValues,d);d.selectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});d.notSelectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});d.selectedAlpha.restoreState(c.selectedAlpha);d.notSelectedAlpha.restoreState(c.notSelectedAlpha);
var f=d.volumePath=t.verifyOptionalString(c.source),h=d.meshPath=t.verifyOptionalString(c.mesh),g=d.skeletonsPath=t.verifyOptionalString(c.skeletons);void 0!==f&&(f=y.getVolumeWithStatusMessage(f),f.then(function(a){d.wasDisposed||d.meshLayer||(a=a.getMeshSource(d.manager.chunkManager),null!=a&&d.addMesh(a))}),d.addRenderLayer(new A.SegmentationRenderLayer(a.chunkManager,f,d,d.selectedAlpha,d.notSelectedAlpha)));void 0!==h&&(f=c.meshLod,"number"!==typeof f&&(f=void 0),d.meshLod=f,d.addMesh(q.getMeshSource(a.chunkManager,
h,f)));void 0!==g&&(h=new w.SkeletonLayer(a.chunkManager,q.getSkeletonSource(a.chunkManager,g),a.voxelSize,d),d.addRenderLayer(new w.PerspectiveViewSkeletonLayer(h)),d.addRenderLayer(new w.SliceViewPanelSkeletonLayer(h)));t.verifyObjectProperty(c,"segments",function(a){void 0!==a&&function(){var b=d.visibleSegments;t.parseArray(a,function(a){a=p.Uint64.parseString(String(a),10);b.add(a)})}()});return d}a(e,d);c(e,[{key:"disposed",value:function(){f(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);
this.wasDisposed=!0}},{key:"addMesh",value:function(a){this.meshLayer=new r.MeshLayer(this.manager.chunkManager,a,this);this.addRenderLayer(this.meshLayer)}},{key:"toJSON",value:function(){var a={type:"segmentation"};a.source=this.volumePath;a.mesh=this.meshPath;a.meshLod=this.meshLod;a.skeletons=this.skeletonsPath;a.selectedAlpha=this.selectedAlpha.toJSON();a.notSelectedAlpha=this.notSelectedAlpha.toJSON();var b=this.visibleSegments;if(0<b.size)for(var c=a.segments=[],b=$jscomp.makeIterator(b),d=
b.next();!d.done;d=b.next())c.push(d.value.toString());return a}},{key:"makeDropdown",value:function(a){return new B(a,this)}},{key:"handleAction",value:function(a){switch(a){case "recolor":this.segmentColorHash.randomize();break;case "clear-segments":this.visibleSegments.clear();break;case "select":if(a=this.segmentSelectionState,a.hasSelectedSegment){a=a.selectedSegment;var b=this.visibleSegments;b.has(a)?b.delete(a):b.add(a)}}}}]);return e}(k.UserLayer);e.SegmentationUserLayer=d;var B=function(c){function d(a,
c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.element=a;e.layer=c;e.visibleSegmentWidget=e.registerDisposer(new h.SegmentSetWidget(e.layer));e.addSegmentWidget=e.registerDisposer(new u.Uint64EntryWidget);e.selectedAlphaWidget=e.registerDisposer(new x.RangeWidget(e.layer.selectedAlpha));e.notSelectedAlphaWidget=e.registerDisposer(new x.RangeWidget(e.layer.notSelectedAlpha));a.classList.add("segmentation-dropdown");var f=e.selectedAlphaWidget,g=e.notSelectedAlphaWidget;f.promptElement.textContent=
"Opacity (on)";f.inputElement.min="0";f.inputElement.max="1";g.promptElement.textContent="Opacity (off)";a.appendChild(e.selectedAlphaWidget.element);a.appendChild(e.notSelectedAlphaWidget.element);e.addSegmentWidget.element.classList.add("add-segment");e.addSegmentWidget.element.title="Add segment ID";a.appendChild(e.registerDisposer(e.addSegmentWidget).element);e.registerSignalBinding(e.addSegmentWidget.valueEntered.add(function(a){e.layer.visibleSegments.add(a)}));a.appendChild(e.registerDisposer(e.visibleSegmentWidget).element);
return e}a(d,c);return d}(g.RefCounted)},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a){return a-Math.floor(a)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=d(96),f=d(67),k=d(97),l=d(37),h=d(99);g=function(){function b(a){m(this,
b);this.prefix=a;this.aName=this.prefix+"_a";this.bName=this.prefix+"_b"}a(b,[{key:"defineShader",value:function(a){var b=this.aName,d=this.bName;a.addUniform("highp vec4",b,4);a.addUniform("highp float",d,4);a.addFragmentCode(f.glsl_uint64);a.addFragmentCode(k.glsl_hashFunction);a.addFragmentCode(f.glsl_hsvToRgb);for(var e="\nvec3 "+this.prefix+"(uint64_t x) {\n  vec2 v;\n  float primeModulus = float("+c.PRIME_MODULUS+");\n",h=0;2>h;++h)var g=2*h,l=2*h,e=e+("\n  v["+h+"] = computeHash(x, "+b+"["+
l+"], "+b+"["+(l+1)+"], "+d+"["+g+"], "+d+"["+(g+1)+"], primeModulus, 1.0 / 256.0);\n");a.addFragmentCode(e+"\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n")}},{key:"enable",value:function(a,b,c){a.uniform4fv(b.uniform(this.aName),c.a_);a.uniform1fv(b.uniform(this.bName),c.b_)}}]);return b}();e.SegmentColorShaderManager=g;var n=new Float32Array(2),v=new Float32Array(3);g=function(){function d(a){m(this,d);this.a_=new Float32Array(16);this.b_=new Float32Array(4);this.changed=
new l.Signal;null==a?(this.hashFunctions=Array(2),this.randomize_()):this.hashFunctions=a;this.computeGPUCoefficients_()}a(d,[{key:"compute",value:function(a,c){for(var d=c.low,e=c.high,f=this.hashFunctions,g=0;2>g;++g)n[g]=b(f[g].compute(d,e)/256);h.hsvToRgb(a,n[0],.5+.5*n[1],1);return a}},{key:"computeCssColor",value:function(a){this.compute(v,a);return"rgb("+100*v[0]+"%,"+100*v[1]+"%,"+100*v[2]+"%)"}},{key:"debugCompute",value:function(a,d){for(var e=d.low,f=d.high,h=this.b_,g=c.PRIME_MODULUS,
k=0;2>k;++k){for(var l=2*k,n=2*k,m=new Float32Array(2),p=0;4>p;++p)m[0]+=this.a_[4*n+p]*(e>>8*p&255),m[1]+=this.a_[4*(n+1)+p]*(f>>8*p&255);var n=(m[0]+m[1])%g,p=n*n%g,v=p*h[l+1]%g,E=(h[l]+n+v)%g;console.log("b = "+h[l]+", sums="+m[0]+" "+m[1]+", dotResult="+n+", prod = "+n*n+" dotResult2="+p+", y="+v+", modResult="+E);a[k]=b(1/256*E)}return a}},{key:"randomize_",value:function(){for(var a=0;2>a;++a)this.hashFunctions[a]=c.HashFunction.generate()}},{key:"randomize",value:function(){this.randomize_();
this.computeGPUCoefficients_();this.changed.dispatch()}},{key:"toString",value:function(){return"new SegmentColorHash(["+this.hashFunctions+"])"}},{key:"computeGPUCoefficients_",value:function(){for(var a=this.hashFunctions,b=this.a_,c=this.b_,d=0;2>d;++d){var e=a[d],f=2*d,h=8*d;c[f]=1*e.b;c[f+1]=1*e.c;for(f=0;4>f;++f)b[h+f]=1*e.a0[f],b[h+4+f]=1*e.a1[f]}}}],[{key:"getDefault",value:function(){return new d([new c.HashFunction(Float32Array.of(609,2364,3749,2289),Float32Array.of(2840,1186,3660,1833),
1718,1109),new c.HashFunction(Float32Array.of(3466,3835,3345,2040),Float32Array.of(3382,901,18,3444),1534,1432)])}}]);return d}();e.SegmentColorHash=g},function(g,e){var d=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();e.PRIME_MODULUS=4093;var m=function(){function b(a,c,d,e){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this.a0=a;this.a1=c;this.b=d;this.c=e}d(b,[{key:"computeDotProduct",value:function(a,b){var d=this.a0,e=this.a1;return d[0]*(a&255)+d[1]*(a>>8&255)+d[2]*(a>>16&255)+d[3]*(a>>24&255)+(e[0]*(b&255)+e[1]*(b>>8&255)+e[2]*(b>>16&255)+e[3]*(b>>24&255))}},{key:"compute",value:function(a,b){var d=this.b,g=this.c,l=this.computeDotProduct(a,b);return(l+l*l%e.PRIME_MODULUS*g+d)%e.PRIME_MODULUS}},{key:"toString",value:function(){return"new HashFunction(Float32Array.of("+this.a0+"), Float32Array.of("+this.a1+
"), "+this.b+", "+this.c+")"}}],[{key:"generate",value:function(){function a(){return Math.floor(Math.random()*e.PRIME_MODULUS)}return new b(Float32Array.of(a(),a(),a(),a()),Float32Array.of(a(),a(),a(),a()),a(),a())}}]);return b}();e.HashFunction=m},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=d(96),f=d(98);g=d(67);var k=d(8),l=d(54);e.glsl_hashFunction=[g.glsl_uint64,
g.glsl_exactDot,g.glsl_imod,"\nfloat computeHash(uint64_t x, vec4 a0, vec4 a1, float b, float c, float modulus, float scalar) {\n  x.low *= 255.0;\n  x.high *= 255.0;\n  float dotResult = imod(exactDot(a0, x.low) + exactDot(a1, x.high), modulus);\n  float dotResult2 = imod(dotResult * dotResult, modulus);\n  float y = imod(dotResult2 * c, modulus);\n  float modResult = imod(dotResult + y + b, modulus);\n  return fract(modResult * scalar);\n}\n"];d=function(d){function e(a,b){m(this,e);var c;c=Object.getPrototypeOf(e).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.gl=a;c.hashTable=b;c.hashFunctions=null;c.generation=null;c.textures=[];var d=b.hashFunctions.length;c.a=new Float32Array(16*d);c.b=new Float32Array(4*d+5);for(var f=c.textures,h=0;h<d;++h)f[h]=a.createTexture();return c}b(e,d);a(e,[{key:"computeCoefficients",value:function(){var a=this.hashTable,b=a.hashFunctions;if(this.hashFunctions!==b){this.hashFunctions=
b;for(var d=this.a,e=this.b,f=b.length,h=a.width,a=[1/h,1/a.height],g=0;2>g;++g)e[4*f+g]=c.PRIME_MODULUS,e[4*f+3+g]=a[g];e[4*f+2]=1/(2*h);for(h=0;h<f;++h)for(a=b[h],g=0;2>g;++g){var k=a[g],l=4*h+2*g,n=4*(4*h+2*g);e[l]=k.b+(0===g?.25:.5);e[l+1]=k.c;for(l=0;4>l;++l)d[n+l]=k.a0[l],d[n+4+l]=k.a1[l]}}}},{key:"copyToGPU",value:function(){this.computeCoefficients();var a=this.hashTable,b=a.generation;if(this.generation!==b){this.generation=b;var b=a.width,c=a.height,a=a.tables,d=this.gl,e=this.textures,
f=e.length;d.activeTexture(d.TEXTURE0+d.tempTextureUnit);for(var h=0;h<f;++h){d.bindTexture(d.TEXTURE_2D,e[h]);d.pixelStorei(d.UNPACK_ALIGNMENT,1);l.setRawTextureParameters(d);var g=d.RGBA;d.texImage2D(d.TEXTURE_2D,0,g,2*b,c,0,g,d.UNSIGNED_BYTE,new Uint8Array(a[h].buffer))}d.bindTexture(d.TEXTURE_2D,null)}}},{key:"disposed",value:function(){var a=this.gl;this.textures.forEach(function(b){a.deleteTexture(b)});this.hashFunctions=this.hashTable=this.gl=this.textures=null}}],[{key:"get",value:function(a,
b){return a.memoize.get(b,function(){return new e(a,b)})}}]);return e}(k.RefCounted);e.GPUHashTable=d;d=function(){function b(a){var c=1>=arguments.length||void 0===arguments[1]?f.NUM_ALTERNATIVES:arguments[1];m(this,b);this.prefix=a;this.numAlternatives=c;$jscomp.initSymbol();this.textureUnitSymbol=Symbol("gpuhashtable:"+this.prefix);this.aName=this.prefix+"_a";this.bName=this.prefix+"_b";this.samplerName=this.prefix+"_sampler"}a(b,[{key:"defineShader",value:function(a){var b=this.aName,c=this.bName,
d=this.samplerName,f=this.numAlternatives;a.addUniform("highp vec4",b,4*f);a.addUniform("highp float",c,4*f+5);a.addTextureSampler2D(d,this.textureUnitSymbol,f);a.addFragmentCode(e.glsl_hashFunction);for(var h="",g=0;g<f;++g){for(var k=0;2>k;++k)var l=4*g+2*k,m=4*g+2*k,h=h+("\nfloat "+this.prefix+"_computeHash_"+g+"_"+k+"(uint64_t x) {\n  float primeModulus = "+c+"["+(4*f+k)+"];\n  float scalar = "+c+"["+(4*f+3+k)+"];\n  return computeHash(x, "+b+"["+m+"], "+b+"["+(m+1)+"], "+c+"["+l+"], "+c+"["+
(l+1)+"], primeModulus, scalar);\n}\n");h+="\nvec2 "+this.prefix+"_computeHash_"+g+"(uint64_t x) {\n  vec2 v;\n  v[0] = "+this.prefix+"_computeHash_"+g+"_0(x);\n  v[1] = "+this.prefix+"_computeHash_"+g+"_1(x);\n  return v;\n}\n"}h+="\nbool "+this.hasFunctionName+"(uint64_t x) {\n  float highOffset = "+c+"["+(4*f+2)+"];\n";for(b=0;b<f;++b)h+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+b+"(x);\n    vec4 lowResult = texture2D("+d+"["+b+"], v);\n    vec4 highResult = texture2D("+d+"["+b+"], vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      return true;\n    }\n  }\n";
a.addFragmentCode(h+"\n  return false;\n}\n")}},{key:"enable",value:function(a,b,c){var d=this.numAlternatives,e=c.textures;c.copyToGPU();for(var f=b.textureUnit(this.textureUnitSymbol),h=0;h<d;++h)a.activeTexture(a.TEXTURE0+(h+f)),a.bindTexture(a.TEXTURE_2D,e[h]);a.uniform4fv(b.uniform(this.aName),c.a);a.uniform1fv(b.uniform(this.bName),c.b)}},{key:"disable",value:function(a,b){for(var c=this.numAlternatives,d=b.textureUnit(this.textureUnitSymbol),e=0;e<c;++e)a.activeTexture(a.TEXTURE0+(e+d)),a.bindTexture(a.TEXTURE_2D,
null)}},{key:"hasFunctionName",get:function(){return this.prefix+"_has"}}]);return b}();e.HashTableShaderManager=d},function(g,e,d){var m=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),b=d(96);e.NUM_ALTERNATIVES=3;g=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?a.generateHashFunctions(e.NUM_ALTERNATIVES):
arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.loadFactor=.9;this.size=0;this.growFactor=1.2;this.maxWidth=4096;this.height=this.width=null;this.maxHeight=8192;this.emptyHigh=this.emptyLow=4294967295;this.maxAttempts=this.maxRehashAttempts=5;this.generation=0;this.hashFunctions=b;this.allocate(4,1)}$jscomp.initSymbol();$jscomp.initSymbolIterator();m(a,[{key:"updateHashFunctions",value:function(b){this.hashFunctions=a.generateHashFunctions(b)}},{key:"getHash",
value:function(a,b,d){a=this.hashFunctions[a];var e=this.width,h=this.height,e=a[0].compute(b,d)%e;return 2*(a[1].compute(b,d)%h*this.width+e)}},{key:Symbol.iterator,value:function(){function a(c,t){for(;;)switch(b){case 0:w=u.width*u.height,r=u.emptyLow,q=u.emptyHigh,A=[0,0],p=$jscomp.makeIterator(u.tables),m=p.next();case 1:if(m.done){b=3;break}g=m.value;h=0;case 4:if(!(h<w)){b=6;break}e=g[2*h];d=g[2*h+1];if(e===r&&d===q){b=7;break}A[0]=e;A[1]=d;b=8;return{value:A,done:!1};case 8:if(void 0===t){b=
9;break}b=-1;throw t;case 9:case 7:case 5:++h;b=4;break;case 6:case 2:m=p.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,d,e,h,g,m,p,A,q,r,w,u=this,y={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();y[Symbol.iterator]=function(){return this};return y}},{key:"hasWithTableIndex",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var h=this.getHash(e,
a,b),g=this.tables[e];if(g[h]===a&&g[h+1]===b)return e}return null}},{key:"has",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var h=this.getHash(e,a,b),g=this.tables[e];if(g[h]===a&&g[h+1]===b)return!0}return!1}},{key:"delete",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var h=this.getHash(e,a,b),g=this.tables[e];if(g[h]===a&&g[h+1]===b)return g[h]=this.emptyLow,g[h+1]=this.emptyHigh,++this.generation,this.size--,!0}return!1}},{key:"clear",value:function(){if(0===
this.size)return!1;this.size=0;++this.generation;for(var a=this.tables,b=this.emptyLow,d=this.emptyHigh,e=a.length,h=0;h<e;++h)for(var g=a[h],m=g.length,p=0;p<m;p+=2)g[p]=b,g[p+1]=d;return!0}},{key:"tryToInsert",value:function(a,b){for(var d=0,e=this.emptyLow,h=this.emptyHigh,g=this.maxAttempts,m=this.tables,p=m.length,A=Math.floor(Math.random()*p);;){var q=this.getHash(A,a,b),r=m[A],w=r[q],u=r[q+1];r[q]=a;r[q+1]=b;if(w===e&&u===h)return null;a=w;b=u;if(++d===g)break;A=(A+Math.floor(Math.random()*
(p-1)))%p}return[a,b]}},{key:"allocate",value:function(a,b){var d=a*b;this.width=a;this.height=b;for(var e=this.hashFunctions.length,h=this.tables=Array(e),g=0;g<e;++g)h[g]=new Uint32Array(2*d);this.maxAttempts=d;for(var e=this.emptyLow,g=this.emptyHigh,h=$jscomp.makeIterator(h),m=h.next();!m.done;m=h.next())for(var m=m.value,p=0;p<d;++p)m[2*p]=e,m[2*p+1]=g;this.capacity=d*this.tables.length*this.loadFactor}},{key:"rehash",value:function(a,b,d){this.allocate(b,d);this.updateHashFunctions(a.length);
a=$jscomp.makeIterator(a);for(b=a.next();!b.done;b=a.next()){b=b.value;d=b.length/2;for(var e=0;e<d;++e){var h=2*e,g=b[h],h=b[h+1];if((0!==g||0!==h)&&null!==this.tryToInsert(g,h))return!1}}return!0}},{key:"grow",value:function(a){for(var b=this.tables,d=this.width,e=this.height,h=this.maxWidth,g=this.maxHeight;;){var m=d*e,d=Math.min(h,Math.ceil(a/this.height));d*e<a&&(e=Math.min(g,Math.ceil(a/this.width)));var p=d*e;if(p<a&&p===m)throw Error("Maximum table size exceeded");for(m=0;m<this.maxRehashAttempts;++m)if(this.rehash(b,
d,e))return;a=Math.ceil(this.growFactor*a)}}},{key:"add",value:function(a,b){if(this.has(a,b))return!1;++this.generation;for(++this.size>this.capacity&&this.grow(Math.ceil(this.growFactor*this.width*this.height));;){var d=this.tryToInsert(a,b);if(null==d)return!0;a=d[0];b=d[1];this.grow(this.width*this.height)}}}],[{key:"generateHashFunctions",value:function(){for(var a=0>=arguments.length||void 0===arguments[0]?e.NUM_ALTERNATIVES:arguments[0],d=[],g=0;g<a;++g){var l=[b.HashFunction.generate(),b.HashFunction.generate()];
d.push(l)}return d}}]);return a}();e.HashTable=g},function(g,e){e.hsvToRgb=function(d,e,b,a){e*=6;var c=Math.floor(e),f=e-c;e=a*(1-b);var g=a*(1-b*f);b=a*(1-b*(1-f));switch(c%6){case 0:d[0]=a;d[1]=b;d[2]=e;break;case 1:d[0]=g;d[1]=a;d[2]=e;break;case 2:d[0]=e;d[1]=a;d[2]=b;break;case 3:d[0]=e;d[1]=g;d[2]=a;break;case 4:d[0]=b;d[1]=e;d[2]=a;break;case 5:d[0]=a,d[1]=e,d[2]=g}return d}},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var c=d(43);d(68);d(101);var f=new c.Uint64;d=function(c){function d(a){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var b=m(this,Object.getPrototypeOf(d).call(this));b.displayState=a;b.element=document.createElement("div");b.clearButton=document.createElement("button");b.itemContainer=document.createElement("span");b.items=new Map;var c=
b.element,e=b.clearButton,f=b.itemContainer;c.className="segment-set-widget noselect";e.className="clear-button";e.title="Remove all segment IDs";b.registerEventListener(e,"click",function(){b.visibleSegments.clear()});f.className="item-container";c.appendChild(f);f.appendChild(e);b.registerSignalBinding(a.visibleSegments.changed.add(b.handleSetChanged,b));b.registerSignalBinding(a.segmentColorHash.changed.add(b.handleColorChanged,b));a=$jscomp.makeIterator(a.visibleSegments);for(c=a.next();!c.done;c=
a.next())b.addElement(c.value.toString());b.updateClearButtonVisibility();return b}b(d,c);a(d,[{key:"updateClearButtonVisibility",value:function(){this.clearButton.style.display=0<this.displayState.visibleSegments.size?"":"none"}},{key:"handleSetChanged",value:function(a,b){this.updateClearButtonVisibility();var c=this.items;if(null===a){for(var d=this.itemContainer,e=this.clearButton;;){var f=d.lastElementChild;if(f===e)break;d.removeChild(f)}c.clear()}else b?this.addElement(a.toString()):(d=a.toString(),
e=c.get(d),e.parentElement.removeChild(e),c.delete(d))}},{key:"addElement",value:function(a){var b=document.createElement("button");b.className="segment-button";b.textContent=a;b.title="Remove segment ID "+a;var c=this;b.addEventListener("click",function(){f.parseString(this.textContent);c.visibleSegments.delete(f)});b.addEventListener("mouseenter",function(){f.parseString(this.textContent);c.segmentSelectionState.set(f)});b.addEventListener("mouseleave",function(){f.parseString(this.textContent);
c.segmentSelectionState.set(null)});this.setItemColor(b);this.itemContainer.appendChild(b);this.items.set(a,b)}},{key:"setItemColor",value:function(a){f.parseString(a.textContent);a.style.backgroundColor=this.segmentColorHash.computeCssColor(f)}},{key:"handleColorChanged",value:function(){var a=this;this.items.forEach(function(b){a.setItemColor(b)})}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a)}},{key:"visibleSegments",get:function(){return this.displayState.visibleSegments}},
{key:"segmentColorHash",get:function(){return this.displayState.segmentColorHash}},{key:"segmentSelectionState",get:function(){return this.displayState.segmentSelectionState}}]);return d}(g.RefCounted);e.SegmentSetWidget=d},function(g,e){},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var a=d(43),c=d(37);d=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");for(var b=arguments.length,d=Array(b),f=0;f<b;f++)d[f]=
arguments[f];var g,b=(g=Object.getPrototypeOf(e)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(d)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");g=!b||"object"!==typeof b&&"function"!==typeof b?this:b;g.selectedSegment=new a.Uint64;g.hasSelectedSegment=!1;g.changed=new c.Signal;return g}m(e,d);b(e,[{key:"set",value:function(a){if(null==a)this.hasSelectedSegment&&(this.hasSelectedSegment=!1,this.changed.dispatch());else{var b=this.selectedSegment;
this.hasSelectedSegment&&a.low===b.low&&a.high===b.high||(b.low=a.low,b.high=a.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}},{key:"isSelected",value:function(b){return this.hasSelectedSegment&&a.Uint64.equal(b,this.selectedSegment)}},{key:"bindTo",value:function(b,c){var d=this,e=new a.Uint64;this.registerSignalBinding(b.changed.add(function(){var a=b.get(c);"number"===typeof a&&(e.low=a,e.high=0,a=e);d.set(a)}))}}]);return e}(g.RefCounted);e.SegmentSelectionState=d},function(g,e,d){function m(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),a=function h(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:h(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=d(7);var c=d(98),f=d(37),k=d(43);d=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];
var h,a=(h=Object.getPrototypeOf(e)).call.apply(h,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");h=!a||"object"!==typeof a&&"function"!==typeof a?this:a;h.hashTable=new c.HashTable;h.changed=new f.Signal;return h}m(e,d);$jscomp.initSymbol();$jscomp.initSymbolIterator();b(e,[{key:"initializeCounterpart",value:function(b){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];c.type="Uint64Set";
a(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,b,c)}},{key:"disposed",value:function(){a(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.changed=this.hashTable=null}},{key:"add_",value:function(a){return this.hashTable.add(a.low,a.high)}},{key:"add",value:function(a){if(this.add_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.add",{id:this.rpcId,value:a});this.changed.dispatch(a,!0)}}},{key:"has",value:function(a){return this.hashTable.has(a.low,a.high)}},
{key:Symbol.iterator,value:function(){function a(g,m){for(;;)switch(b){case 0:f=new k.Uint64,$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=$jscomp.makeIterator(h.hashTable[Symbol.iterator]()),d=e.next();case 1:if(d.done){b=3;break}c=d.value;f.low=c[0];f.high=c[1];b=4;return{value:f,done:!1};case 4:if(void 0===m){b=5;break}b=-1;throw m;case 5:case 2:d=e.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,h=this,g={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,
b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}},{key:"delete_",value:function(a){return this.hashTable.delete(a.low,a.high)}},{key:"delete",value:function(a){if(this.delete_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.delete",{id:this.rpcId,value:a});this.changed.dispatch(a,!1)}}},{key:"clear",value:function(){if(this.hashTable.clear()){var a=this.rpc;a&&a.invoke("Uint64Set.clear",{id:this.rpcId});this.changed.dispatch(null,
!1)}}},{key:"size",get:function(){return this.hashTable.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new e;b.initializeCounterpart(a);return b}}]);return e}(g.SharedObjectCounterpart);e.Uint64Set=d;g.registerRPC("Uint64Set.add",function(a){var b=this.get(a.id);b.add_(a.value)&&b.changed.dispatch()});g.registerRPC("Uint64Set.delete",function(a){var b=this.get(a.id);b.delete_(a.value)&&b.changed.dispatch()});g.registerRPC("Uint64Set.clear",function(a){a=this.get(a.id);a.hashTable.clear()&&
a.changed.dispatch()});g.registerSharedObject("Uint64Set",d)},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}function a(){var a=0>=arguments.length||void 0===arguments[0]?.5:arguments[0];return new h.TrackableValue(a,n.verifyFloat01,a)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:p(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=d(39);var k=d(95),l=d(97),h=d(105),n=d(11);e.trackableAlphaValue=a;d=function(d){function e(b,c,d){var f=3>=arguments.length||void 0===arguments[3]?a(.5):arguments[3],h=4>=arguments.length||void 0===arguments[4]?a(0):arguments[4];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var g=m(this,Object.getPrototypeOf(e).call(this,
b,c));g.displayState=d;g.selectedAlpha=f;g.notSelectedAlpha=h;g.selectedSegmentForShader=new Float32Array(8);g.segmentColorShaderManager=new k.SegmentColorShaderManager("segmentColorHash");g.hashTableManager=new l.HashTableShaderManager("visibleSegments");g.gpuHashTable=l.GPUHashTable.get(g.gl,g.displayState.visibleSegments.hashTable);g.registerSignalBinding(d.segmentSelectionState.changed.add(g.redrawNeeded.dispatch,g));g.registerSignalBinding(d.segmentColorHash.changed.add(g.redrawNeeded.dispatch,
g));g.registerSignalBinding(d.visibleSegments.changed.add(g.redrawNeeded.dispatch,g));g.registerSignalBinding(f.changed.add(function(){g.redrawNeeded.dispatch()}));g.registerSignalBinding(h.changed.add(function(){g.redrawNeeded.dispatch()}));return g}b(e,d);c(e,[{key:"getShaderKey",value:function(){return"sliceview.SegmentationRenderLayer"}},{key:"defineShader",value:function(a){f(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);this.hashTableManager.defineShader(a);this.segmentColorShaderManager.defineShader(a);
a.addUniform("highp vec4","uSelectedSegment",2);a.addUniform("highp float","uShowAllSegments");a.addUniform("highp float","uSelectedAlpha");a.addUniform("highp float","uNotSelectedAlpha");a.setFragmentMain("\nuint64_t value = getDataValue();\n  float alpha = uSelectedAlpha;\n  float saturation = 1.0;\n  if (value.low == vec4(0,0,0,0) && value.high == vec4(0,0,0,0)) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n  bool has = uShowAllSegments > 0.0 ? true : "+this.hashTableManager.hasFunctionName+
"(value);\n  if (uSelectedSegment[0] == value.low && uSelectedSegment[1] == value.high) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n")}},{key:"beginSlice",value:function(a){a=f(Object.getPrototypeOf(e.prototype),"beginSlice",this).call(this,a);var b=this.gl,c=this.selectedSegmentForShader,d=this.displayState,g=this.displayState,h=g.segmentSelectionState,
g=g.visibleSegments;if(h.hasSelectedSegment)for(var k=h.selectedSegment,h=k.low,k=k.high,l=0;4>l;++l)c[l]=(h>>8*l&255)/255,c[4+l]=(k>>8*l&255)/255;else c.fill(0);b.uniform1f(a.uniform("uSelectedAlpha"),this.selectedAlpha.value);b.uniform1f(a.uniform("uNotSelectedAlpha"),this.notSelectedAlpha.value);b.uniform4fv(a.uniform("uSelectedSegment"),c);b.uniform1f(a.uniform("uShowAllSegments"),g.hashTable.size?0:1);this.hashTableManager.enable(b,a,this.gpuHashTable);this.segmentColorShaderManager.enable(b,
a,d.segmentColorHash);return a}},{key:"endSlice",value:function(a){this.hashTableManager.disable(this.gl,a);f(Object.getPrototypeOf(e.prototype),"endSlice",this).call(this,a)}}]);return e}(g.RenderLayer);e.SegmentationRenderLayer=d},function(g,e,d){var m=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),b=d(37);
g=function(){function a(c,d,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.value_=c;this.validator=d;this.defaultValue=e;this.changed=new b.Signal}m(a,[{key:"toJSON",value:function(){return this.value_===this.defaultValue?void 0:this.value_}},{key:"restoreState",value:function(a){if(void 0!==a){var b=this.validator;try{this.value=b(a);return}catch(d){}}a=this.defaultValue;void 0!==a&&(this.value=a)}},{key:"value",get:function(){return this.value_},set:function(a){a!==
this.value_&&(this.value_=a,this.changed.dispatch())}}]);return a}();e.TrackableValue=g},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var c=function t(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(41),l=d(35),h=d(37);g=d(36);var n=d(8),v=d(21),p=d(57),A=d(107),q=d(67),r=d(40),w=d(7),u=function(){function b(){a(this,b);this.tempMat=v.mat4.create();this.tempPickID=new Float32Array(4)}f(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4","uProjection");
a.addUniform("highp vec4","uPickID");a.setVertexMain("gl_Position = uProjection * vec4(aVertexPosition, 1.0);");a.setFragmentMain("emit(vec4(uColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,b,c,d){c=v.mat4.multiply(this.tempMat,c.dataToDevice,d);a.uniformMatrix4fv(b.uniform("uProjection"),!1,c)}},{key:"getShader",value:function(a,b,c){var d=this;return a.memoize.get(b,function(){var b=new k.ShaderBuilder(a);b.require(c);d.defineShader(b);return b.build()})}},{key:"drawSkeleton",value:function(a,
b,c,d,e,f){f||a.uniform3fv(b.uniform("uColor"),d);a.uniform4fv(b.uniform("uPickID"),q.setVec4FromUint32(this.tempPickID,e));c.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);c.indexBuffer.bind();a.drawElements(a.LINES,c.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"))}}]);return b}();d=function(c){function d(b){a(this,d);var c=m(this,Object.getPrototypeOf(d).call(this));c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,
"skeleton/SkeletonShaderManager:PerspectivePanel",p.perspectivePanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);f(d,[{key:"draw",value:function(a){this.base.draw(a,this,this.shader,1>=arguments.length||void 0===arguments[1]?!1:arguments[1])}},{key:"drawPicking",value:function(a){this.base.draw(a,this,this.shader,!0)}},{key:"gl",get:function(){return this.base.gl}}]);return d}(p.PerspectiveViewRenderLayer);
e.PerspectiveViewSkeletonLayer=d;d=function(c){function d(b){a(this,d);var c=m(this,Object.getPrototypeOf(d).call(this));c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,"skeleton/SkeletonShaderManager:SliceViewPanel",A.sliceViewPanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);f(d,[{key:"draw",value:function(a){console.log("drawing on sliceview");this.base.draw(a,this,this.shader,!1,10)}},
{key:"gl",get:function(){return this.base.gl}}]);return d}(A.SliceViewPanelRenderLayer);e.SliceViewPanelSkeletonLayer=d;n=function(c){function d(b,c,e,f){a(this,d);var g=m(this,Object.getPrototypeOf(d).call(this));g.chunkManager=b;g.source=c;g.voxelSizeObject=e;g.displayState=f;g.tempMat=v.mat4.create();g.skeletonShaderManager=new u;g.redrawNeeded=new h.Signal;e=function(){g.redrawNeeded.dispatch()};g.registerSignalBinding(f.segmentColorHash.changed.add(e));g.registerSignalBinding(f.visibleSegments.changed.add(e));
g.registerSignalBinding(f.segmentSelectionState.changed.add(e));g.registerDisposer(new w.SharedObject).initializeCounterpart(b.rpc,{type:"skeleton/SkeletonLayer",chunkManager:b.rpcId,source:c.addCounterpartRef(),visibleSegmentSet:f.visibleSegments.rpcId});return g}b(d,c);f(d,[{key:"draw",value:function(a,b,c){var d=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],e=4>=arguments.length||void 0===arguments[4]?d?5:1:arguments[4],f=this.gl,g=this.skeletonShaderManager;c.bind();var h=this.tempMat;
v.mat4.identity(h);v.mat4.scale(h,h,this.voxelSizeObject.size);g.beginLayer(f,c,a,h);var h=this.source.chunks,k=a.pickIDs,m=v.vec3.create(),n=this.displayState,p=n.segmentColorHash,t=n.segmentSelectionState;f.lineWidth(e);e=$jscomp.makeIterator(n.visibleSegments);for(n=e.next();!n.done;n=e.next()){var n=n.value,q=h.get(n.low+":"+n.high);if(void 0!==q&&q.state===l.ChunkState.GPU_MEMORY){if(!d&&(p.compute(m,n),t.isSelected(n)))for(var u=0;3>u;++u)m[u]=.5*m[u]+.5;g.drawSkeleton(f,c,q,m,k.register(b,
n),d)}}g.endLayer(f,c)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return d}(n.RefCounted);e.SkeletonLayer=n;var y=function(d){function e(b,c){a(this,e);var d=m(this,Object.getPrototypeOf(e).call(this,b));d.data=c.data;return d}b(e,d);f(e,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,a);var b=this.data,d=(new DataView(b.buffer)).getInt32(0,!0),f=new Float32Array(b.buffer,4,3*d),b=new Uint32Array(b.buffer,12*d+
4);this.vertexBuffer=r.Buffer.fromData(a,f,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=r.Buffer.fromData(a,b,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.numIndices=b.length}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose()}}]);return e}(g.Chunk);e.SkeletonChunk=y;g=function(c){function d(){a(this,d);return m(this,Object.getPrototypeOf(d).apply(this,arguments))}b(d,c);f(d,[{key:"getChunk",
value:function(a){return new y(this,a)}}]);return d}(g.ChunkSource);e.SkeletonSource=g},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+y.COLOR+"] = color;\n  gl_FragData["+y.PICK+"] = pickId;\n}\n")}var f=function B(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),
null===a?void 0:B(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},k=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),l=d(58),h=d(42),n=d(59);g=d(60);var v=d(34),p=d(65),A=d(21),q=d(66),r=d(53),w=d(108),u=d(37);(function(a){a[a.COLOR=0]="COLOR";a[a.PICK=1]="PICK";a[a.NUM_TEXTURES=
2]="NUM_TEXTURES"})(e.OffscreenTextures||(e.OffscreenTextures={}));var y=e.OffscreenTextures;e.sliceViewPanelEmit=c;var x=function(c){function d(){m(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.redrawNeeded=new u.Signal;return a}a(d,c);k(d,[{key:"draw",value:function(a){}}]);return d}(h.RenderLayer);e.SliceViewPanelRenderLayer=x;d=function(d){function e(a,d,f,
g){m(this,e);var k=b(this,Object.getPrototypeOf(e).call(this,a,d,g));k.sliceView=f;k.axesLineHelper=l.AxesLineHelper.get(k.gl);k.sliceViewRenderHelper=v.SliceViewRenderHelper.get(k.gl,"SliceViewRenderHelper",c);k.colorFactor=A.vec4.fromValues(1,1,1,1);k.backgroundColor=A.vec4.fromValues(.5,.5,.5,1);k.pickIDs=new n.PickIDManager;k.visibleLayerTracker=k.registerDisposer(new h.VisibleRenderLayerTracker(k.viewer.layerManager,x,function(a){a.redrawNeeded.add(k.scheduleRedraw,k);k.scheduleRedraw()},function(a){a.redrawNeeded.remove(k.scheduleRedraw,
k);k.scheduleRedraw()}));k.offscreenFramebuffer=new r.OffscreenFramebuffer(k.gl,{numDataBuffers:y.NUM_TEXTURES});k.offscreenCopyHelper=r.OffscreenCopyHelper.get(k.gl);k.scaleBarWidget=k.registerDisposer(new w.ScaleBarWidget);k.registerDisposer(f);k.registerSignalBinding(f.viewChanged.add(a.scheduleRedraw,a));k.registerSignalBinding(g.showAxisLines.changed.add(function(){k.scheduleRedraw()}));a=k.scaleBarWidget.element;k.registerDisposer(new p.ElementVisibilityFromTrackableBoolean(g.showScaleBar,a));
k.element.appendChild(a);return k}a(e,d);k(e,[{key:"draw",value:function(){var a=this.sliceView;if(a.hasValidViewport){a.updateRendering();var b=this.gl,c=a.width,d=a.height,e=a.dataToDevice;this.offscreenFramebuffer.bind(c,d);b.disable(b.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);var f=A.mat4.create();this.sliceViewRenderHelper.draw(a.offscreenFramebuffer.dataTextures[0],A.identityMat4,this.colorFactor,this.backgroundColor,0,0,1,1);var g=this.visibleLayerTracker.getVisibleLayers(),
h=this.pickIDs;h.clear();for(var h={dataToDevice:a.dataToDevice,pickIDs:h},g=$jscomp.makeIterator(g),k=g.next();!k.done;k=g.next())k.value.draw(h);if(this.viewer.showAxisLines.value){A.mat4.copy(f,e);for(e=0;3>e;++e)f[12+e]=0;for(e=0;4>e;++e)f[2+4*e]=0;d=Math.min(c,d)/4*1.5;e=a.pixelSize;for(h=0;12>h;++h)f[h]=f[h]*d*e;b.WEBGL_draw_buffers.drawBuffersWEBGL([b.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]);this.axesLineHelper.draw(f)}this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[y.COLOR]);
b=this.scaleBarWidget;f=b.dimensions;f.targetLengthInPixels=Math.min(c/4,100);f.nanometersPerPixel=a.pixelSize;b.update()}}},{key:"onResize",value:function(){this.sliceView.setViewportSize(this.element.clientWidth,this.element.clientHeight)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;var b=this.sliceView;if(!b.hasValidViewport)return!1;var c=b.width,d=b.height,e=this.offscreenFramebuffer;if(!e.hasSize(c,d))return!1;var f=a.position,g=this.mouseX,h=this.mouseY;A.vec3.set(f,
g-c/2,h-d/2,0);A.vec3.transformMat4(f,f,b.viewportToData);this.pickIDs.setMouseState(a,e.readPixelAsUint32(y.PICK,g,d-h));return!0}},{key:"onMousedown",value:function(a){var b=this;event.target===this.element&&(f(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.sliceView.hasValidViewport&&0===a.button&&this.viewer.mouseState.updateUnconditionally()&&function(){var c=A.vec3.clone(b.viewer.mouseState.position);q.startRelativeMouseDrag(a,function(a,d,e){var f=b.viewer.navigationState.position;
a.shiftKey?(f=b.sliceView.viewportAxes,b.viewer.navigationState.pose.rotateAbsolute(f[1],d/4*Math.PI/180,c),b.viewer.navigationState.pose.rotateAbsolute(f[0],e/4*Math.PI/180,c)):(a=f.spatialCoordinates,A.vec3.set(a,d,e,0),A.vec3.transformMat4(a,a,b.sliceView.viewportToData),f.changed.dispatch())})}())}},{key:"zoomByMouse",value:function(a){var b=this.navigationState;if(b.valid){var c=this.sliceView,d=c.height,e=this.mouseX,f=this.mouseY,e=e-c.width/2,f=f-d/2,d=this.navigationState.zoomFactor.value;
b.zoomBy(a);a=b.zoomFactor.value;var g=b.position.spatialCoordinates;A.vec3.scaleAndAdd(g,g,c.viewportAxes[0],e*(d-a));A.vec3.scaleAndAdd(g,g,c.viewportAxes[1],f*(d-a));b.position.changed.dispatch()}}},{key:"navigationState",get:function(){return this.sliceView.navigationState}}]);return e}(g.RenderedDataPanel);e.SliceViewPanel=d},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();
g=d(8);var c=d(10);d(109);var f=[1.5,2,3,5,7.5,10],k=[{unit:"km",lengthInNanometers:1E12},{unit:"m",lengthInNanometers:1E9},{unit:"mm",lengthInNanometers:1E6},{unit:"\u00b5m",lengthInNanometers:1E3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}],l=function(){function c(){b(this,c);this.allowedSignificands=f;this.prevTargetLengthInPixels=this.prevNanometersPerPixel=0}a(c,[{key:"update",value:function(){var a=this.nanometersPerPixel,b=this.targetLengthInPixels;if(this.prevNanometersPerPixel===
a&&this.prevTargetLengthInPixels===b)return!1;this.prevNanometersPerPixel=a;this.prevTargetLengthInPixels=b;for(var c=b*a,b=Math.pow(10,Math.floor(Math.log(c)/Math.LN10)),c=c/b,d=1,e=$jscomp.makeIterator(this.allowedSignificands),f=e.next();!f.done;f=e.next())if(f=f.value,Math.abs(f-c)<Math.abs(d-c))d=f;else break;b*=d;c=k.length;d=k[c-1];for(e=0;e<c;++e)if(f=k[e],b>=f.lengthInNanometers){d=f;break}this.lengthInPixels=Math.round(b/a);this.physicalUnit=d.unit;this.physicalLength=b/d.lengthInNanometers;
return!0}}]);return c}();e.ScaleBarDimensions=l;d=function(d){function e(){var a=0>=arguments.length||void 0===arguments[0]?new l:arguments[0];b(this,e);var c;c=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.dimensions=a;c.element=document.createElement("div");c.textNode=document.createTextNode("");c.barElement=document.createElement("div");var a=c.element,
d=c.textNode,f=c.barElement;a.className="scale-bar-container";a.appendChild(d);a.appendChild(f);f.className="scale-bar";return c}m(e,d);a(e,[{key:"update",value:function(){var a=this.dimensions;a.update()&&(this.textNode.textContent=a.physicalLength+" "+a.physicalUnit,this.barElement.style.width=a.lengthInPixels+"px")}},{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);return e}(g.RefCounted);e.ScaleBarWidget=d},function(g,e){},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=d(10);g=d(8);var f=d(43),k=d(37);d(68);d(111);d=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=m(this,Object.getPrototypeOf(e).call(this));a.element=document.createElement("form");a.label=document.createElement("label");a.input=document.createElement("input");a.value=new f.Uint64;a.valueEntered=new k.Signal;var b=
a.element,c=a.label,d=a.input;b.className="uint64-entry noselect";b.appendChild(c);c.appendChild(d);a.registerEventListener(b,"submit",function(b){b.preventDefault();a.validateInput()&&(a.input.value="",a.input.classList.remove("valid-input","invalid-input"),a.valueEntered.dispatch(a.value))});a.registerEventListener(b,"input",function(){""===a.input.value?a.input.classList.remove("valid-input","invalid-input"):a.validateInput()?a.input.classList.remove("invalid-input"):a.input.classList.add("invalid-input")});
return a}b(e,d);a(e,[{key:"validateInput",value:function(){return this.value.parseString(this.input.value)}},{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);return e}(g.RefCounted);e.Uint64EntryWidget=d},function(g,e){},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var c=d(10);d(113);d=function(d){function e(a){var b=1>=arguments.length||
void 0===arguments[1]?{}:arguments[1],c=b.min,c=void 0===c?0:c,d=b.max,d=void 0===d?1:d,b=b.step,b=void 0===b?.01:b;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var f=m(this,Object.getPrototypeOf(e).call(this));f.value=a;f.element=document.createElement("label");f.promptElement=document.createElement("span");f.inputElement=document.createElement("input");var g=f.element,q=f.promptElement,r=f.inputElement;g.className="range-slider";q.className="range-prompt";r.type=
"range";r.min=""+c;r.max=""+d;r.step=""+b;r.valueAsNumber=f.value.value;g.appendChild(q);g.appendChild(r);var w=function(){f.value.value=f.inputElement.valueAsNumber};f.registerEventListener(r,"change",w);f.registerEventListener(r,"input",w);f.registerEventListener(r,"wheel",function(a){a=a.deltaY;0<a?(f.inputElement.stepUp(),w()):0>a&&(f.inputElement.stepDown(),w())});a.changed.add(function(){f.inputElement.valueAsNumber=f.value.value});return f}b(e,d);a(e,[{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);
return e}(g.RefCounted);e.RangeWidget=d},function(g,e){},function(g,e){},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(42);var a=d(116),c=d(93);d=function(d){function e(b,d){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var f=d.source;if("string"!==typeof f)throw Error("Invalid image layer specification");var g;g=Object.getPrototypeOf(e).call(this,[]);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
g=!g||"object"!==typeof g&&"function"!==typeof g?this:g;g.volumePath=f;g.addRenderLayer(new a.ImageRenderLayer(b.chunkManager,c.getVolumeWithStatusMessage(f)));return g}m(e,d);b(e,[{key:"toJSON",value:function(){var a={type:"image"};a.source=this.volumePath;return a}},{key:"makeDropdown",value:function(a){return null}}]);return e}(g.UserLayer);e.ImageUserLayer=d},function(g,e,d){function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),a=function f(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,
b);if(void 0===e)return a=Object.getPrototypeOf(a),null===a?void 0:f(a,b,d);if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)};g=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=Object.getPrototypeOf(e).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}m(e,d);b(e,[{key:"getShaderKey",value:function(){return"sliceview.ImageRenderLayer"}},
{key:"defineShader",value:function(b){a(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,b);b.setFragmentMain("\nfloat value = getDataValue();\nemit(vec4(value, value, value, 0.7));\n")}}]);return e}(d(39).RenderLayer);e.ImageRenderLayer=g},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=document.createElement("div");b.textContent=a.value;return b}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);
return b}}(),f=d(46);g=d(8);var k=d(10),l=d(118),h=d(89),n=d(119),v=d(6),p=d(120),A=d(121),q=d(37);d(122);$jscomp.initSymbol();var r=Symbol("autocompleteIndex");e.makeDefaultCompletionElement=a;e.makeCompletionElementWithDescription=function(a){var b=document.createElement("div");b.className="autocomplete-completion-with-description";b.textContent=a.value;var c=document.createElement("div");c.className="autocomplete-completion-description";c.textContent=a.description||"";b.appendChild(c);return b};
var w=new h.KeySequenceMap({arrowdown:"cycle-next-active-completion",arrowup:"cycle-prev-active-completion",tab:"choose-active-completion-or-prefix",enter:"choose-active-completion"}),u=new Map([["cycle-next-active-completion",function(){this.cycleActiveCompletion(1);return!0}],["cycle-prev-active-completion",function(){this.cycleActiveCompletion(-1);return!0}],["choose-active-completion-or-prefix",function(){return this.selectActiveCompletion(!0)}],["choose-active-completion",function(){return this.selectActiveCompletion(!1)}]]);
d=function(d){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=m(this,Object.getPrototypeOf(e).call(this));b.inputChanged=new q.Signal;b.prevInputValue="";b.completionsVisible=!1;b.activeCompletionPromise=null;b.hasFocus=!1;b.completionResult=null;b.dropdownContentsStale=!0;b.updateHintScrollPositionTimer=null;b.completionElements=null;b.hasResultForDropdown=!1;b.commonPrefix="";b.activeIndex=-1;b.dropdownStyleStale=!0;b.completer=a.completer;a=
a.delay;var c=b.scheduleUpdateCompletions=f(function(){var a=b.activeCompletionPromise=b.completer(b.value);null!==a&&a.then(function(c){b.activeCompletionPromise===a&&(b.setCompletions(c),b.activeCompletionPromise=null)})},void 0===a?200:a);b.registerDisposer(function(){c.cancel()});a=b.element=document.createElement("div");a.className="autocomplete";var d=document.createElement("div");d.className="autocomplete-dropdown-wrapper";var g=b.dropdownElement=document.createElement("div");g.className="autocomplete-dropdown";
var k=b.promptElement=document.createElement("label");k.className="autocomplete-prompt";var l=b.inputWrapperElement=document.createElement("div");l.className="autocomplete-input-wrapper";a.appendChild(k);var n=b.inputElement=document.createElement("input");n.type="text";n.autocomplete="off";n.spellcheck=!1;n.className="autocomplete-input";A.associateLabelWithElement(k,n);k=b.hintElement=document.createElement("input");k.type="text";k.spellcheck=!1;k.className="autocomplete-hint";k.disabled=!0;l.appendChild(k);
l.appendChild(n);d.appendChild(l);d.appendChild(g);a.appendChild(d);b.registerInputHandler();b.handleInputChanged("");b.registerEventListener(b.inputElement,"focus",function(){b.hasFocus||(b.hasFocus=!0,b.dropdownStyleStale=!0,b.updateDropdown())});b.registerEventListener(b.inputElement,"blur",function(){b.hasFocus&&(b.hasFocus=!1,b.updateDropdown())});b.registerEventListener(a.ownerDocument.defaultView,"resize",function(){b.dropdownStyleStale=!0});b.registerEventListener(a.ownerDocument.defaultView,
"scroll",function(){b.dropdownStyleStale=!0});b.registerEventListener(b.dropdownElement,"mousedown",b.handleDropdownMousedown.bind(b));b.registerEventListener(b.inputElement,"keydown",function(){b.hintScrollPositionMayBeStale()});b.registerEventListener(b.inputElement,"mousemove",function(a){0!==a.buttons&&b.hintScrollPositionMayBeStale()});(b.keyboardHandler=b.registerDisposer(new h.KeyboardShortcutHandler(n,w,b.handleKeyCommand.bind(b)))).allShortcutsAreGlobal=!0;return b}b(e,d);c(e,[{key:"hintScrollPositionMayBeStale",
value:function(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}},{key:"handleDropdownMousedown",value:function(a){this.inputElement.focus();for(var b=this.dropdownElement,c=a.target;c instanceof HTMLElement;c=c.parentElement){var d=c[r];if(void 0!==d){this.selectCompletion(d);break}if(c===b)break}a.preventDefault()}},{key:"cycleActiveCompletion",value:function(a){if(null!==this.completionResult){var b=this.activeIndex,c=this.completionResult.completions.length;this.setActiveIndex(-1===
b?0<a?0:c-1:(b+a+c)%c)}}},{key:"handleKeyCommand",value:function(a){return u.get(a).call(this)}},{key:"registerInputHandler",value:function(){for(var a=this,b=function(b){b=a.inputElement.value;b!==a.prevInputValue&&(a.prevInputValue=b,a.handleInputChanged(b))},c=$jscomp.makeIterator(["input"]),d=c.next();!d.done;d=c.next())this.registerEventListener(this.inputElement,d.value,b,!1)}},{key:"shouldShowDropdown",value:function(){return null!==this.completionResult&&this.hasFocus?this.hasResultForDropdown:
!1}},{key:"updateDropdownStyle",value:function(){l.positionDropdown(this.dropdownElement,this.inputElement,{horizontal:!1});this.dropdownStyleStale=!1}},{key:"updateDropdown",value:function(){var b=this;this.shouldShowDropdown()?function(){var c=b.dropdownElement,d=b.activeIndex;b.dropdownContentsStale&&function(){var e=b.completionResult,f=e.makeElement,g=void 0===f?a:f;b.completionElements=e.completions.map(function(a,b){var f=g.call(e,a);f[r]=b;f.classList.add("autocomplete-completion");d===b&&
f.classList.add("autocomplete-completion-active");c.appendChild(f);return f});b.dropdownContentsStale=!1}();b.dropdownStyleStale&&b.updateDropdownStyle();b.completionsVisible||(c.style.display="block",b.completionsVisible=!0);-1!==d&&p.scrollIntoViewIfNeeded(b.completionElements[d])}():this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}},{key:"setCompletions",value:function(a){this.clearCompletions();var b=a.completions;0!==b.length&&(this.completionResult=
a,1===b.length?(b=b[0],a.showSingleResult?this.hasResultForDropdown=!0:b.value.startsWith(this.prevInputValue)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,this.setActiveIndex(0)):(this.hasResultForDropdown=!0,b=n.longestCommonPrefix(function(){function b(g,h){for(;;)switch(c){case 0:f=$jscomp.makeIterator(a.completions),e=f.next();case 1:if(e.done){c=3;break}d=e.value;c=4;return{value:d.value,done:!1};case 4:if(void 0===h){c=5;break}c=-1;throw h;case 5:case 2:e=f.next();c=1;break;case 3:c=
-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}()),b=this.getCompletedValue(b),b.startsWith(this.prevInputValue)&&(this.commonPrefix=b,this.setHintValue(b))),this.updateDropdown())}},{key:"scheduleUpdateHintScrollPosition",value:function(){if(null===this.updateHintScrollPositionTimer){var a=
this;this.updateHintScrollPositionTimer=setTimeout(function(){a.updateHintScrollPosition()},0)}}},{key:"setHintValue",value:function(a){var b=this.prevInputValue;a!==b&&a.startsWith(b)||(a="");this.hintElement.value=a;this.scheduleUpdateHintScrollPosition()}},{key:"setActiveIndex",value:function(a){if(!this.dropdownContentsStale){var b=this.activeIndex;-1!==b&&this.completionElements[b].classList.remove("autocomplete-completion-active");-1!==a&&(b=this.completionElements[a],b.classList.add("autocomplete-completion-active"),
p.scrollIntoViewIfNeeded(b))}-1!==a&&this.setHintValue(this.getCompletedValueByIndex(a));this.activeIndex=a}},{key:"getCompletedValueByIndex",value:function(a){return this.getCompletedValue(this.completionResult.completions[a].value)}},{key:"getCompletedValue",value:function(a){return this.prevInputValue.substring(0,this.completionResult.offset)+a}},{key:"selectActiveCompletion",value:function(a){var b=this.activeIndex;if(-1===b){if(!a)return!1;a=this.commonPrefix;return a.length>this.value.length?
(this.value=a,!0):!1}a=this.getCompletedValueByIndex(b);if(this.value===a)return!1;this.value=a;return!0}},{key:"selectCompletion",value:function(a){this.value=this.getCompletedValueByIndex(a)}},{key:"updateHintScrollPosition",value:function(){this.updateHintScrollPositionTimer=null;this.hintElement.scrollLeft=this.inputElement.scrollLeft}},{key:"cancelActiveCompletion",value:function(){v.cancelPromise(this.activeCompletionPromise);this.activeCompletionPromise=null}},{key:"handleInputChanged",value:function(a){this.cancelActiveCompletion();
this.hintElement.value="";this.clearCompletions();this.inputChanged.dispatch(a);this.scheduleUpdateCompletions()}},{key:"clearCompletions",value:function(){null!==this.completionResult&&(this.activeIndex=-1,this.completionElements=this.completionResult=null,this.dropdownStyleStale=this.dropdownContentsStale=!0,this.commonPrefix="",k.removeChildren(this.dropdownElement),this.updateDropdown())}},{key:"disposed",value:function(){k.removeFromParent(this.element);this.cancelActiveCompletion();null!==this.updateHintScrollPositionTimer&&
(clearTimeout(this.updateHintScrollPositionTimer),this.updateHintScrollPositionTimer=null)}},{key:"disabled",get:function(){return this.inputElement.disabled},set:function(a){this.inputElement.disabled=a}},{key:"value",get:function(){return this.prevInputValue},set:function(a){a!==this.prevInputValue&&(this.prevInputValue=this.inputElement.value=a,this.handleInputChanged(a))}}]);return e}(g.RefCounted);e.AutocompleteTextInput=d},function(g,e){e.positionDropdown=function(d,e){var b=2>=arguments.length||
void 0===arguments[2]?{}:arguments[2],a=b.horizontal,c=void 0===a?!1:a,a=b.vertical,a=void 0===a?!0:a,f=b.topMargin,f=void 0===f?6:f,g=b.bottomMargin,g=void 0===g?6:g,l=b.leftMargin,l=void 0===l?6:l,h=b.rightMargin,n=void 0===h?6:h,h=b.maxHeight,h=void 0===h?!0:h,b=b.maxWidth,v=void 0===b?!0:b,b=e.getBoundingClientRect();if(c){var c=b.right,p=d.ownerDocument.documentElement.clientHeight-b.left;c>p?(d.style.left="",d.style.right="0",v&&(d.style.maxWidth=c-l+"px")):(d.style.right="",d.style.left="0",
v&&(d.style.maxWidth=p-n+"px"))}a&&(a=b.top-f,c=d.ownerDocument.documentElement.clientHeight-b.bottom-g,a>3*c?(d.style.top="",d.style.bottom="100%",h&&(d.style.maxHeight=a+"px")):(d.style.top="100%",d.style.bottom="",h&&(d.style.maxHeight=c+"px")))}},function(g,e){e.longestCommonPrefix=function(d){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=d[Symbol.iterator]();var e=d.next(),b=e.value;if(e.done)return"";for(e=b.length;0<e;){var a=d.next(),c=a.value;if(a.done)break;for(a=0;a<e&&b.charCodeAt(a)===
c.charCodeAt(a);++a);e=a}return b.substring(0,e)}},function(g,e){e.scrollIntoViewIfNeeded=function(d){var e=d.parentElement,b=d.offsetLeft-e.clientLeft,a=d.offsetTop-e.clientTop,c=e.scrollLeft,f=e.scrollTop,a=Math.max(0,a+d.offsetHeight-(f+e.clientHeight))||Math.min(0,a-f);e.scrollLeft+=Math.max(0,b+d.offsetWidth-(c+e.clientWidth))||Math.min(0,b-c);e.scrollTop+=a}},function(g,e){var d=0;e.associateLabelWithElement=function(e,b){""===b.id&&(b.id="unique-id-for-association-"+d++);e.setAttribute("for",
b.id)}},function(g,e){},function(g,e){e.makeHiddenSubmitButton=function(){var d=document.createElement("button");d.type="submit";d.className="hidden-submit-button";d.style.margin="0";d.style.border="0";d.style.padding="0";d.style.width="0";d.style.height="0";d.style.overflow="hidden";d.tabIndex=-1;return d}},function(g,e){},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in
Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=d(93);g=d(8);var l=d(10),h=d(118),n=d(126),v=d(92);d(68);d(128);var p=function(c){function d(a,c){m(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.layer=a;e.panel=c;var f=e.element=document.createElement("span");f.className="layer-item-parent noselect";var g=e.widgetElement=document.createElement("span");g.className="layer-item noselect";f.appendChild(g);var h=e.labelElement=document.createElement("span");
h.className="layer-item-label";var l=e.layerNumberElement=document.createElement("span");l.className="layer-item-number";var n=e.valueElement=document.createElement("span");n.className="layer-item-value";var p=document.createElement("span");p.title="Delete layer";p.className="layer-item-close";e.registerEventListener(p,"click",function(a){e.panel.layerManager.removeManagedLayer(e.layer)});g.appendChild(l);g.appendChild(h);g.appendChild(n);g.appendChild(p);e.registerEventListener(g,"click",function(b){a.setVisible(!a.visible)});
e.registerEventListener(f,"mousedown",function(a){0===a.button&&e.panel.setDragging(!0)});e.registerEventListener(f,"mouseup",function(a){0===a.button&&e.panel.setDragging(!1)});e.registerEventListener(g,"dblclick",function(b){a instanceof k.ManagedUserLayerWithSpecification&&new v.LayerDialog(e.panel.manager,a)});g=e.dropdownElement=document.createElement("div");e.registerEventListener(g,"mousedown",function(a){a.stopPropagation()});e.setupDropdownElement();e.handleLayerChanged();e.registerSignalBinding(a.layerChanged.add(e.handleLayerChanged,
e));f.appendChild(g);e.registerEventListener(f,"mouseenter",function(){e.hovering=!0;e.updateDropdownState()});e.registerEventListener(f,"mouseleave",function(a){e.hovering=!1;e.updateDropdownState()});return e}a(d,c);f(d,[{key:"updateDropdownState",value:function(){this.hovering&&!this.panel.dragging&&0<this.dropdownElement.childElementCount?(this.dropdownElement.style.display="flex",h.positionDropdown(this.dropdownElement,this.widgetElement)):this.dropdownElement.style.display="none"}},{key:"setupDropdownElement",
value:function(){this.dropdownElement.className="layer-dropdown"}},{key:"update",value:function(){var a=this.layer;this.labelElement.textContent=a.name;this.widgetElement.setAttribute("layer-visible",a.visible.toString())}},{key:"handleLayerChanged",value:function(){var a=this.layer.layer;a!==this.userLayer&&(this.dropdown&&(this.dropdown.dispose(),l.removeChildren(this.dropdownElement),this.setupDropdownElement()),this.dropdown=(this.userLayer=a)?a.makeDropdown(this.dropdownElement):null)}},{key:"disposed",
value:function(){this.dropdown&&this.dropdown.dispose();this.element.parentElement.removeChild(this.element)}}]);return d}(g.RefCounted);d=function(d){function e(a,c){m(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.element=a;d.manager=c;d.layerWidgets=new Map;d.layerUpdateNeeded=!0;d.valueUpdateNeeded=!1;d.dragging=!1;a.className="layer-panel";d.registerSignalBinding(c.layerSelectedValues.changed.add(d.handleLayerValuesChanged,d));d.registerSignalBinding(c.layerManager.layersChanged.add(d.handleLayersChanged,
d));var f=d.addButton=document.createElement("button");f.className="layer-add-button";f.title="Add layer";d.registerEventListener(f,"click",function(){d.addLayerMenu()});a.appendChild(f);d.update();var g=new n.Sortable(d.element,{draggable:".layer-item-parent",onStart:function(a){d.setDragging(!0);d.element.classList.add("sorting-in-progress")},onEnd:function(a){d.setDragging(!1);d.element.classList.remove("sorting-in-progress");d.layerManager.reorderManagedLayer(a.oldIndex,a.newIndex)},onMove:function(a){return a.related!==
d.addButton}});d.registerDisposer(function(){g.destroy()});return d}a(e,d);f(e,[{key:"setDragging",value:function(a){this.dragging=a;a=$jscomp.makeIterator(this.layerWidgets.values());for(var b=a.next();!b.done;b=a.next())b.value.updateDropdownState()}},{key:"dispose",value:function(){this.layerWidgets.forEach(function(a){return a.dispose()});this.layerWidgets=null}},{key:"handleLayersChanged",value:function(){this.layerUpdateNeeded=!0;this.handleLayerValuesChanged()}},{key:"handleLayerValuesChanged",
value:function(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,requestAnimationFrame(this.update.bind(this)))}},{key:"update",value:function(){this.valueUpdateNeeded=!1;this.updateLayers();for(var a=this.manager.layerSelectedValues,b=$jscomp.makeIterator(this.layerWidgets),d=b.next();!d.done;d=b.next()){var e=c(d.value,2),d=e[1],e=a.get(e[0].layer),f="";void 0!==e&&(f=""+e);d.valueElement.textContent=f}}},{key:"updateLayers",value:function(){var a=this;if(this.layerUpdateNeeded){this.layerUpdateNeeded=
!1;var b=this.element,d=new Set,e=b.firstElementChild;this.manager.layerManager.managedLayers.forEach(function(c,f){d.add(c);var g=a.layerWidgets.get(c);void 0===g&&(g=new p(c,a),a.layerWidgets.set(c,g));g.layerNumberElement.textContent=""+(1+f);g.update();g.element!==e&&b.insertBefore(g.element,a.addButton)});for(var f=$jscomp.makeIterator(this.layerWidgets),g=f.next();!g.done;g=f.next()){var h=c(g.value,2),g=h[0],h=h[1];d.has(g)||(this.layerWidgets.delete(g),h.dispose())}}}},{key:"addLayerMenu",
value:function(){new v.LayerDialog(this.manager)}},{key:"layerManager",get:function(){return this.manager.layerManager}}]);return e}(g.RefCounted);e.LayerPanel=d},function(g,e,d){e.Sortable=d(127)},function(g,e,d){var m,b;(function(a){!(m=a,b="function"===typeof m?m.call(e,d,e,g):m,void 0!==b&&(g.exports=b))})(function(){function a(a,b){if(!a||!a.nodeType||1!==a.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(a);this.el=a;this.options=b=x({},b);a[S]=this;var c={group:Math.random(),
sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(a.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(a,b){a.setData("Text",b.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1},d;for(d in c)d in b||(b[d]=c[d]);aa(b);for(var f in this)"_"===f.charAt(0)&&(this[f]=
this[f].bind(this));this.nativeDraggable=b.forceFallback?!1:ba;e(a,"mousedown",this._onTapStart);e(a,"touchstart",this._onTapStart);this.nativeDraggable&&(e(a,"dragover",this),e(a,"dragenter",this));V.push(this._onDragOver);b.store&&this.sort(b.store.get(this))}function b(a){z&&z.state!==a&&(m(z,"display",a?"none":""),!a&&z.state&&D.insertBefore(z,t),z.state=a)}function d(a,b,c){if(a){c=c||Q;b=b.split(".");var e=b.shift().toUpperCase(),f=new RegExp("\\s("+b.join("|")+")(?=\\s)","g");do if(">*"===
e&&a.parentNode===c||!(""!==e&&a.nodeName.toUpperCase()!=e||b.length&&((" "+a.className+" ").match(f)||[]).length!=b.length))return a;while(a!==c&&(a=a.parentNode))}return null}function e(a,b,c){a.addEventListener(b,c,!1)}function g(a,b,c){a.removeEventListener(b,c,!1)}function h(a,b,c){if(a)if(a.classList)a.classList[c?"add":"remove"](b);else{var d=(" "+a.className+" ").replace(U," ").replace(" "+b+" "," ");a.className=(d+(c?" "+b:"")).replace(U," ")}}function m(a,b,c){var d=a&&a.style;if(d){if(void 0===
c)return Q.defaultView&&Q.defaultView.getComputedStyle?c=Q.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b);d[b]=c+("string"===typeof c?"":"px")}}function v(a,b,c){if(a){a=a.getElementsByTagName(b);b=0;var d=a.length;if(c)for(;b<d;b++)c(a[b],b);return a}return[]}function p(a,b,c,d,e,f,g){var h=Q.createEvent("Event"),k=(a||b[S]).options,l="on"+c.charAt(0).toUpperCase()+c.substr(1);h.initEvent(c,!0,!0);h.to=b;h.from=e||b;h.item=d||b;h.clone=
z;h.oldIndex=f;h.newIndex=g;b.dispatchEvent(h);k[l]&&k[l].call(a,h)}function A(a,b,c,d,e,f){var g,h=a[S],k=h.options.onMove,l;g=Q.createEvent("Event");g.initEvent("move",!0,!0);g.to=b;g.from=a;g.dragged=c;g.draggedRect=d;g.related=e||b;g.relatedRect=f||b.getBoundingClientRect();a.dispatchEvent(g);k&&(l=k.call(h,g));return l}function q(a){a.draggable=!1}function r(){X=!1}function w(a){a=a.tagName+a.className+a.src+a.href+a.textContent;for(var b=a.length,c=0;b--;)c+=a.charCodeAt(b);return c.toString(36)}
function u(a){var b=0;if(!a||!a.parentNode)return-1;for(;a&&(a=a.previousElementSibling);)"TEMPLATE"!==a.nodeName.toUpperCase()&&b++;return b}function y(a,b){var c,d;return function(){void 0===c&&(c=arguments,d=this,setTimeout(function(){1===c.length?a.call(d,c[0]):a.apply(d,c);c=void 0},b))}}function x(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var t,B,C,z,D,E,G,F,K,L,N,M,J,P,H={},I,O,R,U=/\s+/g,S="Sortable"+(new Date).getTime(),T=window,Q=T.document,Z=T.parseInt,ba=!!("draggable"in
Q.createElement("div")),Y=function(a){a=Q.createElement("x");a.style.cssText="pointer-events:auto";return"auto"===a.style.pointerEvents}(),X=!1,W=Math.abs,V=[],ca=y(function(a,b,c){if(c&&b.scroll){var d,e=b.scrollSensitivity,f=b.scrollSpeed,g=a.clientX;a=a.clientY;var h=window.innerWidth,k=window.innerHeight,l,m;if(F!==c&&(G=b.scroll,F=c,!0===G)){G=c;do if(G.offsetWidth<G.scrollWidth||G.offsetHeight<G.scrollHeight)break;while(G=G.parentNode)}G&&(d=G,b=G.getBoundingClientRect(),l=(W(b.right-g)<=e)-
(W(b.left-g)<=e),m=(W(b.bottom-a)<=e)-(W(b.top-a)<=e));l||m||(l=(h-g<=e)-(g<=e),m=(k-a<=e)-(a<=e),(l||m)&&(d=T));if(H.vx!==l||H.vy!==m||H.el!==d)H.el=d,H.vx=l,H.vy=m,clearInterval(H.pid),d&&(H.pid=setInterval(function(){d===T?T.scrollTo(T.pageXOffset+l*f,T.pageYOffset+m*f):(m&&(d.scrollTop+=m*f),l&&(d.scrollLeft+=l*f))},24))}},30),aa=function(a){var b=a.group;b&&"object"==typeof b||(b=a.group={name:b});["pull","put"].forEach(function(a){a in b||(b[a]=!0)});a.groups=" "+b.name+(b.put.join?" "+b.put.join(" "):
"")+" "};a.prototype={constructor:a,_onTapStart:function(a){var b=this,c=this.el,e=this.options,g=a.touches&&a.touches[0],h=(g||a).target,k=h,l=e.filter;if(!("mousedown"===a.type&&0!==a.button||e.disabled)&&(h=d(h,e.draggable,c))){M=u(h);if("function"===typeof l){if(l.call(this,a,h,this)){p(b,k,"filter",h,c,M);a.preventDefault();return}}else if(l&&(l=l.split(",").some(function(a){if(a=d(k,a.trim(),c))return p(b,a,"filter",h,c,M),!0}))){a.preventDefault();return}e.handle&&!d(k,e.handle,c)||this._prepareDragStart(a,
g,h)}},_prepareDragStart:function(a,b,c){var d=this,f=d.el,g=d.options,l=f.ownerDocument;c&&!t&&c.parentNode===f&&(I=a,D=f,t=c,B=t.parentNode,E=t.nextSibling,P=g.group,a=function(){d._disableDelayedDrag();t.draggable=!0;h(t,d.options.chosenClass,!0);d._triggerDragStart(b)},g.ignore.split(",").forEach(function(a){v(t,a.trim(),q)}),e(l,"mouseup",d._onDrop),e(l,"touchend",d._onDrop),e(l,"touchcancel",d._onDrop),g.delay?(e(l,"mouseup",d._disableDelayedDrag),e(l,"touchend",d._disableDelayedDrag),e(l,"touchcancel",
d._disableDelayedDrag),e(l,"mousemove",d._disableDelayedDrag),e(l,"touchmove",d._disableDelayedDrag),d._dragStartTimer=setTimeout(a,g.delay)):a())},_disableDelayedDrag:function(){var a=this.el.ownerDocument;clearTimeout(this._dragStartTimer);g(a,"mouseup",this._disableDelayedDrag);g(a,"touchend",this._disableDelayedDrag);g(a,"touchcancel",this._disableDelayedDrag);g(a,"mousemove",this._disableDelayedDrag);g(a,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(a){a?(I={target:t,clientX:a.clientX,
clientY:a.clientY},this._onDragStart(I,"touch")):this.nativeDraggable?(e(t,"dragend",this),e(D,"dragstart",this._onDragStart)):this._onDragStart(I,!0);try{Q.selection?Q.selection.empty():window.getSelection().removeAllRanges()}catch(b){}},_dragStarted:function(){D&&t&&(h(t,this.options.ghostClass,!0),a.active=this,p(this,D,"start",t,D,M))},_emulateDragOver:function(){if(O&&(this._lastX!==O.clientX||this._lastY!==O.clientY)){this._lastX=O.clientX;this._lastY=O.clientY;Y||m(C,"display","none");var a=
Q.elementFromPoint(O.clientX,O.clientY),b=a,c=" "+this.options.group.name+"",d=V.length;if(b){do{if(b[S]&&-1<b[S].options.groups.indexOf(c)){for(;d--;)V[d]({clientX:O.clientX,clientY:O.clientY,target:a,rootEl:b});break}a=b}while(b=b.parentNode)}Y||m(C,"display","")}},_onTouchMove:function(b){if(I){a.active||this._dragStarted();this._appendGhost();var c=b.touches?b.touches[0]:b,d=c.clientX-I.clientX,e=c.clientY-I.clientY,d=b.touches?"translate3d("+d+"px,"+e+"px,0)":"translate("+d+"px,"+e+"px)";R=!0;
O=c;m(C,"webkitTransform",d);m(C,"mozTransform",d);m(C,"msTransform",d);m(C,"transform",d);b.preventDefault()}},_appendGhost:function(){if(!C){var a=t.getBoundingClientRect(),b=m(t),c=this.options;C=t.cloneNode(!0);h(C,c.ghostClass,!1);h(C,c.fallbackClass,!0);m(C,"top",a.top-Z(b.marginTop,10));m(C,"left",a.left-Z(b.marginLeft,10));m(C,"width",a.width);m(C,"height",a.height);m(C,"opacity","0.8");m(C,"position","fixed");m(C,"zIndex","100000");m(C,"pointerEvents","none");c.fallbackOnBody&&Q.body.appendChild(C)||
D.appendChild(C);b=C.getBoundingClientRect();m(C,"width",2*a.width-b.width);m(C,"height",2*a.height-b.height)}},_onDragStart:function(a,b){var c=a.dataTransfer,d=this.options;this._offUpEvents();"clone"==P.pull&&(z=t.cloneNode(!0),m(z,"display","none"),D.insertBefore(z,t));b?("touch"===b?(e(Q,"touchmove",this._onTouchMove),e(Q,"touchend",this._onDrop),e(Q,"touchcancel",this._onDrop)):(e(Q,"mousemove",this._onTouchMove),e(Q,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):
(c&&(c.effectAllowed="move",d.setData&&d.setData.call(this,c,t)),e(Q,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(a){var e=this.el,g,h,k;h=this.options;g=h.group;var l=g.put,p=P===g,q=h.sort;void 0!==a.preventDefault&&(a.preventDefault(),!h.dragoverBubble&&a.stopPropagation());R=!0;if(P&&!h.disabled&&(p?q||(k=!D.contains(t)):P.pull&&l&&(P.name===g.name||l.indexOf&&~l.indexOf(P.name)))&&(void 0===a.rootEl||a.rootEl===this.el)&&(ca(a,h,this.el),!X))if(g=d(a.target,h.draggable,
e),h=t.getBoundingClientRect(),k)b(!0),z||E?D.insertBefore(t,z||E):q||D.appendChild(t);else if(!(k=0===e.children.length||e.children[0]===C)&&(k=e===a.target)&&(g=e.lastElementChild,k=g.getBoundingClientRect(),k=g=(5<a.clientY-(k.top+k.height)||5<a.clientX-(k.right+k.width))&&g),k){if(g){if(g.animated)return;u=g.getBoundingClientRect()}b(p);!1!==A(D,e,t,h,g,u)&&(t.contains(e)||(e.appendChild(t),B=e),this._animate(h,t),g&&this._animate(u,g))}else if(g&&!g.animated&&g!==t&&void 0!==g.parentNode[S]){K!==
g&&(K=g,L=m(g),N=m(g.parentNode));var u=g.getBoundingClientRect(),y=u.right-u.left,x=u.bottom-u.top,q=/left|right|inline/.test(L.cssFloat+L.display)||"flex"==N.display&&0===N["flex-direction"].indexOf("row");k=g.offsetWidth>t.offsetWidth;l=g.offsetHeight>t.offsetHeight;y=.5<(q?(a.clientX-u.left)/y:(a.clientY-u.top)/x);a=g.nextElementSibling;x=A(D,e,t,h,g,u);!1!==x&&(X=!0,setTimeout(r,30),b(p),1===x||-1===x?p=1===x:q?(p=t.offsetTop,q=g.offsetTop,p=p===q?g.previousElementSibling===t&&!k||y&&k:q>p):
p=a!==t&&!l||y&&l,t.contains(e)||(p&&!a?e.appendChild(t):g.parentNode.insertBefore(t,p?a:g)),B=t.parentNode,this._animate(h,t),this._animate(u,g))}},_animate:function(a,b){var c=this.options.animation;if(c){var d=b.getBoundingClientRect();m(b,"transition","none");m(b,"transform","translate3d("+(a.left-d.left)+"px,"+(a.top-d.top)+"px,0)");b.offsetWidth;m(b,"transition","all "+c+"ms");m(b,"transform","translate3d(0,0,0)");clearTimeout(b.animated);b.animated=setTimeout(function(){m(b,"transition","");
m(b,"transform","");b.animated=!1},c)}},_offUpEvents:function(){var a=this.el.ownerDocument;g(Q,"touchmove",this._onTouchMove);g(a,"mouseup",this._onDrop);g(a,"touchend",this._onDrop);g(a,"touchcancel",this._onDrop)},_onDrop:function(b){var c=this.el,d=this.options;clearInterval(this._loopId);clearInterval(H.pid);clearTimeout(this._dragStartTimer);g(Q,"mousemove",this._onTouchMove);this.nativeDraggable&&(g(Q,"drop",this),g(c,"dragstart",this._onDragStart));this._offUpEvents();if(b){R&&(b.preventDefault(),
!d.dropBubble&&b.stopPropagation());C&&C.parentNode.removeChild(C);if(t&&(this.nativeDraggable&&g(t,"dragend",this),q(t),h(t,this.options.ghostClass,!1),h(t,this.options.chosenClass,!1),D!==B?(J=u(t),0<=J&&(p(null,B,"sort",t,D,M,J),p(this,D,"sort",t,D,M,J),p(null,B,"add",t,D,M,J),p(this,D,"remove",t,D,M,J))):(z&&z.parentNode.removeChild(z),t.nextSibling!==E&&(J=u(t),0<=J&&(p(this,D,"update",t,D,M,J),p(this,D,"sort",t,D,M,J)))),a.active)){if(null===J||-1===J)J=M;p(this,D,"end",t,D,M,J);this.save()}D=
t=B=C=E=z=G=F=I=O=R=J=K=L=P=a.active=null}},handleEvent:function(a){var b=a.type;"dragover"===b||"dragenter"===b?t&&(this._onDragOver(a),a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.preventDefault()):"drop"!==b&&"dragend"!==b||this._onDrop(a)},toArray:function(){for(var a=[],b,c=this.el.children,e=0,g=c.length,h=this.options;e<g;e++)b=c[e],d(b,h.draggable,this.el)&&a.push(b.getAttribute(h.dataIdAttr)||w(b));return a},sort:function(a){var b={},c=this.el;this.toArray().forEach(function(a,e){var g=
c.children[e];d(g,this.options.draggable,c)&&(b[a]=g)},this);a.forEach(function(a){b[a]&&(c.removeChild(b[a]),c.appendChild(b[a]))})},save:function(){var a=this.options.store;a&&a.set(this)},closest:function(a,b){return d(a,b||this.options.draggable,this.el)},option:function(a,b){var c=this.options;if(void 0===b)return c[a];c[a]=b;"group"===a&&aa(c)},destroy:function(){var a=this.el;a[S]=null;g(a,"mousedown",this._onTapStart);g(a,"touchstart",this._onTapStart);this.nativeDraggable&&(g(a,"dragover",
this),g(a,"dragenter",this));Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")});V.splice(V.indexOf(this._onDragOver),1);this._onDrop();this.el=a=null}};a.utils={on:e,off:g,css:m,find:v,is:function(a,b){return!!d(a,b,a)},extend:x,throttle:y,closest:d,toggleClass:h,index:u};a.create=function(b,c){return new a(b,c)};a.version="1.4.2";return a})},function(g,e){},function(g,e){e.withFlex=function(d,e){return function(b){b.style.flex=d;e(b)}};e.withStyle=
function(d,e){return function(b){Object.assign(b.style,d);e(b)}};e.withAttributes=function(d,e){return function(b){Object.assign(b,d);e(b)}};e.box=function(d,e){return function(b){b.style.display="flex";b.style.flexDirection=d;for(var a=$jscomp.makeIterator(e),c=a.next();!c.done;c=a.next()){var c=c.value,f=b.ownerDocument.createElement("div");b.appendChild(f);c(f)}}}},function(g,e,d){function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var f=d(21),k=d(11),l=d(37),h=function(d){function e(a){m(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.changed=new l.Signal;var d=!0;null==a&&(a=f.vec3.create(),d=!1);c.size=a;c.valid=d;return c}a(e,d);c(e,[{key:"reset",value:function(){this.valid=!1;this.changed.dispatch()}},{key:"setValid",value:function(){this.valid||(this.valid=!0,this.changed.dispatch())}},
{key:"toJSON",value:function(){return this.valid?Array.prototype.slice.call(this.size):void 0}},{key:"restoreState",value:function(a){try{k.parseFiniteVec(this.size,a),this.setValid()}catch(b){this.valid=!1}}},{key:"toString",value:function(){return this.valid?this.size.toString():null}},{key:"voxelFromSpatial",value:function(a,b){f.vec3.divide(a,b,this.size)}},{key:"spatialFromVoxel",value:function(a,b){f.vec3.multiply(a,b,this.size)}}]);return e}(g.RefCounted);e.VoxelSize=h;var n=f.vec3.create(),
v=f.quat.create(),p=function(d){function e(a,c){m(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.voxelCoordinates=null;d.changed=new l.Signal;null==a&&(a=new h);d.voxelSize=a;var g=!0;null==c&&(c=f.vec3.create(),g=!1);d.spatialCoordinates=c;d.spatialCoordinatesValid=g;d.registerDisposer(a);d.registerSignalBinding(a.changed.add(d.handleVoxelSizeChanged,d));return d}a(e,d);c(e,[{key:"reset",value:function(){this.spatialCoordinatesValid=!1;this.voxelCoordinates=null;this.changed.dispatch()}},
{key:"getVoxelCoordinates",value:function(a){var b=this.voxelCoordinates;if(b)f.vec3.copy(a,b);else if(this.valid)this.voxelSize.voxelFromSpatial(a,this.spatialCoordinates);else return!1;return!0}},{key:"setVoxelCoordinates",value:function(a){var b=this.voxelSize;b.valid?(b.spatialFromVoxel(this.spatialCoordinates,a),this.markSpatialCoordinatesChanged()):(b=this.voxelCoordinates)?f.vec3.copy(b,a):this.voxelCoordinates=f.vec3.clone(a);this.changed.dispatch()}},{key:"markSpatialCoordinatesChanged",
value:function(){this.spatialCoordinatesValid=!0;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"handleVoxelSizeChanged",value:function(){null==this.voxelCoordinates||this.spatialCoordinatesValid||(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0);this.voxelCoordinates=null;this.changed.dispatch()}},{key:"toJSON",value:function(){var a=!0,b=this.voxelSize.toJSON(),c={};void 0!==b&&(a=!1,c.voxelSize=b);this.voxelCoordinatesValid?
(this.getVoxelCoordinates(n),c.voxelCoordinates=Array.prototype.slice.call(n),a=!1):this.spatialCoordinatesValid&&(c.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),a=!1);return a?void 0:c}},{key:"restoreState",value:function(a){this.voxelSize.restoreState(a.voxelSize);this.spatialCoordinatesValid=!1;if(a.hasOwnProperty("voxelCoordinates"))try{var b=f.vec3.create();k.parseFiniteVec(b,a.voxelCoordinates);this.setVoxelCoordinates(b)}catch(c){}try{k.parseFiniteVec(this.spatialCoordinates,
a.spatialCoordinates),this.markSpatialCoordinatesChanged()}catch(c){}}},{key:"snapToVoxel",value:function(){if(this.valid){for(var a=this.spatialCoordinates,b=this.voxelSize.size,c=0;3>c;++c){var d=b[c];a[c]=Math.round(a[c]/d)*d}this.changed.dispatch()}else if(a=this.voxelCoordinates,null!=a){for(b=0;3>b;++b)a[b]=Math.round(a[b]);this.changed.dispatch()}}},{key:"valid",get:function(){return this.spatialCoordinatesValid&&this.voxelSize.valid}},{key:"voxelCoordinatesValid",get:function(){return this.valid||
null!=this.voxelCoordinates}}]);return e}(g.RefCounted);e.SpatialPosition=p;var A=function(d){function e(a){m(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.changed=new l.Signal;null==a&&(a=f.quat.create());c.orientation=a;return c}a(e,d);c(e,[{key:"toJSON",value:function(){var a=this.orientation;return 0===a[0]&&0===a[1]&&0===a[2]&&1===a[3]?void 0:Array.prototype.slice.call(this.orientation)}},{key:"restoreState",value:function(a){try{k.parseFiniteVec(this.orientation,a),f.quat.normalize(this.orientation,
this.orientation)}catch(b){f.quat.identity(this.orientation)}this.changed.dispatch()}},{key:"reset",value:function(){f.quat.identity(this.orientation);this.changed.dispatch()}},{key:"snap",value:function(){var a=f.mat3.create();f.mat3.fromQuat(a,this.orientation);for(var b=[!1,!1,!1],c=0;3>c;++c){for(var d=0,e=0,g=0;3>g;++g){var h=a[3*c+g];a[3*c+g]=0;!b[g]&&Math.abs(h)>Math.abs(d)&&(d=h,e=g)}a[3*c+e]=Math.sign(d);b[e]=!0}f.quat.fromMat3(this.orientation,a);this.changed.dispatch()}}],[{key:"makeRelative",
value:function(a,b){var c=new e(f.quat.multiply(f.quat.create(),a.orientation,b)),d=!1;c.registerSignalBinding(a.changed.add(function(){d||(g=!0,f.quat.multiply(c.orientation,a.orientation,b),c.changed.dispatch(),g=!1)}));var g=!1,h=f.quat.invert(f.quat.create(),b);c.registerSignalBinding(c.changed.add(function(){g||(d=!0,f.quat.multiply(a.orientation,c.orientation,h),a.changed.dispatch(),d=!1)}));return c}}]);return e}(g.RefCounted);e.OrientationState=A;var q=function(d){function e(a,c){m(this,e);
var d=b(this,Object.getPrototypeOf(e).call(this));d.changed=new l.Signal;null==a&&(a=new p);d.position=a;null==c&&(c=new A);d.orientation=c;d.registerDisposer(d.position);d.registerDisposer(d.orientation);d.registerSignalBinding(d.position.changed.add(d.changed.dispatch,d.changed));d.registerSignalBinding(d.orientation.changed.add(d.changed.dispatch,d.changed));return d}a(e,d);c(e,[{key:"reset",value:function(){this.position.reset();this.orientation.reset()}},{key:"dispose",value:function(){this.position.changed.remove(this.changed.dispatch,
this.changed)}},{key:"toMat4",value:function(a){f.mat4.fromRotationTranslation(a,this.orientation.orientation,this.position.spatialCoordinates)}},{key:"toJSON",value:function(){var a=this.position.toJSON(),b=this.orientation.toJSON();return void 0===a&&void 0===b?void 0:{position:a,orientation:b}}},{key:"restoreState",value:function(a){this.position.restoreState(a.position);this.orientation.restoreState(a.orientation)}},{key:"snap",value:function(){this.orientation.snap();this.position.snapToVoxel();
this.changed.dispatch()}},{key:"translateAbsolute",value:function(a){f.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,a);this.position.changed.dispatch()}},{key:"translateRelative",value:function(a){if(this.valid){var b=f.vec3.create();f.vec3.transformQuat(b,a,this.orientation.orientation);f.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"translateVoxelsRelative",value:function(a){if(this.valid){var b=
f.vec3.create();f.vec3.transformQuat(b,a,this.orientation.orientation);f.vec3.multiply(b,b,this.position.voxelSize.size);f.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"rotateRelative",value:function(a,b){var c=f.quat.create();f.quat.setAxisAngle(c,a,b);var d=this.orientation.orientation;f.quat.multiply(d,d,c);this.orientation.changed.dispatch()}},{key:"rotateAbsolute",value:function(a,b,c){var d=f.quat.create();f.quat.setAxisAngle(d,
a,b);a=this.orientation.orientation;if(void 0!==c){b=this.position.spatialCoordinates;var e=f.vec3.subtract(n,c,b),g=f.quat.invert(v,a);f.vec3.transformQuat(e,e,g);f.quat.multiply(a,d,a);f.vec3.transformQuat(b,e,a);f.vec3.subtract(b,c,b);this.position.changed.dispatch()}else f.quat.multiply(a,d,a);this.orientation.changed.dispatch()}},{key:"valid",get:function(){return this.position.valid}}]);return e}(g.RefCounted);e.Pose=q;var r=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?
Number.NaN:arguments[0],c=1>=arguments.length||void 0===arguments[1]?b:arguments[1];m(this,a);this.value_=b;this.defaultValue=c;this.changed=new l.Signal}c(a,[{key:"toJSON",value:function(){var a=this.value_,b=this.defaultValue;return Number.isNaN(a)===Number.isNaN(b)||a===b?void 0:a}},{key:"restoreState",value:function(a){"number"===typeof a&&Number.isFinite(a)&&0<a?this.value=a:this.value=this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"zoomBy",value:function(a){var b=
this.value_;Number.isNaN(b)||(this.value=b*a)}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return a}();e.TrackableZoomState=r;d=function(d){function e(){var a=0>=arguments.length||void 0===arguments[0]?new q:arguments[0],c=1>=arguments.length||void 0===arguments[1]?Number.NaN:arguments[1];m(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.pose=a;d.changed=new l.Signal;d.zoomFactor="number"===typeof c?new r(c):
c;d.registerDisposer(a);d.registerSignalBinding(d.pose.changed.add(function(){d.changed.dispatch()}));d.registerSignalBinding(d.zoomFactor.changed.add(function(){d.changed.dispatch()}));d.registerSignalBinding(d.voxelSize.changed.add(function(){d.handleVoxelSizeChanged()}));d.handleVoxelSizeChanged();return d}a(e,d);c(e,[{key:"reset",value:function(){this.pose.reset();this.zoomFactor.reset()}},{key:"setZoomFactorFromVoxelSize",value:function(){this.voxelSize.valid&&(this.zoomFactor.value=Math.min.apply(null,
this.voxelSize.size))}},{key:"handleVoxelSizeChanged",value:function(){Number.isNaN(this.zoomFactor.value)&&this.setZoomFactorFromVoxelSize()}},{key:"toMat4",value:function(a){this.pose.toMat4(a);var b=this.zoomFactor.value;f.mat4.scale(a,a,f.vec3.fromValues(b,b,b))}},{key:"toJSON",value:function(){var a=this.pose.toJSON(),b=this.zoomFactor.toJSON();return void 0===a&&void 0===b?void 0:{pose:a,zoomFactor:b}}},{key:"restoreState",value:function(a){a&&"object"===typeof a&&(this.pose.restoreState(a.pose),
this.zoomFactor.restoreState(a.zoomFactor),this.handleVoxelSizeChanged(),this.changed.dispatch())}},{key:"zoomBy",value:function(a){this.zoomFactor.zoomBy(a)}},{key:"voxelSize",get:function(){return this.pose.position.voxelSize}},{key:"position",get:function(){return this.pose.position}},{key:"valid",get:function(){return this.pose.valid}}]);return e}(g.RefCounted);e.NavigationState=d},function(g,e,d){function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=d(8);var c=d(21);d(132);d=function(d){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=m(this,Object.getPrototypeOf(e).call(this));d.element=a;d.viewer=b;d.positionElements=[];d.needsUpdate=null;d.tempPosition=c.vec3.create();a.setAttribute("class","position-status-panel");for(var f=d.positionElements,g=function(b){var e=a.ownerDocument.createElement("label");
e.className="position-status-coord";var g=a.ownerDocument.createElement("input");g.type="number";g.className="position-status-coord";e.textContent=c.AXES_NAMES[b];e.appendChild(g);a.appendChild(e);f.push(g);var h=!1;d.registerEventListener(g,"change",function(a){d.handleCoordinateChange()});d.registerEventListener(g,"input",function(a){h&&(d.handleCoordinateChange(),h=!1);return!0});d.registerEventListener(g,"wheel",function(a){h=!0;g.focus();return!0});d.registerEventListener(g,"keydown",function(a){h=
!1;return!0});d.registerEventListener(g,"mousedown",function(a){return h=!0});d.registerEventListener(g,"click",function(a){return!0});d.registerEventListener(g,"blur",function(a){h=!1;return!0})},A=0;3>A;++A)g(A);g=d.mouseElement=document.createElement("span");g.className="position-status-mouse";a.appendChild(g);g=b.mouseState;d.registerSignalBinding(b.navigationState.pose.changed.add(d.handleChange,d));d.registerSignalBinding(g.changed.add(d.handleChange,d));d.handleChange();return d}b(e,d);a(e,
[{key:"handleChange",value:function(){null==this.needsUpdate&&(this.needsUpdate=requestAnimationFrame(this.update.bind(this)))}},{key:"handleCoordinateChange",value:function(){var a=this.positionElements,b=this.viewer.navigationState.pose.position,c=this.tempPosition;if(b.voxelCoordinatesValid){b.getVoxelCoordinates(c);for(var d=0;3>d;++d){var e=parseFloat(a[d].value);Number.isNaN(e)||(c[d]=e)}b.setVoxelCoordinates(c)}}},{key:"update",value:function(){this.needsUpdate=null;var a=this.viewer,b=a.mouseState,
c=this.tempPosition,a=a.navigationState.pose.position;if(a.getVoxelCoordinates(c))for(var d=this.positionElements,e=0;3>e;++e)d[e].value=""+Math.floor(c[e]);a=a.voxelSize;d="";b.active&&(a.voxelFromSpatial(c,b.position),d="x "+Math.round(c[0])+"  y "+Math.round(c[1])+"  z "+Math.round(c[2]));this.mouseElement.textContent=d}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.positionElements),b=a.next();!b.done;b=a.next())this.element.removeChild(b.value);this.element=this.positionElements=
null}}]);return e}(g.RefCounted);e.PositionStatusPanel=d},function(g,e){},function(g,e,d){function m(){try{var a=location.href.replace(/^[^#]+/,"");if(""===a||"#"===a||"#!"===a)a="#!{}";if(a.startsWith("#!")){if(a=a.slice(2),a=decodeURI(a),a!==p){p=a;var b=f.urlSafeParse(a);if("object"===typeof b){h=b;for(var c=$jscomp.makeIterator(Object.keys(h)),d=c.next();!d.done;d=c.next()){var e=d.value,g=k.get(e);if(void 0!==g){a=e;b=g;try{n=b,b.restoreState(h[a])}catch(l){console.log("Failed to restore "+a+
" state: "+l)}finally{n=null}}}}}}else p=null}catch(l){console.log(l)}}function b(){null!=A&&clearTimeout(A);A=setTimeout(a,500)}function a(){A=null;for(var a=!1,b=$jscomp.makeIterator(v),c=b.next();!c.done;c=b.next()){var c=c.value,d=l.get(c);void 0===d?h.hasOwnProperty(d)&&(a=!0):(a=!0,h[d]=c.toJSON())}v.clear();a&&(a=f.urlSafeStringify(h),a!==p&&(p=a,"{}"===p?history.replaceState(null,null,"#"):history.replaceState(null,null,"#!"+p)))}function c(){n!==this&&(v.add(this),b())}var f=d(11),k=new Map,
l=new Map,h={},n=null,v=new Set,p=null,A=null;e.delayHashUpdate=function(){null!=A&&b()};addEventListener("hashchange",m);e.registerTrackable=function(a,b){if(k.has(a))throw Error("Key "+JSON.stringify(a)+" already registered.");if(l.has(b))throw Error("Object already registered.");k.set(a,b);l.set(b,a);h.hasOwnProperty(a)&&b.restoreState(h[a]);b.changed.add(c,b);c.call(b)};e.unregisterTrackable=function(a){var b=k.get(a),d=void 0;if(void 0!==b)d=a;else{d=l.get(a);if(void 0===d)throw Error("Key or object not registered.");
b=a}k.delete(d);l.delete(b);b.changed.remove(c,b);c.call(b)};m()},function(g,e){},function(g,e){e.makeDefaultKeyBindings=function(d){d.bind("arrowleft","x-");d.bind("arrowright","x+");d.bind("arrowup","y-");d.bind("arrowdown","y+");d.bind("comma","z-");d.bind("period","z+");d.bind("keyz","snap");d.bind("control+equal","zoom-in");d.bind("control+shift+equal","zoom-in");d.bind("control+minus","zoom-out");d.bind("keyr","rotate-relative-z-");d.bind("keye","rotate-relative-z+");d.bind("shift+arrowdown",
"rotate-relative-x-");d.bind("shift+arrowup","rotate-relative-x+");d.bind("shift+arrowleft","rotate-relative-y-");d.bind("shift+arrowright","rotate-relative-y+");d.bind("keyl","recolor");d.bind("keyx","clear-segments");d.bind("keys","toggle-show-slices");d.bind("keyb","toggle-scale-bar");d.bind("keya","toggle-axis-lines");for(var e=1;9>=e;++e)d.bind("digit"+e,"toggle-layer-"+e);d.bind("keyn","add-layer");d.bind("keyh","help");d.bind("space","toggle-layout")}}]);
